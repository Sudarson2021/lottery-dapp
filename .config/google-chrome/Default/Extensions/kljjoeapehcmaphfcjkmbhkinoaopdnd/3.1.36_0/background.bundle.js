/*! For license information please see background.bundle.js.LICENSE.txt */
(()=>{var __webpack_modules__={2176:(t,e,n)=>{"use strict";function r(){return!("undefined"!=typeof __SENTRY_BROWSER_BUNDLE__&&__SENTRY_BROWSER_BUNDLE__)&&"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)}function i(t,e){return t.require(e)}n.d(e,{l$:()=>i,KV:()=>r}),t=n.hmd(t)},1170:(t,e,n)=>{"use strict";n.d(e,{ph:()=>f,yW:()=>a});var r=n(2176),i=n(1235);t=n.hmd(t);const o=(0,i.Rf)(),s={nowSeconds:()=>Date.now()/1e3};const u=(0,r.KV)()?function(){try{return(0,r.l$)(t,"perf_hooks").performance}catch(t){return}}():function(){const{performance:t}=o;if(!t||!t.now)return;return{now:()=>t.now(),timeOrigin:Date.now()-t.now()}}(),c=void 0===u?s:{nowSeconds:()=>(u.timeOrigin+u.now())/1e3},a=s.nowSeconds.bind(s),f=c.nowSeconds.bind(c);let l;(()=>{const{performance:t}=o;if(!t||!t.now)return void(l="none");const e=36e5,n=t.now(),r=Date.now(),i=t.timeOrigin?Math.abs(t.timeOrigin+n-r):e,s=i<e,u=t.timing&&t.timing.navigationStart,c="number"==typeof u?Math.abs(u+n-r):e;s||c<e?i<=c?(l="timeOrigin",t.timeOrigin):l="navigationStart":l="dateNow"})()},1235:(t,e,n)=>{"use strict";function r(t){return t&&t.Math==Math?t:void 0}n.d(e,{Rf:()=>o,YO:()=>s,n2:()=>i});const i="object"==typeof globalThis&&r(globalThis)||"object"==typeof window&&r(window)||"object"==typeof self&&r(self)||"object"==typeof n.g&&r(n.g)||function(){return this}()||{};function o(){return i}function s(t,e,n){const r=n||i,o=r.__SENTRY__=r.__SENTRY__||{};return o[t]||(o[t]=e())}},1771:function(t){!function(e,n){t.exports=function(t){"use strict";var e=Array.prototype.slice,n=Object.prototype.hasOwnProperty;return r.default=r,r;function r(i){var o=(i=i||{}).chrome||t.chrome,s=i.Promise||t.Promise,u=o.runtime,c=this;if(!c)throw new Error("ChromePromise must be called with new keyword");function a(t,n){return function(){var r=e.call(arguments);return new s((function(i,o){function s(){var t=u.lastError,n=e.call(arguments);if(t)o(t);else switch(n.length){case 0:i();break;case 1:i(n[0]);break;default:i(n)}}r.push(s),t.apply(n,r)}))}}function f(t,e){for(var i in t)if(n.call(t,i)){var o;try{o=t[i]}catch(t){continue}var s=typeof o;"object"!==s||o instanceof r?e[i]="function"===s?a(o,t):o:(e[i]={},f(o,e[i]))}}function l(t){if(t.permissions&&t.permissions.length){var e={};t.permissions.forEach((function(t){var n=/^[^.]+/.exec(t);n in o&&(e[n]=o[n])})),f(e,c)}}f(o,c),o.permissions&&o.permissions.onAdded.addListener(l)}}(this||e)}("undefined"!=typeof self?self:this)},4116:(t,e,n)=>{var r=new(n(1771));r.default=r,t.exports=r},6304:function(module,__unused_webpack_exports,__webpack_require__){module=__webpack_require__.nmd(module),function _f(self){"use strict";try{module&&(self=module)}catch(t){}var t;function u(t){return void 0===t||t}function aa(t){const e=Array(t);for(let n=0;n<t;n++)e[n]=v();return e}function v(){return Object.create(null)}function ba(t,e){return e.length-t.length}function x(t){return"string"==typeof t}function C(t){return"object"==typeof t}function D(t){return"function"==typeof t}function ca(t,e){var n=da;if(t&&(e&&(t=E(t,e)),this.H&&(t=E(t,this.H)),this.J&&1<t.length&&(t=E(t,this.J)),n||""===n)){if(t=t.split(n),this.filter){e=this.filter,n=t.length;const r=[];for(let i=0,o=0;i<n;i++){const n=t[i];n&&!e[n]&&(r[o++]=n)}t=r}return t}return t}self.t=_f;const da=/[\p{Z}\p{S}\p{P}\p{C}]+/u,ea=/[\u0300-\u036f]/g;function fa(t,e){const n=Object.keys(t),r=n.length,i=[];let o="",s=0;for(let u,c,a=0;a<r;a++)u=n[a],(c=t[u])?(i[s++]=F(e?"(?!\\b)"+u+"(\\b|_)":u),i[s++]=c):o+=(o?"|":"")+u;return o&&(i[s++]=F(e?"(?!\\b)("+o+")(\\b|_)":"("+o+")"),i[s]=""),i}function E(t,e){for(let n=0,r=e.length;n<r&&(t=t.replace(e[n],e[n+1]));n+=2);return t}function F(t){return new RegExp(t,"g")}function ha(t){let e="",n="";for(let r,i=0,o=t.length;i<o;i++)(r=t[i])!==n&&(e+=n=r);return e}var ja={encode:ia,F:!1,G:""};function ia(t){return ca.call(this,(""+t).toLowerCase(),!1)}const ka={},G={};function la(t){I(t,"add"),I(t,"append"),I(t,"search"),I(t,"update"),I(t,"remove")}function I(t,e){t[e+"Async"]=function(){const t=this,n=arguments;var r=n[n.length-1];let i;return D(r)&&(i=r,delete n[n.length-1]),r=new Promise((function(r){setTimeout((function(){t.async=!0;const i=t[e].apply(t,n);t.async=!1,r(i)}))})),i?(r.then(i),this):r}}function ma(t,e,n,r){const i=t.length;let o,s,u=[],c=0;r&&(r=[]);for(let a=i-1;0<=a;a--){const f=t[a],l=f.length,h=v();let d=!o;for(let t=0;t<l;t++){const l=f[t],v=l.length;if(v)for(let t,f,y=0;y<v;y++)if(f=l[y],o){if(o[f]){if(!a)if(n)n--;else if(u[c++]=f,c===e)return u;(a||r)&&(h[f]=1),d=!0}if(r&&(t=(s[f]||0)+1,s[f]=t,t<i)){const e=r[t-2]||(r[t-2]=[]);e[e.length]=f}}else h[f]=1}if(r)o||(s=h);else if(!d)return[];o=h}if(r)for(let t,i,s=r.length-1;0<=s;s--){t=r[s],i=t.length;for(let r,s=0;s<i;s++)if(r=t[s],!o[r]){if(n)n--;else if(u[c++]=r,c===e)return u;o[r]=1}}return u}function na(t,e){const n=v(),r=v(),i=[];for(let e=0;e<t.length;e++)n[t[e]]=1;for(let t,o=0;o<e.length;o++){t=e[o];for(let e,o=0;o<t.length;o++)e=t[o],n[e]&&!r[e]&&(r[e]=1,i[i.length]=e)}return i}function J(t){this.l=!0!==t&&t,this.cache=v(),this.h=[]}function oa(t,e,n){C(t)&&(t=t.query);let r=this.cache.get(t);return r||(r=this.search(t,e,n),this.cache.set(t,r)),r}J.prototype.set=function(t,e){if(!this.cache[t]){var n=this.h.length;for(n===this.l?delete this.cache[this.h[n-1]]:n++,--n;0<n;n--)this.h[n]=this.h[n-1];this.h[0]=t}this.cache[t]=e},J.prototype.get=function(t){const e=this.cache[t];if(this.l&&e&&(t=this.h.indexOf(t))){const e=this.h[t-1];this.h[t-1]=this.h[t],this.h[t]=e}return e};const qa={memory:{charset:"latin:extra",D:3,B:4,m:!1},performance:{D:3,B:3,s:!1,context:{depth:2,D:1}},match:{charset:"latin:extra",G:"reverse"},score:{charset:"latin:advanced",D:20,B:3,context:{depth:3,D:9}},default:{}};function ra(t,e,n,r,i,o,s){setTimeout((function(){const u=t(n?n+"."+r:r,JSON.stringify(s));u&&u.then?u.then((function(){e.export(t,e,n,i,o+1)})):e.export(t,e,n,i,o+1)}))}function K(t,e){if(!(this instanceof K))return new K(t);var n;if(t){x(t)?t=qa[t]:(n=t.preset)&&(t=Object.assign({},n[n],t)),n=t.charset;var r=t.lang;x(n)&&(-1===n.indexOf(":")&&(n+=":default"),n=G[n]),x(r)&&(r=ka[r])}else t={};let i,o,s=t.context||{};if(this.encode=t.encode||n&&n.encode||ia,this.register=e||v(),this.D=i=t.resolution||9,this.G=e=n&&n.G||t.tokenize||"strict",this.depth="strict"===e&&s.depth,this.l=u(s.bidirectional),this.s=o=u(t.optimize),this.m=u(t.fastupdate),this.B=t.minlength||1,this.C=t.boost,this.map=o?aa(i):v(),this.A=i=s.resolution||1,this.h=o?aa(i):v(),this.F=n&&n.F||t.rtl,this.H=(e=t.matcher||r&&r.H)&&fa(e,!1),this.J=(e=t.stemmer||r&&r.J)&&fa(e,!0),n=e=t.filter||r&&r.filter){n=e,r=v();for(let t=0,e=n.length;t<e;t++)r[n[t]]=1;n=r}this.filter=n,this.cache=(e=t.cache)&&new J(e)}function L(t,e,n,r,i){return n&&1<t?e+(r||0)<=t?n+(i||0):(t-1)/(e+(r||0))*(n+(i||0))+1|0:0}function M(t,e,n,r,i,o,s){let u=s?t.h:t.map;(!e[n]||s&&!e[n][s])&&(t.s&&(u=u[r]),s?((e=e[n]||(e[n]=v()))[s]=1,u=u[s]||(u[s]=v())):e[n]=1,u=u[n]||(u[n]=[]),t.s||(u=u[r]||(u[r]=[])),o&&u.includes(i)||(u[u.length]=i,t.m&&((t=t.register[i]||(t.register[i]=[]))[t.length]=u)))}function sa(t,e,n,r,i,o,s,u){let c=[],a=u?t.h:t.map;if(t.s||(a=ua(a,s,u,t.l)),a){let n=0;const f=Math.min(a.length,u?t.A:t.D);for(let e,l,h=0,d=0;h<f&&!((e=a[h])&&(t.s&&(e=ua(e,s,u,t.l)),i&&e&&o&&(l=e.length,l<=i?(i-=l,e=null):(e=e.slice(i),i=0)),e&&(c[n++]=e,o&&(d+=e.length,d>=r))));h++);if(n)return o?ta(c,r,0):void(e[e.length]=c)}return!n&&c}function ta(t,e,n){return t=1===t.length?t[0]:[].concat.apply([],t),n||t.length>e?t.slice(n,n+e):t}function ua(t,e,n,r){return n?t=(t=t[(r=r&&e>n)?e:n])&&t[r?n:e]:t=t[e],t}function N(t,e,n,r,i){let o=0;if(t.constructor===Array)if(i)-1!==(e=t.indexOf(e))?1<t.length&&(t.splice(e,1),o++):o++;else{i=Math.min(t.length,n);for(let s,u=0;u<i;u++)(s=t[u])&&(o=N(s,e,n,r,i),r||o||delete t[u])}else for(let s in t)(o=N(t[s],e,n,r,i))||delete t[s];return o}function va(t){t=t.data;var e=self.p;const n=t.args;var r=t.task;if("init"===r)r=t.options||{},t=t.factory,e=r.encode,r.cache=!1,e&&0===e.indexOf("function")&&(r.encode=Function("return "+e)()),t?(Function("return "+t)()(self),self.p=new self.FlexSearch.Index(r),delete self.FlexSearch):self.p=new K(r);else t=t.id,e=e[r].apply(e,n),postMessage("search"===r?{id:t,msg:e}:{id:t})}t=K.prototype,t.append=function(t,e){return this.add(t,e,!0)},t.add=function(t,e,n,r){if(e&&(t||0===t)){if(!r&&!n&&this.register[t])return this.update(t,e);if(r=(e=this.encode(e)).length){const a=v(),f=v(),l=this.depth,h=this.D;for(let d=0;d<r;d++){let y=e[this.F?r-1-d:d];var i=y.length;if(y&&i>=this.B&&(l||!f[y])){var o=L(h,r,d),s="";switch(this.G){case"full":if(2<i){for(o=0;o<i;o++)for(var u=i;u>o;u--)if(u-o>=this.B){var c=L(h,r,d,i,o);M(this,f,s=y.substring(o,u),c,t,n)}break}case"reverse":if(1<i){for(u=i-1;0<u;u--)(s=y[u]+s).length>=this.B&&M(this,f,s,L(h,r,d,i,u),t,n);s=""}case"forward":if(1<i){for(u=0;u<i;u++)(s+=y[u]).length>=this.B&&M(this,f,s,o,t,n);break}default:if(this.C&&(o=Math.min(o/this.C(e,y,d)|0,h-1)),M(this,f,y,o,t,n),l&&1<r&&d<r-1)for(i=v(),s=this.A,o=y,u=Math.min(l+1,r-d),i[o]=1,c=1;c<u;c++)if((y=e[this.F?r-1-d-c:d+c])&&y.length>=this.B&&!i[y]){i[y]=1;const e=this.l&&y>o;M(this,a,e?o:y,L(s+(r/2>s?0:1),r,d,u-1,c-1),t,n,e?y:o)}}}}this.m||(this.register[t]=1)}}return this},t.search=function(t,e,n){n||(!e&&C(t)?t=(n=t).query:C(e)&&(n=e));let r,i,o,s,u,c=[],a=0;if(n){t=n.query||t,e=n.limit,a=n.offset||0;var f=n.context;i=n.suggest}if(t&&(r=(t=this.encode(""+t)).length,1<r)){n=v();var l=[];for(let e,o=0,s=0;o<r;o++)if((e=t[o])&&e.length>=this.B&&!n[e]){if(!(this.s||i||this.map[e]))return c;l[s++]=e,n[e]=1}r=(t=l).length}if(!r)return c;for(e||(e=100),n=0,(f=this.depth&&1<r&&!1!==f)?(o=t[0],n=1):1<r&&t.sort(ba);n<r;n++){if(u=t[n],f?(s=sa(this,c,i,e,a,2===r,u,o),i&&!1===s&&c.length||(o=u)):s=sa(this,c,i,e,a,1===r,u),s)return s;if(i&&n===r-1){if(!(l=c.length)){if(f){f=0,n=-1;continue}return c}if(1===l)return ta(c[0],e,a)}}return ma(c,e,a,i)},t.contain=function(t){return!!this.register[t]},t.update=function(t,e){return this.remove(t).add(t,e)},t.remove=function(t,e){const n=this.register[t];if(n){if(this.m)for(let e,r=0;r<n.length;r++)e=n[r],e.splice(e.indexOf(t),1);else N(this.map,t,this.D,this.s),this.depth&&N(this.h,t,this.A,this.s);if(e||delete this.register[t],this.cache){e=this.cache;for(let n,r,i=0;i<e.h.length;i++)r=e.h[i],n=e.cache[r],n.includes(t)&&(e.h.splice(i--,1),delete e.cache[r])}}return this},t.searchCache=oa,t.export=function(t,e,n,r,i){let o,s;switch(i||(i=0)){case 0:if(o="reg",this.m){s=v();for(let t in this.register)s[t]=1}else s=this.register;break;case 1:o="cfg",s={doc:0,opt:this.s?1:0};break;case 2:o="map",s=this.map;break;case 3:o="ctx",s=this.h;break;default:return}return ra(t,e||this,n,o,r,i,s),!0},t.import=function(t,e){if(e)switch(x(e)&&(e=JSON.parse(e)),t){case"cfg":this.s=!!e.opt;break;case"reg":this.m=!1,this.register=e;break;case"map":this.map=e;break;case"ctx":this.h=e}},la(K.prototype);let wa=0;function O(t){if(!(this instanceof O))return new O(t);var e;t?D(e=t.encode)&&(t.encode=e.toString()):t={},(e=(self||window).t)&&(e=e.toString());const n="undefined"==typeof window&&self.exports,r=this;this.o=xa(e,n,t.worker),this.h=v(),this.o&&(n?this.o.on("message",(function(t){r.h[t.id](t.msg),delete r.h[t.id]})):this.o.onmessage=function(t){t=t.data,r.h[t.id](t.msg),delete r.h[t.id]},this.o.postMessage({task:"init",factory:e,options:t}))}function P(t){O.prototype[t]=O.prototype[t+"Async"]=function(){const e=this,n=[].slice.call(arguments);var r=n[n.length-1];let i;return D(r)&&(i=r,n.splice(n.length-1,1)),r=new Promise((function(r){setTimeout((function(){e.h[++wa]=r,e.o.postMessage({task:t,id:wa,args:n})}))})),i?(r.then(i),this):r}}function xa(a,b,c){let d;try{d=b?eval('new (require("worker_threads")["Worker"])("../dist/node/node.js")'):a?new Worker(URL.createObjectURL(new Blob(["onmessage="+va.toString()],{type:"text/javascript"}))):new Worker(x(c)?c:"worker/worker.js",{type:"module"})}catch(t){}return d}function Q(t){if(!(this instanceof Q))return new Q(t);var e,n=t.document||t.doc||t;this.K=[],this.h=[],this.A=[],this.register=v(),this.key=(e=n.key||n.id)&&S(e,this.A)||"id",this.m=u(t.fastupdate),this.C=(e=n.store)&&!0!==e&&[],this.store=e&&v(),this.I=(e=n.tag)&&S(e,this.A),this.l=e&&v(),this.cache=(e=t.cache)&&new J(e),t.cache=!1,this.o=t.worker,this.async=!1,e=v();let r=n.index||n.field||n;x(r)&&(r=[r]);for(let n,i,o=0;o<r.length;o++)n=r[o],x(n)||(i=n,n=n.field),i=C(i)?Object.assign({},t,i):t,this.o&&(e[n]=new O(i),e[n].o||(this.o=!1)),this.o||(e[n]=new K(i,this.register)),this.K[o]=S(n,this.A),this.h[o]=n;if(this.C)for(x(t=n.store)&&(t=[t]),n=0;n<t.length;n++)this.C[n]=S(t[n],this.A);this.index=e}function S(t,e){const n=t.split(":");let r=0;for(let i=0;i<n.length;i++)0<=(t=n[i]).indexOf("[]")&&(t=t.substring(0,t.length-2))&&(e[r]=!0),t&&(n[r++]=t);return r<n.length&&(n.length=r),1<r?n:n[0]}function T(t,e){if(x(e))t=t[e];else for(let n=0;t&&n<e.length;n++)t=t[e[n]];return t}function U(t,e,n,r,i){if(t=t[i],r===n.length-1)e[i]=t;else if(t)if(t.constructor===Array)for(e=e[i]=Array(t.length),i=0;i<t.length;i++)U(t,e,n,r,i);else e=e[i]||(e[i]=v()),i=n[++r],U(t,e,n,r,i)}function V(t,e,n,r,i,o,s,u){if(t=t[s])if(r===e.length-1){if(t.constructor===Array){if(n[r]){for(e=0;e<t.length;e++)i.add(o,t[e],!0,!0);return}t=t.join(" ")}i.add(o,t,u,!0)}else if(t.constructor===Array)for(s=0;s<t.length;s++)V(t,e,n,r,i,o,s,u);else s=e[++r],V(t,e,n,r,i,o,s,u)}function ya(t,e,n,r){let i=this.l[t],o=i&&i.length-n;if(o&&0<o)return(o>e||n)&&(i=i.slice(n,n+e)),r&&(i=za.call(this,i)),{tag:t,result:i}}function za(t){const e=Array(t.length);for(let n,r=0;r<t.length;r++)n=t[r],e[r]={id:n,doc:this.store[n]};return e}P("add"),P("append"),P("search"),P("update"),P("remove"),t=Q.prototype,t.add=function(t,e,n){if(C(t)&&(t=T(e=t,this.key)),e&&(t||0===t)){if(!n&&this.register[t])return this.update(t,e);for(let r,i,o=0;o<this.h.length;o++)i=this.h[o],r=this.K[o],x(r)&&(r=[r]),V(e,r,this.A,0,this.index[i],t,r[0],n);if(this.I){let r=T(e,this.I),i=v();x(r)&&(r=[r]);for(let e,o,s=0;s<r.length;s++)if(e=r[s],!i[e]&&(i[e]=1,o=this.l[e]||(this.l[e]=[]),!n||!o.includes(t))&&(o[o.length]=t,this.m)){const e=this.register[t]||(this.register[t]=[]);e[e.length]=o}}if(this.store&&(!n||!this.store[t])){let n;if(this.C){n=v();for(let t,r=0;r<this.C.length;r++)t=this.C[r],x(t)?n[t]=e[t]:U(e,n,t,0,t[0])}this.store[t]=n||e}}return this},t.append=function(t,e){return this.add(t,e,!0)},t.update=function(t,e){return this.remove(t).add(t,e)},t.remove=function(t){if(C(t)&&(t=T(t,this.key)),this.register[t]){for(var e=0;e<this.h.length&&(this.index[this.h[e]].remove(t,!this.o),!this.m);e++);if(this.I&&!this.m)for(let n in this.l){const r=(e=this.l[n]).indexOf(t);-1!==r&&(1<e.length?e.splice(r,1):delete this.l[n])}this.store&&delete this.store[t],delete this.register[t]}return this},t.search=function(t,e,n,r){n||(!e&&C(t)?(n=t,t=""):C(e)&&(n=e,e=0));let i,o,s,u,c,a,f=[],l=[],h=0;if(n)if(n.constructor===Array)s=n,n=null;else{if(t=n.query||t,s=(i=n.pluck)||n.index||n.field,u=n.tag,o=this.store&&n.enrich,c="and"===n.bool,e=n.limit||e||100,a=n.offset||0,u&&(x(u)&&(u=[u]),!t)){for(let t,n=0;n<u.length;n++)(t=ya.call(this,u[n],e,a,o))&&(f[f.length]=t,h++);return h?f:[]}x(s)&&(s=[s])}s||(s=this.h),c=c&&(1<s.length||u&&1<u.length);const d=!r&&(this.o||this.async)&&[];for(let i,o,v,y=0;y<s.length;y++){let p;if(o=s[y],x(o)||(p=o,o=p.field,t=p.query||t,e=p.limit||e),d)d[y]=this.index[o].searchAsync(t,e,p||n);else{if(i=r?r[y]:this.index[o].search(t,e,p||n),v=i&&i.length,u&&v){const t=[];let n=0;c&&(t[0]=[i]);for(let e,r,i=0;i<u.length;i++)e=u[i],(v=(r=this.l[e])&&r.length)&&(n++,t[t.length]=c?[r]:r);n&&(i=c?ma(t,e||100,a||0):na(i,t),v=i.length)}if(v)l[h]=o,f[h++]=i;else if(c)return[]}}if(d){const r=this;return new Promise((function(i){Promise.all(d).then((function(o){i(r.search(t,e,n,o))}))}))}if(!h)return[];if(i&&(!o||!this.store))return f[0];for(let t,e=0;e<l.length;e++){if(t=f[e],t.length&&o&&(t=za.call(this,t)),i)return t;f[e]={field:l[e],result:t}}return f},t.contain=function(t){return!!this.register[t]},t.get=function(t){return this.store[t]},t.set=function(t,e){return this.store[t]=e,this},t.searchCache=oa,t.export=function(t,e,n,r,i){if(i||(i=0),r||(r=0),r<this.h.length){const n=this.h[r],o=this.index[n];e=this,setTimeout((function(){o.export(t,e,i?n:"",r,i++)||(r++,i=1,e.export(t,e,n,r,i))}))}else{let e,o;switch(i){case 1:e="tag",o=this.l;break;case 2:e="store",o=this.store;break;default:return}ra(t,this,n,e,r,i,o)}},t.import=function(t,e){if(e)switch(x(e)&&(e=JSON.parse(e)),t){case"tag":this.l=e;break;case"reg":this.m=!1,this.register=e;for(let t,n=0;n<this.h.length;n++)t=this.index[this.h[n]],t.register=e,t.m=!1;break;case"store":this.store=e;break;default:const n=(t=t.split("."))[0];t=t[1],n&&t&&this.index[n].import(t,e)}},la(Q.prototype);var Ba={encode:Aa,F:!1,G:""};const Ca=[F("[àáâãäå]"),"a",F("[èéêë]"),"e",F("[ìíîï]"),"i",F("[òóôõöő]"),"o",F("[ùúûüű]"),"u",F("[ýŷÿ]"),"y",F("ñ"),"n",F("[çc]"),"k",F("ß"),"s",F(" & ")," and "];function Aa(t){var e=t=""+t;return e.normalize&&(e=e.normalize("NFD").replace(ea,"")),ca.call(this,e.toLowerCase(),!t.normalize&&Ca)}var Ea={encode:Da,F:!1,G:"strict"};const Fa=/[^a-z0-9]+/,Ga={b:"p",v:"f",w:"f",z:"s",x:"s",ß:"s",d:"t",n:"m",c:"k",g:"k",j:"k",q:"k",i:"e",y:"e",u:"o"};function Da(t){const e=[];if(t=Aa.call(this,t).join(" ")){const n=t.split(Fa),r=n.length;for(let i,o=0,s=0;o<r;o++)if((t=n[o])&&(!this.filter||!this.filter[t])){i=t[0];let n=Ga[i]||i,r=n;for(let e=1;e<t.length;e++){i=t[e];const o=Ga[i]||i;o&&o!==r&&(n+=o,r=o)}e[s++]=n}}return e}var Ia={encode:Ha,F:!1,G:""};const Ja=[F("ae"),"a",F("oe"),"o",F("sh"),"s",F("th"),"t",F("ph"),"f",F("pf"),"f",F("(?![aeo])h(?![aeo])"),"",F("(?!^[aeo])h(?!^[aeo])"),""];function Ha(t,e){return t&&(2<(t=Da.call(this,t).join(" ")).length&&(t=E(t,Ja)),e||(1<t.length&&(t=ha(t)),t&&(t=t.split(" ")))),t||[]}var La={encode:Ka,F:!1,G:""};const Ma=F("(?!\\b)[aeo]");function Ka(t){return t&&(1<(t=Ha.call(this,t,!0)).length&&(t=t.replace(Ma,"")),1<t.length&&(t=ha(t)),t&&(t=t.split(" "))),t||[]}G["latin:default"]=ja,G["latin:simple"]=Ba,G["latin:balance"]=Ea,G["latin:advanced"]=Ia,G["latin:extra"]=La;const W=self;let Y;const Z={Index:K,Document:Q,Worker:O,registerCharset:function(t,e){G[t]=e},registerLanguage:function(t,e){ka[t]=e}};(Y=W.define)&&Y.amd?Y([],(function(){return Z})):W.exports?W.exports=Z:W.FlexSearch=Z}(this)}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var n=__webpack_module_cache__[t]={id:t,loaded:!1,exports:{}};return __webpack_modules__[t].call(n.exports,n,n.exports,__webpack_require__),n.loaded=!0,n.exports}__webpack_require__.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return __webpack_require__.d(e,{a:e}),e},__webpack_require__.d=(t,e)=>{for(var n in e)__webpack_require__.o(e,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var __webpack_exports__={};(()=>{"use strict";__webpack_require__.d(__webpack_exports__,{e:()=>Iu});var t=__webpack_require__(1235);function e(){const e=t.n2,n=e.crypto||e.msCrypto;if(n&&n.randomUUID)return n.randomUUID().replace(/-/g,"");const r=n&&n.getRandomValues?()=>n.getRandomValues(new Uint8Array(1))[0]:()=>16*Math.random();return([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,(t=>(t^(15&r())>>t/4).toString(16)))}var n=__webpack_require__(1170);const r=["debug","info","warn","error","log","assert","trace"];function i(e){if(!("console"in t.n2))return e();const n=t.n2.console,i={};r.forEach((t=>{const e=n[t]&&n[t].__sentry_original__;t in n&&e&&(i[t]=n[t],n[t]=e)}));try{return e()}finally{Object.keys(i).forEach((t=>{n[t]=i[t]}))}}function o(){let e=!1;const n={enable:()=>{e=!0},disable:()=>{e=!1}};return"undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__?r.forEach((r=>{n[r]=(...n)=>{e&&i((()=>{t.n2.console[r](`Sentry Logger [${r}]:`,...n)}))}})):r.forEach((t=>{n[t]=()=>{}})),n}let s;s="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__?(0,t.YO)("logger",o):o();var u=__webpack_require__(2176);const c=Object.prototype.toString;function a(t,e){return c.call(t)===`[object ${e}]`}function f(t){return a(t,"Object")}function l(t){return Boolean(t&&t.then&&"function"==typeof t.then)}var h;!function(t){t[t.PENDING=0]="PENDING";t[t.RESOLVED=1]="RESOLVED";t[t.REJECTED=2]="REJECTED"}(h||(h={}));class d{__init(){this._=h.PENDING}__init2(){this.k=[]}constructor(t){d.prototype.__init.call(this),d.prototype.__init2.call(this),d.prototype.__init3.call(this),d.prototype.__init4.call(this),d.prototype.__init5.call(this),d.prototype.__init6.call(this);try{t(this.S,this.O)}catch(t){this.O(t)}}then(t,e){return new d(((n,r)=>{this.k.push([!1,e=>{if(t)try{n(t(e))}catch(t){r(t)}else n(e)},t=>{if(e)try{n(e(t))}catch(t){r(t)}else r(t)}]),this.T()}))}catch(t){return this.then((t=>t),t)}finally(t){return new d(((e,n)=>{let r,i;return this.then((e=>{i=!1,r=e,t&&t()}),(e=>{i=!0,r=e,t&&t()})).then((()=>{i?n(r):e(r)}))}))}__init3(){this.S=t=>{this.P(h.RESOLVED,t)}}__init4(){this.O=t=>{this.P(h.REJECTED,t)}}__init5(){this.P=(t,e)=>{this._===h.PENDING&&(l(e)?e.then(this.S,this.O):(this._=t,this.R=e,this.T()))}}__init6(){this.T=()=>{if(this._===h.PENDING)return;const t=this.k.slice();this.k=[],t.forEach((t=>{t[0]||(this._===h.RESOLVED&&t[1](this.R),this._===h.REJECTED&&t[2](this.R),t[0]=!0)}))}}}function v(t){return y(t,new Map)}function y(t,e){if(f(t)){const n=e.get(t);if(void 0!==n)return n;const r={};e.set(t,r);for(const n of Object.keys(t))void 0!==t[n]&&(r[n]=y(t[n],e));return r}if(Array.isArray(t)){const n=e.get(t);if(void 0!==n)return n;const r=[];return e.set(t,r),t.forEach((t=>{r.push(y(t,e))})),r}return t}function p(t){const r=(0,n.ph)(),i={sid:e(),init:!0,timestamp:r,started:r,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>function(t){return v({sid:`${t.sid}`,init:t.init,started:new Date(1e3*t.started).toISOString(),timestamp:new Date(1e3*t.timestamp).toISOString(),status:t.status,errors:t.errors,did:"number"==typeof t.did||"string"==typeof t.did?`${t.did}`:void 0,duration:t.duration,attrs:{release:t.release,environment:t.environment,ip_address:t.ipAddress,user_agent:t.userAgent}})}(i)};return t&&m(i,t),i}function m(t,r={}){if(r.user&&(!t.ipAddress&&r.user.ip_address&&(t.ipAddress=r.user.ip_address),t.did||r.did||(t.did=r.user.id||r.user.email||r.user.username)),t.timestamp=r.timestamp||(0,n.ph)(),r.ignoreDuration&&(t.ignoreDuration=r.ignoreDuration),r.sid&&(t.sid=32===r.sid.length?r.sid:e()),void 0!==r.init&&(t.init=r.init),!t.did&&r.did&&(t.did=`${r.did}`),"number"==typeof r.started&&(t.started=r.started),t.ignoreDuration)t.duration=void 0;else if("number"==typeof r.duration)t.duration=r.duration;else{const e=t.timestamp-t.started;t.duration=e>=0?e:0}r.release&&(t.release=r.release),r.environment&&(t.environment=r.environment),!t.ipAddress&&r.ipAddress&&(t.ipAddress=r.ipAddress),!t.userAgent&&r.userAgent&&(t.userAgent=r.userAgent),"number"==typeof r.errors&&(t.errors=r.errors),r.status&&(t.status=r.status)}class w{constructor(){this.N=!1,this.U=[],this.M=[],this.L=[],this.$=[],this.W={},this.V={},this.Y={},this.X={},this.Z={}}static clone(t){const e=new w;return t&&(e.L=[...t.L],e.V={...t.V},e.Y={...t.Y},e.X={...t.X},e.W=t.W,e.tt=t.tt,e.et=t.et,e.nt=t.nt,e.rt=t.rt,e.it=t.it,e.M=[...t.M],e.ot=t.ot,e.$=[...t.$]),e}addScopeListener(t){this.U.push(t)}addEventProcessor(t){return this.M.push(t),this}setUser(t){return this.W=t||{},this.nt&&m(this.nt,{user:t}),this.st(),this}getUser(){return this.W}getRequestSession(){return this.ot}setRequestSession(t){return this.ot=t,this}setTags(t){return this.V={...this.V,...t},this.st(),this}setTag(t,e){return this.V={...this.V,[t]:e},this.st(),this}setExtras(t){return this.Y={...this.Y,...t},this.st(),this}setExtra(t,e){return this.Y={...this.Y,[t]:e},this.st(),this}setFingerprint(t){return this.it=t,this.st(),this}setLevel(t){return this.tt=t,this.st(),this}setTransactionName(t){return this.rt=t,this.st(),this}setContext(t,e){return null===e?delete this.X[t]:this.X[t]=e,this.st(),this}setSpan(t){return this.et=t,this.st(),this}getSpan(){return this.et}getTransaction(){const t=this.getSpan();return t&&t.transaction}setSession(t){return t?this.nt=t:delete this.nt,this.st(),this}getSession(){return this.nt}update(t){if(!t)return this;if("function"==typeof t){const e=t(this);return e instanceof w?e:this}return t instanceof w?(this.V={...this.V,...t.V},this.Y={...this.Y,...t.Y},this.X={...this.X,...t.X},t.W&&Object.keys(t.W).length&&(this.W=t.W),t.tt&&(this.tt=t.tt),t.it&&(this.it=t.it),t.ot&&(this.ot=t.ot)):f(t)&&(this.V={...this.V,...t.tags},this.Y={...this.Y,...t.extra},this.X={...this.X,...t.contexts},t.user&&(this.W=t.user),t.level&&(this.tt=t.level),t.fingerprint&&(this.it=t.fingerprint),t.requestSession&&(this.ot=t.requestSession)),this}clear(){return this.L=[],this.V={},this.Y={},this.W={},this.X={},this.tt=void 0,this.rt=void 0,this.it=void 0,this.ot=void 0,this.et=void 0,this.nt=void 0,this.st(),this.$=[],this}addBreadcrumb(t,e){const r="number"==typeof e?e:100;if(r<=0)return this;const i={timestamp:(0,n.yW)(),...t};return this.L=[...this.L,i].slice(-r),this.st(),this}clearBreadcrumbs(){return this.L=[],this.st(),this}addAttachment(t){return this.$.push(t),this}getAttachments(){return this.$}clearAttachments(){return this.$=[],this}applyToEvent(t,e={}){if(this.Y&&Object.keys(this.Y).length&&(t.extra={...this.Y,...t.extra}),this.V&&Object.keys(this.V).length&&(t.tags={...this.V,...t.tags}),this.W&&Object.keys(this.W).length&&(t.user={...this.W,...t.user}),this.X&&Object.keys(this.X).length&&(t.contexts={...this.X,...t.contexts}),this.tt&&(t.level=this.tt),this.rt&&(t.transaction=this.rt),this.et){t.contexts={trace:this.et.getTraceContext(),...t.contexts};const e=this.et.transaction&&this.et.transaction.name;e&&(t.tags={transaction:e,...t.tags})}return this.ut(t),t.breadcrumbs=[...t.breadcrumbs||[],...this.L],t.breadcrumbs=t.breadcrumbs.length>0?t.breadcrumbs:void 0,t.sdkProcessingMetadata={...t.sdkProcessingMetadata,...this.Z},this.ct([...b(),...this.M],t,e)}setSDKProcessingMetadata(t){return this.Z={...this.Z,...t},this}ct(t,e,n,r=0){return new d(((i,o)=>{const u=t[r];if(null===e||"function"!=typeof u)i(e);else{const c=u({...e},n);("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&u.id&&null===c&&s.log(`Event processor "${u.id}" dropped event`),l(c)?c.then((e=>this.ct(t,e,n,r+1).then(i))).then(null,o):this.ct(t,c,n,r+1).then(i).then(null,o)}}))}st(){this.N||(this.N=!0,this.U.forEach((t=>{t(this)})),this.N=!1)}ut(t){var e;t.fingerprint=t.fingerprint?(e=t.fingerprint,Array.isArray(e)?e:[e]):[],this.it&&(t.fingerprint=t.fingerprint.concat(this.it)),t.fingerprint&&!t.fingerprint.length&&delete t.fingerprint}}function b(){return(0,t.YO)("globalEventProcessors",(()=>[]))}const g=100;class _{__init(){this.ft=[{}]}constructor(t,e=new w,n=4){this.lt=n,_.prototype.__init.call(this),this.getStackTop().scope=e,t&&this.bindClient(t)}isOlderThan(t){return this.lt<t}bindClient(t){this.getStackTop().client=t,t&&t.setupIntegrations&&t.setupIntegrations()}pushScope(){const t=w.clone(this.getScope());return this.getStack().push({client:this.getClient(),scope:t}),t}popScope(){return!(this.getStack().length<=1)&&!!this.getStack().pop()}withScope(t){const e=this.pushScope();try{t(e)}finally{this.popScope()}}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getStack(){return this.ft}getStackTop(){return this.ft[this.ft.length-1]}captureException(t,n){const r=this.ht=n&&n.event_id?n.event_id:e(),i=new Error("Sentry syntheticException");return this.dt(((e,o)=>{e.captureException(t,{originalException:t,syntheticException:i,...n,event_id:r},o)})),r}captureMessage(t,n,r){const i=this.ht=r&&r.event_id?r.event_id:e(),o=new Error(t);return this.dt(((e,s)=>{e.captureMessage(t,n,{originalException:t,syntheticException:o,...r,event_id:i},s)})),i}captureEvent(t,n){const r=n&&n.event_id?n.event_id:e();return"transaction"!==t.type&&(this.ht=r),this.dt(((e,i)=>{e.captureEvent(t,{...n,event_id:r},i)})),r}lastEventId(){return this.ht}addBreadcrumb(t,e){const{scope:r,client:o}=this.getStackTop();if(!r||!o)return;const{beforeBreadcrumb:s=null,maxBreadcrumbs:u=g}=o.getOptions&&o.getOptions()||{};if(u<=0)return;const c={timestamp:(0,n.yW)(),...t},a=s?i((()=>s(c,e))):c;null!==a&&r.addBreadcrumb(a,u)}setUser(t){const e=this.getScope();e&&e.setUser(t)}setTags(t){const e=this.getScope();e&&e.setTags(t)}setExtras(t){const e=this.getScope();e&&e.setExtras(t)}setTag(t,e){const n=this.getScope();n&&n.setTag(t,e)}setExtra(t,e){const n=this.getScope();n&&n.setExtra(t,e)}setContext(t,e){const n=this.getScope();n&&n.setContext(t,e)}configureScope(t){const{scope:e,client:n}=this.getStackTop();e&&n&&t(e)}run(t){const e=E(this);try{t(this)}finally{E(e)}}getIntegration(t){const e=this.getClient();if(!e)return null;try{return e.getIntegration(t)}catch(e){return("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&s.warn(`Cannot retrieve integration ${t.id} from the current Hub`),null}}startTransaction(t,e){return this.vt("startTransaction",t,e)}traceHeaders(){return this.vt("traceHeaders")}captureSession(t=!1){if(t)return this.endSession();this.yt()}endSession(){const t=this.getStackTop(),e=t&&t.scope,n=e&&e.getSession();n&&function(t,e){let n={};e?n={status:e}:"ok"===t.status&&(n={status:"exited"}),m(t,n)}(n),this.yt(),e&&e.setSession()}startSession(e){const{scope:n,client:r}=this.getStackTop(),{release:i,environment:o}=r&&r.getOptions()||{},{userAgent:s}=t.n2.navigator||{},u=p({release:i,environment:o,...n&&{user:n.getUser()},...s&&{userAgent:s},...e});if(n){const t=n.getSession&&n.getSession();t&&"ok"===t.status&&m(t,{status:"exited"}),this.endSession(),n.setSession(u)}return u}shouldSendDefaultPii(){const t=this.getClient(),e=t&&t.getOptions();return Boolean(e&&e.sendDefaultPii)}yt(){const{scope:t,client:e}=this.getStackTop();if(!t)return;const n=t.getSession();n&&e&&e.captureSession&&e.captureSession(n)}dt(t){const{scope:e,client:n}=this.getStackTop();n&&t(n,e)}vt(t,...e){const n=k().__SENTRY__;if(n&&n.extensions&&"function"==typeof n.extensions[t])return n.extensions[t].apply(this,e);("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&s.warn(`Extension method ${t} couldn't be found, doing nothing.`)}}function k(){return t.n2.__SENTRY__=t.n2.__SENTRY__||{extensions:{},hub:void 0},t.n2}function E(t){const e=k(),n=T(e);return I(e,t),n}function S(){const t=k();return O(t)&&!T(t).isOlderThan(4)||I(t,new _),(0,u.KV)()?function(t){try{const e=k().__SENTRY__,n=e&&e.extensions&&e.extensions.domain&&e.extensions.domain.active;if(!n)return T(t);if(!O(n)||T(n).isOlderThan(4)){const e=T(t).getStackTop();I(n,new _(e.client,w.clone(e.scope)))}return T(n)}catch(e){return T(t)}}(t):T(t)}function O(t){return!!(t&&t.__SENTRY__&&t.__SENTRY__.hub)}function T(e){return(0,t.YO)("hub",(()=>new _),e)}function I(t,e){if(!t)return!1;return(t.__SENTRY__=t.__SENTRY__||{}).hub=e,!0}function A(t,e){return S().captureException(t,{captureContext:e})}function j(t,e){const n="string"==typeof e?e:void 0,r="string"!=typeof e?{captureContext:e}:void 0;return S().captureMessage(t,n,r)}function P(t){S().addBreadcrumb(t)}let C={UNIVERSAL_CONTEXT:!1,LOG_MUTATIONS:!1,GDOCS_CACHING:!0,DEV_SENTRY:!1,OVERRIDE_TYPEAHEAD_URL:void 0,DEBUG:!1,BASE_URL:"https://api.hyperwriteai.com/",LOG_TIMES:!1,TEST_MODE:!1,MULTIPLE_MODELS:!1,FOCUS_AND_VOTING:!0};const x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,R=Object.keys,D=Array.isArray;function N(t,e){return"object"!=typeof e||R(e).forEach((function(n){t[n]=e[n]})),t}"undefined"==typeof Promise||x.Promise||(x.Promise=Promise);const B=Object.getPrototypeOf,G={}.hasOwnProperty;function U(t,e){return G.call(t,e)}function F(t,e){"function"==typeof e&&(e=e(B(t))),("undefined"==typeof Reflect?R:Reflect.ownKeys)(e).forEach((n=>{L(t,n,e[n])}))}const M=Object.defineProperty;function L(t,e,n,r){M(t,e,N(n&&U(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function q(t){return{from:function(e){return t.prototype=Object.create(e.prototype),L(t.prototype,"constructor",t),{extend:F.bind(null,t.prototype)}}}}const H=Object.getOwnPropertyDescriptor;function K(t,e){let n;return H(t,e)||(n=B(t))&&K(n,e)}const $=[].slice;function z(t,e,n){return $.call(t,e,n)}function W(t,e){return e(t)}function J(t){if(!t)throw new Error("Assertion Failed")}function V(t){x.setImmediate?setImmediate(t):setTimeout(t,0)}function Y(t,e){return t.reduce(((t,n,r)=>{var i=e(n,r);return i&&(t[i[0]]=i[1]),t}),{})}function X(t,e){if(U(t,e))return t[e];if(!e)return t;if("string"!=typeof e){for(var n=[],r=0,i=e.length;r<i;++r){var o=X(t,e[r]);n.push(o)}return n}var s=e.indexOf(".");if(-1!==s){var u=t[e.substr(0,s)];return void 0===u?void 0:X(u,e.substr(s+1))}}function Q(t,e,n){if(t&&void 0!==e&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if("string"!=typeof e&&"length"in e){J("string"!=typeof n&&"length"in n);for(var r=0,i=e.length;r<i;++r)Q(t,e[r],n[r])}else{var o=e.indexOf(".");if(-1!==o){var s=e.substr(0,o),u=e.substr(o+1);if(""===u)void 0===n?D(t)&&!isNaN(parseInt(s))?t.splice(s,1):delete t[s]:t[s]=n;else{var c=t[s];c&&U(t,s)||(c=t[s]={}),Q(c,u,n)}}else void 0===n?D(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function Z(t){var e={};for(var n in t)U(t,n)&&(e[n]=t[n]);return e}const tt=[].concat;function et(t){return tt.apply([],t)}const nt="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(et([8,16,32,64].map((t=>["Int","Uint","Float"].map((e=>e+t+"Array")))))).filter((t=>x[t])),rt=nt.map((t=>x[t]));Y(nt,(t=>[t,!0]));let it=null;function ot(t){it="undefined"!=typeof WeakMap&&new WeakMap;const e=st(t);return it=null,e}function st(t){if(!t||"object"!=typeof t)return t;let e=it&&it.get(t);if(e)return e;if(D(t)){e=[],it&&it.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(st(t[n]))}else if(rt.indexOf(t.constructor)>=0)e=t;else{const n=B(t);for(var i in e=n===Object.prototype?{}:Object.create(n),it&&it.set(t,e),t)U(t,i)&&(e[i]=st(t[i]))}return e}const{toString:ut}={};function ct(t){return ut.call(t).slice(8,-1)}const at="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",ft="symbol"==typeof at?function(t){var e;return null!=t&&(e=t[at])&&e.apply(t)}:function(){return null},lt={};function ht(t){var e,n,r,i;if(1===arguments.length){if(D(t))return t.slice();if(this===lt&&"string"==typeof t)return[t];if(i=ft(t)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==t)return[t];if("number"==typeof(e=t.length)){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}const dt="undefined"!=typeof Symbol?t=>"AsyncFunction"===t[Symbol.toStringTag]:()=>!1;var vt="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function yt(t,e){vt=t,pt=e}var pt=()=>!0;const mt=!new Error("").stack;function wt(){if(mt)try{throw wt.arguments,new Error}catch(t){return t}return new Error}function bt(t,e){var n=t.stack;return n?(e=e||0,0===n.indexOf(t.name)&&(e+=(t.name+t.message).split("\n").length),n.split("\n").slice(e).filter(pt).map((t=>"\n"+t)).join("")):""}var gt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],_t=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(gt),kt={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Et(t,e){this.wt=wt(),this.name=t,this.message=e}function St(t,e){return t+". Errors: "+Object.keys(e).map((t=>e[t].toString())).filter(((t,e,n)=>n.indexOf(t)===e)).join("\n")}function Ot(t,e,n,r){this.wt=wt(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=St(t,e)}function Tt(t,e){this.wt=wt(),this.name="BulkError",this.failures=Object.keys(e).map((t=>e[t])),this.failuresByPos=e,this.message=St(t,e)}q(Et).from(Error).extend({stack:{get:function(){return this.ft||(this.ft=this.name+": "+this.message+bt(this.wt,2))}},toString:function(){return this.name+": "+this.message}}),q(Ot).from(Et),q(Tt).from(Et);var It=_t.reduce(((t,e)=>(t[e]=e+"Error",t)),{});const At=Et;var jt=_t.reduce(((t,e)=>{var n=e+"Error";function r(t,r){this.wt=wt(),this.name=n,t?"string"==typeof t?(this.message=`${t}${r?"\n "+r:""}`,this.inner=r||null):"object"==typeof t&&(this.message=`${t.name} ${t.message}`,this.inner=t):(this.message=kt[e]||n,this.inner=null)}return q(r).from(At),t[e]=r,t}),{});jt.Syntax=SyntaxError,jt.Type=TypeError,jt.Range=RangeError;var Pt=gt.reduce(((t,e)=>(t[e+"Error"]=jt[e],t)),{}),Ct=_t.reduce(((t,e)=>(-1===["Syntax","Type","Range"].indexOf(e)&&(t[e+"Error"]=jt[e]),t)),{});function xt(){}function Rt(t){return t}function Dt(t,e){return null==t||t===Rt?e:function(n){return e(t(n))}}function Nt(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function Bt(t,e){return t===xt?e:function(){var n=t.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Nt(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Nt(i,this.onerror):i),void 0!==o?o:n}}function Gt(t,e){return t===xt?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Nt(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Nt(r,this.onerror):r)}}function Ut(t,e){return t===xt?e:function(n){var r=t.apply(this,arguments);N(n,r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Nt(i,this.onsuccess):i),o&&(this.onerror=this.onerror?Nt(o,this.onerror):o),void 0===r?void 0===s?void 0:s:N(r,s)}}function Ft(t,e){return t===xt?e:function(){return!1!==e.apply(this,arguments)&&t.apply(this,arguments)}}function Mt(t,e){return t===xt?e:function(){var n=t.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then((function(){return e.apply(r,o)}))}return e.apply(this,arguments)}}Ct.ModifyError=Ot,Ct.DexieError=Et,Ct.BulkError=Tt;var Lt={};const[qt,Ht,Kt]="undefined"==typeof Promise?[]:(()=>{let t=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[t,B(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,B(e),t]})(),$t=Ht&&Ht.then,zt=qt&&qt.constructor,Wt=!!Kt;var Jt=!1,Vt=Kt?()=>{Kt.then(we)}:x.setImmediate?setImmediate.bind(null,we):x.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver((()=>{we(),t=null})).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(we,0)},Yt=function(t,e){oe.push([t,e]),Qt&&(Vt(),Qt=!1)},Xt=!0,Qt=!0,Zt=[],te=[],ee=null,ne=Rt,re={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:qe,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((t=>{try{qe(t[0],t[1])}catch(t){}}))}},ie=re,oe=[],se=0,ue=[];function ce(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this.bt=[],this.onuncatched=xt,this.gt=!1;var e=this._t=ie;if(vt&&(this.kt=wt(),this.Et=null,this.St=0),"function"!=typeof t){if(t!==Lt)throw new TypeError("Not a function");return this._=arguments[1],this.R=arguments[2],void(!1===this._&&he(this,this.R))}this._=null,this.R=null,++e.ref,le(this,t)}const ae={get:function(){var t=ie,e=Ae;function n(n,r){var i=!t.global&&(t!==ie||e!==Ae);const o=i&&!xe();var s=new ce(((e,s)=>{ve(this,new fe(Me(n,t,i,o),Me(r,t,i,o),e,s,t))}));return vt&&me(s,this),s}return n.prototype=Lt,n},set:function(t){L(this,"then",t&&t.prototype===Lt?ae:{get:function(){return t},set:ae.set})}};function fe(t,e,n,r,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=r,this.psd=i}function le(t,e){try{e((e=>{if(null===t._){if(e===t)throw new TypeError("A promise cannot be resolved with itself.");var n=t.gt&&be();e&&"function"==typeof e.then?le(t,((t,n)=>{e instanceof ce?e.Ot(t,n):e.then(t,n)})):(t._=!0,t.R=e,de(t)),n&&ge()}}),he.bind(null,t))}catch(e){he(t,e)}}function he(t,e){if(te.push(e),null===t._){var n=t.gt&&be();e=ne(e),t._=!1,t.R=e,vt&&null!==e&&"object"==typeof e&&!e.Tt&&function(t,e,n){try{t.apply(null,void 0)}catch(t){}}((()=>{var n=K(e,"stack");e.Tt=t,L(e,"stack",{get:()=>Jt?n&&(n.get?n.get.apply(e):n.value):t.stack})})),function(t){Zt.some((e=>e.R===t.R))||Zt.push(t)}(t),de(t),n&&ge()}}function de(t){var e=t.bt;t.bt=[];for(var n=0,r=e.length;n<r;++n)ve(t,e[n]);var i=t._t;--i.ref||i.finalize(),0===se&&(++se,Yt((()=>{0==--se&&_e()}),[]))}function ve(t,e){if(null!==t._){var n=t._?e.onFulfilled:e.onRejected;if(null===n)return(t._?e.resolve:e.reject)(t.R);++e.psd.ref,++se,Yt(ye,[n,t,e])}else t.bt.push(e)}function ye(t,e,n){try{ee=e;var r,i=e.R;e._?r=t(i):(te.length&&(te=[]),r=t(i),-1===te.indexOf(i)&&function(t){for(var e=Zt.length;e;)if(Zt[--e].R===t.R)return void Zt.splice(e,1)}(e)),n.resolve(r)}catch(t){n.reject(t)}finally{ee=null,0==--se&&_e(),--n.psd.ref||n.psd.finalize()}}function pe(t,e,n){if(e.length===n)return e;var r="";if(!1===t._){var i,o,s=t.R;null!=s?(i=s.name||"Error",o=s.message||s,r=bt(s,0)):(i=s,o=""),e.push(i+(o?": "+o:"")+r)}return vt&&((r=bt(t.kt,2))&&-1===e.indexOf(r)&&e.push(r),t.Et&&pe(t.Et,e,n)),e}function me(t,e){var n=e?e.St+1:0;n<100&&(t.Et=e,t.St=n)}function we(){be()&&ge()}function be(){var t=Xt;return Xt=!1,Qt=!1,t}function ge(){var t,e,n;do{for(;oe.length>0;)for(t=oe,oe=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}}while(oe.length>0);Xt=!0,Qt=!0}function _e(){var t=Zt;Zt=[],t.forEach((t=>{t._t.onunhandled.call(null,t.R,t)}));for(var e=ue.slice(0),n=e.length;n;)e[--n]()}function ke(t){return new ce(Lt,!1,t)}function Ee(t,e){var n=ie;return function(){var r=be(),i=ie;try{return Be(n,!0),t.apply(this,arguments)}catch(t){e&&e(t)}finally{Be(i,!1),r&&ge()}}}F(ce.prototype,{then:ae,Ot:function(t,e){ve(this,new fe(null,null,t,e,ie))},catch:function(t){if(1===arguments.length)return this.then(null,t);var e=arguments[0],n=arguments[1];return"function"==typeof e?this.then(null,(t=>t instanceof e?n(t):ke(t))):this.then(null,(t=>t&&t.name===e?n(t):ke(t)))},finally:function(t){return this.then((e=>(t(),e)),(e=>(t(),ke(e))))},stack:{get:function(){if(this.ft)return this.ft;try{Jt=!0;var t=pe(this,[],20).join("\nFrom previous: ");return null!==this._&&(this.ft=t),t}finally{Jt=!1}}},timeout:function(t,e){return t<1/0?new ce(((n,r)=>{var i=setTimeout((()=>r(new jt.Timeout(e))),t);this.then(n,r).finally(clearTimeout.bind(null,i))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&L(ce.prototype,Symbol.toStringTag,"Dexie.Promise"),re.env=Ge(),F(ce,{all:function(){var t=ht.apply(null,arguments).map(Re);return new ce((function(e,n){0===t.length&&e([]);var r=t.length;t.forEach(((i,o)=>ce.resolve(i).then((n=>{t[o]=n,--r||e(t)}),n)))}))},resolve:t=>{if(t instanceof ce)return t;if(t&&"function"==typeof t.then)return new ce(((e,n)=>{t.then(e,n)}));var e=new ce(Lt,!0,t);return me(e,ee),e},reject:ke,race:function(){var t=ht.apply(null,arguments).map(Re);return new ce(((e,n)=>{t.map((t=>ce.resolve(t).then(e,n)))}))},PSD:{get:()=>ie,set:t=>ie=t},totalEchoes:{get:()=>Ae},newPSD:Pe,usePSD:Ue,scheduler:{get:()=>Yt,set:t=>{Yt=t}},rejectionMapper:{get:()=>ne,set:t=>{ne=t}},follow:(t,e)=>new ce(((n,r)=>Pe(((e,n)=>{var r=ie;r.unhandleds=[],r.onunhandled=n,r.finalize=Nt((function(){!function(t){ue.push((function e(){t(),ue.splice(ue.indexOf(e),1)})),++se,Yt((()=>{0==--se&&_e()}),[])}((()=>{0===this.unhandleds.length?e():n(this.unhandleds[0])}))}),r.finalize),t()}),e,n,r)))}),zt&&(zt.allSettled&&L(ce,"allSettled",(function(){const t=ht.apply(null,arguments).map(Re);return new ce((e=>{0===t.length&&e([]);let n=t.length;const r=new Array(n);t.forEach(((t,i)=>ce.resolve(t).then((t=>r[i]={status:"fulfilled",value:t}),(t=>r[i]={status:"rejected",reason:t})).then((()=>--n||e(r)))))}))})),zt.any&&"undefined"!=typeof AggregateError&&L(ce,"any",(function(){const t=ht.apply(null,arguments).map(Re);return new ce(((e,n)=>{0===t.length&&n(new AggregateError([]));let r=t.length;const i=new Array(r);t.forEach(((t,o)=>ce.resolve(t).then((t=>e(t)),(t=>{i[o]=t,--r||n(new AggregateError(i))}))))}))})));const Se={awaits:0,echoes:0,id:0};var Oe=0,Te=[],Ie=0,Ae=0,je=0;function Pe(t,e,n,r){var i=ie,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++je;var s=re.env;o.env=Wt?{Promise:ce,PromiseProp:{value:ce,configurable:!0,writable:!0},all:ce.all,race:ce.race,allSettled:ce.allSettled,any:ce.any,resolve:ce.resolve,reject:ce.reject,nthen:Le(s.nthen,o),gthen:Le(s.gthen,o)}:{},e&&N(o,e),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var u=Ue(o,t,n,r);return 0===o.ref&&o.finalize(),u}function Ce(){return Se.id||(Se.id=++Oe),++Se.awaits,Se.echoes+=100,Se.id}function xe(){return!!Se.awaits&&(0==--Se.awaits&&(Se.id=0),Se.echoes=100*Se.awaits,!0)}function Re(t){return Se.echoes&&t&&t.constructor===zt?(Ce(),t.then((t=>(xe(),t)),(t=>(xe(),He(t))))):t}function De(t){++Ae,Se.echoes&&0!=--Se.echoes||(Se.echoes=Se.id=0),Te.push(ie),Be(t,!0)}function Ne(){var t=Te[Te.length-1];Te.pop(),Be(t,!1)}function Be(t,e){var n=ie;if((e?!Se.echoes||Ie++&&t===ie:!Ie||--Ie&&t===ie)||Fe(e?De.bind(null,t):Ne),t!==ie&&(ie=t,n===re&&(re.env=Ge()),Wt)){var r=re.env.Promise,i=t.env;Ht.then=i.nthen,r.prototype.then=i.gthen,(n.global||t.global)&&(Object.defineProperty(x,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Ge(){var t=x.Promise;return Wt?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(x,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:Ht.then,gthen:t.prototype.then}:{}}function Ue(t,e,n,r,i){var o=ie;try{return Be(t,!0),e(n,r,i)}finally{Be(o,!1)}}function Fe(t){$t.call(qt,t)}function Me(t,e,n,r){return"function"!=typeof t?t:function(){var i=ie;n&&Ce(),Be(e,!0);try{return t.apply(this,arguments)}finally{Be(i,!1),r&&Fe(xe)}}}function Le(t,e){return function(n,r){return t.call(this,Me(n,e),Me(r,e))}}function qe(t,e){var n;try{n=e.onuncatched(t)}catch(t){}if(!1!==n)try{var r,i={promise:e,reason:t};if(x.document&&document.createEvent?((r=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),N(r,i)):x.CustomEvent&&N(r=new CustomEvent("unhandledrejection",{detail:i}),i),r&&x.dispatchEvent&&(dispatchEvent(r),!x.PromiseRejectionEvent&&x.onunhandledrejection))try{x.onunhandledrejection(r)}catch(t){}vt&&r&&r.defaultPrevented}catch(t){}}-1===(""+$t).indexOf("[native code]")&&(Ce=xe=xt);var He=ce.reject;function Ke(t,e,n,r){if(t.idbdb&&(t._.openComplete||ie.letThrough||t.It)){var i=t.At(e,n,t.jt);try{i.create(),t._.PR1398_maxLoop=3}catch(i){return i.name===It.InvalidState&&t.isOpen()&&--t._.PR1398_maxLoop>0?(t.Pt(),t.open().then((()=>Ke(t,e,n,r)))):He(i)}return i.Tt(e,((t,e)=>Pe((()=>(ie.trans=i,r(t,e,i)))))).then((t=>i.Ct.then((()=>t))))}if(t._.openComplete)return He(new jt.DatabaseClosed(t._.dbOpenError));if(!t._.isBeingOpened){if(!t.xt.autoOpen)return He(new jt.DatabaseClosed);t.open().catch(xt)}return t._.dbReadyPromise.then((()=>Ke(t,e,n,r)))}const $e=String.fromCharCode(65535),ze="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",We=[],Je="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Ve=Je,Ye=Je,Xe=t=>!/(dexie\.js|dexie\.min\.js)/.test(t);function Qe(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const Ze={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function tn(t){return"string"!=typeof t||/\./.test(t)?t=>t:e=>(void 0===e[t]&&t in e&&delete(e=ot(e))[t],e)}class en{Rt(t,e,n){const r=this.Dt||ie.trans,i=this.name;function o(t,n,r){if(!r.schema[i])throw new jt.NotFound("Table "+i+" not part of transaction");return e(r.idbtrans,r)}const s=be();try{return r&&r.db===this.db?r===ie.trans?r.Tt(t,o,n):Pe((()=>r.Tt(t,o,n)),{trans:r,transless:ie.transless||ie}):Ke(this.db,t,[this.name],o)}finally{s&&ge()}}get(t,e){return t&&t.constructor===Object?this.where(t).first(e):this.Rt("readonly",(e=>this.core.get({trans:e,key:t}).then((t=>this.hook.reading.fire(t))))).then(e)}where(t){if("string"==typeof t)return new this.db.WhereClause(this,t);if(D(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);const e=R(t);if(1===e.length)return this.where(e[0]).equals(t[e[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter((t=>t.compound&&e.every((e=>t.keyPath.indexOf(e)>=0))&&t.keyPath.every((t=>e.indexOf(t)>=0))))[0];if(n&&this.db.Nt!==$e)return this.where(n.name).equals(n.keyPath.map((e=>t[e])));const{idxByName:r}=this.schema,i=this.db.Bt.indexedDB;function o(t,e){try{return 0===i.cmp(t,e)}catch(t){return!1}}const[s,u]=e.reduce((([e,n],i)=>{const s=r[i],u=t[i];return[e||s,e||!s?Qe(n,s&&s.multi?t=>{const e=X(t,i);return D(e)&&e.some((t=>o(u,t)))}:t=>o(u,X(t,i))):n]}),[null,null]);return s?this.where(s.name).equals(t[s.keyPath]).filter(u):n?this.filter(u):this.where(e).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,D(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){this.schema.mappedClass=t;const e=e=>{if(!e)return e;const n=Object.create(t.prototype);for(var r in e)if(U(e,r))try{n[r]=e[r]}catch(t){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=e,this.hook("reading",e),t}defineClass(){return this.mapToClass((function(t){N(this,t)}))}add(t,e){const{auto:n,keyPath:r}=this.schema.primKey;let i=t;return r&&n&&(i=tn(r)(t)),this.Rt("readwrite",(t=>this.core.mutate({trans:t,type:"add",keys:null!=e?[e]:null,values:[i]}))).then((t=>t.numFailures?ce.reject(t.failures[0]):t.lastResult)).then((e=>{if(r)try{Q(t,r,e)}catch(t){}return e}))}update(t,e){if("object"!=typeof t||D(t))return this.where(":id").equals(t).modify(e);{const n=X(t,this.schema.primKey.keyPath);if(void 0===n)return He(new jt.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof e?R(e).forEach((n=>{Q(t,n,e[n])})):e(t,{value:t,primKey:n})}catch(t){}return this.where(":id").equals(n).modify(e)}}put(t,e){const{auto:n,keyPath:r}=this.schema.primKey;let i=t;return r&&n&&(i=tn(r)(t)),this.Rt("readwrite",(t=>this.core.mutate({trans:t,type:"put",values:[i],keys:null!=e?[e]:null}))).then((t=>t.numFailures?ce.reject(t.failures[0]):t.lastResult)).then((e=>{if(r)try{Q(t,r,e)}catch(t){}return e}))}delete(t){return this.Rt("readwrite",(e=>this.core.mutate({trans:e,type:"delete",keys:[t]}))).then((t=>t.numFailures?ce.reject(t.failures[0]):void 0))}clear(){return this.Rt("readwrite",(t=>this.core.mutate({trans:t,type:"deleteRange",range:Ze}))).then((t=>t.numFailures?ce.reject(t.failures[0]):void 0))}bulkGet(t){return this.Rt("readonly",(e=>this.core.getMany({keys:t,trans:e}).then((t=>t.map((t=>this.hook.reading.fire(t)))))))}bulkAdd(t,e,n){const r=Array.isArray(e)?e:void 0,i=(n=n||(r?void 0:e))?n.allKeys:void 0;return this.Rt("readwrite",(e=>{const{auto:n,keyPath:o}=this.schema.primKey;if(o&&r)throw new jt.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(r&&r.length!==t.length)throw new jt.InvalidArgument("Arguments objects and keys must have the same length");const s=t.length;let u=o&&n?t.map(tn(o)):t;return this.core.mutate({trans:e,type:"add",keys:r,values:u,wantResults:i}).then((({numFailures:t,results:e,lastResult:n,failures:r})=>{if(0===t)return i?e:n;throw new Tt(`${this.name}.bulkAdd(): ${t} of ${s} operations failed`,r)}))}))}bulkPut(t,e,n){const r=Array.isArray(e)?e:void 0,i=(n=n||(r?void 0:e))?n.allKeys:void 0;return this.Rt("readwrite",(e=>{const{auto:n,keyPath:o}=this.schema.primKey;if(o&&r)throw new jt.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(r&&r.length!==t.length)throw new jt.InvalidArgument("Arguments objects and keys must have the same length");const s=t.length;let u=o&&n?t.map(tn(o)):t;return this.core.mutate({trans:e,type:"put",keys:r,values:u,wantResults:i}).then((({numFailures:t,results:e,lastResult:n,failures:r})=>{if(0===t)return i?e:n;throw new Tt(`${this.name}.bulkPut(): ${t} of ${s} operations failed`,r)}))}))}bulkDelete(t){const e=t.length;return this.Rt("readwrite",(e=>this.core.mutate({trans:e,type:"delete",keys:t}))).then((({numFailures:t,lastResult:n,failures:r})=>{if(0===t)return n;throw new Tt(`${this.name}.bulkDelete(): ${t} of ${e} operations failed`,r)}))}}function nn(t){var e={},n=function(n,r){if(r){for(var i=arguments.length,o=new Array(i-1);--i;)o[i-1]=arguments[i];return e[n].subscribe.apply(null,o),t}if("string"==typeof n)return e[n]};n.addEventType=o;for(var r=1,i=arguments.length;r<i;++r)o(arguments[r]);return n;function o(t,r,i){if("object"==typeof t)return s(t);r||(r=Ft),i||(i=xt);var o={subscribers:[],fire:i,subscribe:function(t){-1===o.subscribers.indexOf(t)&&(o.subscribers.push(t),o.fire=r(o.fire,t))},unsubscribe:function(t){o.subscribers=o.subscribers.filter((function(e){return e!==t})),o.fire=o.subscribers.reduce(r,i)}};return e[t]=n[t]=o,o}function s(t){R(t).forEach((function(e){var n=t[e];if(D(n))o(e,t[e][0],t[e][1]);else{if("asap"!==n)throw new jt.InvalidArgument("Invalid event config");var r=o(e,Rt,(function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];r.subscribers.forEach((function(t){V((function(){t.apply(null,e)}))}))}))}}))}}function rn(t,e){return q(e).from({prototype:t}),e}function on(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function sn(t,e){t.filter=Qe(t.filter,e)}function un(t,e,n){var r=t.replayFilter;t.replayFilter=r?()=>Qe(r(),e()):e,t.justLimit=n&&!r}function cn(t,e){if(t.isPrimKey)return e.primaryKey;const n=e.getIndexByKeyPath(t.index);if(!n)throw new jt.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function an(t,e,n){const r=cn(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:"prev"===t.dir,unique:!!t.unique,query:{index:r,range:t.range}})}function fn(t,e,n,r){const i=t.replayFilter?Qe(t.filter,t.replayFilter()):t.filter;if(t.or){const o={},s=(t,n,r)=>{if(!i||i(n,r,(t=>n.stop(t)),(t=>n.fail(t)))){var s=n.primaryKey,u=""+s;"[object ArrayBuffer]"===u&&(u=""+new Uint8Array(s)),U(o,u)||(o[u]=!0,e(t,n,r))}};return Promise.all([t.or.Gt(s,n),ln(an(t,r,n),t.algorithm,s,!t.keysOnly&&t.valueMapper)])}return ln(an(t,r,n),Qe(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function ln(t,e,n,r){var i=Ee(r?(t,e,i)=>n(r(t),e,i):n);return t.then((t=>{if(t)return t.start((()=>{var n=()=>t.continue();e&&!e(t,(t=>n=t),(e=>{t.stop(e),n=xt}),(e=>{t.fail(e),n=xt}))||i(t.value,t,(t=>n=t)),n()}))}))}function hn(t,e){try{const n=dn(t),r=dn(e);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(t,e){const n=t.length,r=e.length,i=n<r?n:r;for(let n=0;n<i;++n)if(t[n]!==e[n])return t[n]<e[n]?-1:1;return n===r?0:n<r?-1:1}(vn(t),vn(e));case"Array":return function(t,e){const n=t.length,r=e.length,i=n<r?n:r;for(let n=0;n<i;++n){const r=hn(t[n],e[n]);if(0!==r)return r}return n===r?0:n<r?-1:1}(t,e)}}catch(t){}return NaN}function dn(t){const e=typeof t;if("object"!==e)return e;if(ArrayBuffer.isView(t))return"binary";const n=ct(t);return"ArrayBuffer"===n?"binary":n}function vn(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class yn{Ut(t,e){var n=this.Ft;return n.error?n.table.Rt(null,He.bind(null,n.error)):n.table.Rt("readonly",t).then(e)}Mt(t){var e=this.Ft;return e.error?e.table.Rt(null,He.bind(null,e.error)):e.table.Rt("readwrite",t,"locked")}Lt(t){var e=this.Ft;e.algorithm=Qe(e.algorithm,t)}Gt(t,e){return fn(this.Ft,t,e,this.Ft.table.core)}clone(t){var e=Object.create(this.constructor.prototype),n=Object.create(this.Ft);return t&&N(n,t),e.Ft=n,e}raw(){return this.Ft.valueMapper=null,this}each(t){var e=this.Ft;return this.Ut((n=>fn(e,t,n,e.table.core)))}count(t){return this.Ut((t=>{const e=this.Ft,n=e.table.core;if(on(e,!0))return n.count({trans:t,query:{index:cn(e,n.schema),range:e.range}}).then((t=>Math.min(t,e.limit)));var r=0;return fn(e,(()=>(++r,!1)),t,n).then((()=>r))})).then(t)}sortBy(t,e){const n=t.split(".").reverse(),r=n[0],i=n.length-1;function o(t,e){return e?o(t[n[e]],e-1):t[r]}var s="next"===this.Ft.dir?1:-1;function u(t,e){var n=o(t,i),r=o(e,i);return n<r?-s:n>r?s:0}return this.toArray((function(t){return t.sort(u)})).then(e)}toArray(t){return this.Ut((t=>{var e=this.Ft;if("next"===e.dir&&on(e,!0)&&e.limit>0){const{valueMapper:n}=e,r=cn(e,e.table.core.schema);return e.table.core.query({trans:t,limit:e.limit,values:!0,query:{index:r,range:e.range}}).then((({result:t})=>n?t.map(n):t))}{const n=[];return fn(e,(t=>n.push(t)),t,e.table.core).then((()=>n))}}),t)}offset(t){var e=this.Ft;return t<=0||(e.offset+=t,on(e)?un(e,(()=>{var e=t;return(t,n)=>0===e||(1===e?(--e,!1):(n((()=>{t.advance(e),e=0})),!1))})):un(e,(()=>{var e=t;return()=>--e<0}))),this}limit(t){return this.Ft.limit=Math.min(this.Ft.limit,t),un(this.Ft,(()=>{var e=t;return function(t,n,r){return--e<=0&&n(r),e>=0}}),!0),this}until(t,e){return sn(this.Ft,(function(n,r,i){return!t(n.value)||(r(i),e)})),this}first(t){return this.limit(1).toArray((function(t){return t[0]})).then(t)}last(t){return this.reverse().first(t)}filter(t){var e,n;return sn(this.Ft,(function(e){return t(e.value)})),e=this.Ft,n=t,e.isMatch=Qe(e.isMatch,n),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this.Ft.table,t,this)}reverse(){return this.Ft.dir="prev"===this.Ft.dir?"next":"prev",this.qt&&this.qt(this.Ft.dir),this}desc(){return this.reverse()}eachKey(t){var e=this.Ft;return e.keysOnly=!e.isMatch,this.each((function(e,n){t(n.key,n)}))}eachUniqueKey(t){return this.Ft.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var e=this.Ft;return e.keysOnly=!e.isMatch,this.each((function(e,n){t(n.primaryKey,n)}))}keys(t){var e=this.Ft;e.keysOnly=!e.isMatch;var n=[];return this.each((function(t,e){n.push(e.key)})).then((function(){return n})).then(t)}primaryKeys(t){var e=this.Ft;if("next"===e.dir&&on(e,!0)&&e.limit>0)return this.Ut((t=>{var n=cn(e,e.table.core.schema);return e.table.core.query({trans:t,values:!1,limit:e.limit,query:{index:n,range:e.range}})})).then((({result:t})=>t)).then(t);e.keysOnly=!e.isMatch;var n=[];return this.each((function(t,e){n.push(e.primaryKey)})).then((function(){return n})).then(t)}uniqueKeys(t){return this.Ft.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys((function(t){return t[0]})).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this.Ft,e=t.index&&t.table.schema.idxByName[t.index];if(!e||!e.multi)return this;var n={};return sn(this.Ft,(function(t){var e=t.primaryKey.toString(),r=U(n,e);return n[e]=!0,!r})),this}modify(t){var e=this.Ft;return this.Mt((n=>{var r;if("function"==typeof t)r=t;else{var i=R(t),o=i.length;r=function(e){for(var n=!1,r=0;r<o;++r){var s=i[r],u=t[s];X(e,s)!==u&&(Q(e,s,u),n=!0)}return n}}const s=e.table.core,{outbound:u,extractKey:c}=s.schema.primaryKey,a=this.db.xt.modifyChunkSize||200,f=[];let l=0;const h=[],d=(t,e)=>{const{failures:n,numFailures:r}=e;l+=t-r;for(let t of R(n))f.push(n[t])};return this.clone().primaryKeys().then((i=>{const o=f=>{const l=Math.min(a,i.length-f);return s.getMany({trans:n,keys:i.slice(f,f+l),cache:"immutable"}).then((h=>{const v=[],y=[],p=u?[]:null,m=[];for(let t=0;t<l;++t){const e=h[t],n={value:ot(e),primKey:i[f+t]};!1!==r.call(n,n.value,n)&&(null==n.value?m.push(i[f+t]):u||0===hn(c(e),c(n.value))?(y.push(n.value),u&&p.push(i[f+t])):(m.push(i[f+t]),v.push(n.value)))}const w=on(e)&&e.limit===1/0&&("function"!=typeof t||t===pn)&&{index:e.index,range:e.range};return Promise.resolve(v.length>0&&s.mutate({trans:n,type:"add",values:v}).then((t=>{for(let e in t.failures)m.splice(parseInt(e),1);d(v.length,t)}))).then((()=>(y.length>0||w&&"object"==typeof t)&&s.mutate({trans:n,type:"put",keys:p,values:y,criteria:w,changeSpec:"function"!=typeof t&&t}).then((t=>d(y.length,t))))).then((()=>(m.length>0||w&&t===pn)&&s.mutate({trans:n,type:"delete",keys:m,criteria:w}).then((t=>d(m.length,t))))).then((()=>i.length>f+l&&o(f+a)))}))};return o(0).then((()=>{if(f.length>0)throw new Ot("Error modifying one or more objects",f,l,h);return i.length}))}))}))}delete(){var t=this.Ft,e=t.range;return on(t)&&(t.isPrimKey&&!Ye||3===e.type)?this.Mt((n=>{const{primaryKey:r}=t.table.core.schema,i=e;return t.table.core.count({trans:n,query:{index:r,range:i}}).then((e=>t.table.core.mutate({trans:n,type:"deleteRange",range:i}).then((({failures:t,lastResult:n,results:r,numFailures:i})=>{if(i)throw new Ot("Could not delete some values",Object.keys(t).map((e=>t[e])),e-i);return e-i}))))})):this.modify(pn)}}const pn=(t,e)=>e.value=null;function mn(t,e){return t<e?-1:t===e?0:1}function wn(t,e){return t>e?-1:t===e?0:1}function bn(t,e,n){var r=t instanceof On?new t.Collection(t):t;return r.Ft.error=n?new n(e):new TypeError(e),r}function gn(t){return new t.Collection(t,(()=>Sn(""))).limit(0)}function _n(t,e,n,r,i,o){for(var s=Math.min(t.length,r.length),u=-1,c=0;c<s;++c){var a=e[c];if(a!==r[c])return i(t[c],n[c])<0?t.substr(0,c)+n[c]+n.substr(c+1):i(t[c],r[c])<0?t.substr(0,c)+r[c]+n.substr(c+1):u>=0?t.substr(0,u)+e[u]+n.substr(u+1):null;i(t[c],a)<0&&(u=c)}return s<r.length&&"next"===o?t+n.substr(t.length):s<t.length&&"prev"===o?t.substr(0,n.length):u<0?null:t.substr(0,u)+r[u]+n.substr(u+1)}function kn(t,e,n,r){var i,o,s,u,c,a,f,l=n.length;if(!n.every((t=>"string"==typeof t)))return bn(t,"String expected.");function h(t){i=function(t){return"next"===t?t=>t.toUpperCase():t=>t.toLowerCase()}(t),o=function(t){return"next"===t?t=>t.toLowerCase():t=>t.toUpperCase()}(t),s="next"===t?mn:wn;var e=n.map((function(t){return{lower:o(t),upper:i(t)}})).sort((function(t,e){return s(t.lower,e.lower)}));u=e.map((function(t){return t.upper})),c=e.map((function(t){return t.lower})),a=t,f="next"===t?"":r}h("next");var d=new t.Collection(t,(()=>En(u[0],c[l-1]+r)));d.qt=function(t){h(t)};var v=0;return d.Lt((function(t,n,r){var i=t.key;if("string"!=typeof i)return!1;var h=o(i);if(e(h,c,v))return!0;for(var d=null,y=v;y<l;++y){var p=_n(i,h,u[y],c[y],s,a);null===p&&null===d?v=y+1:(null===d||s(d,p)>0)&&(d=p)}return n(null!==d?function(){t.continue(d+f)}:r),!1})),d}function En(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function Sn(t){return{type:1,lower:t,upper:t}}class On{get Collection(){return this.Ft.table.db.Collection}between(t,e,n,r){n=!1!==n,r=!0===r;try{return this.Ht(t,e)>0||0===this.Ht(t,e)&&(n||r)&&(!n||!r)?gn(this):new this.Collection(this,(()=>En(t,e,!n,!r)))}catch(t){return bn(this,ze)}}equals(t){return null==t?bn(this,ze):new this.Collection(this,(()=>Sn(t)))}above(t){return null==t?bn(this,ze):new this.Collection(this,(()=>En(t,void 0,!0)))}aboveOrEqual(t){return null==t?bn(this,ze):new this.Collection(this,(()=>En(t,void 0,!1)))}below(t){return null==t?bn(this,ze):new this.Collection(this,(()=>En(void 0,t,!1,!0)))}belowOrEqual(t){return null==t?bn(this,ze):new this.Collection(this,(()=>En(void 0,t)))}startsWith(t){return"string"!=typeof t?bn(this,"String expected."):this.between(t,t+$e,!0,!0)}startsWithIgnoreCase(t){return""===t?this.startsWith(t):kn(this,((t,e)=>0===t.indexOf(e[0])),[t],$e)}equalsIgnoreCase(t){return kn(this,((t,e)=>t===e[0]),[t],"")}anyOfIgnoreCase(){var t=ht.apply(lt,arguments);return 0===t.length?gn(this):kn(this,((t,e)=>-1!==e.indexOf(t)),t,"")}startsWithAnyOfIgnoreCase(){var t=ht.apply(lt,arguments);return 0===t.length?gn(this):kn(this,((t,e)=>e.some((e=>0===t.indexOf(e)))),t,$e)}anyOf(){const t=ht.apply(lt,arguments);let e=this.Ht;try{t.sort(e)}catch(t){return bn(this,ze)}if(0===t.length)return gn(this);const n=new this.Collection(this,(()=>En(t[0],t[t.length-1])));n.qt=n=>{e="next"===n?this.Kt:this.$t,t.sort(e)};let r=0;return n.Lt(((n,i,o)=>{const s=n.key;for(;e(s,t[r])>0;)if(++r,r===t.length)return i(o),!1;return 0===e(s,t[r])||(i((()=>{n.continue(t[r])})),!1)})),n}notEqual(t){return this.inAnyRange([[-1/0,t],[t,this.db.Nt]],{includeLowers:!1,includeUppers:!1})}noneOf(){const t=ht.apply(lt,arguments);if(0===t.length)return new this.Collection(this);try{t.sort(this.Kt)}catch(t){return bn(this,ze)}const e=t.reduce(((t,e)=>t?t.concat([[t[t.length-1][1],e]]):[[-1/0,e]]),null);return e.push([t[t.length-1],this.db.Nt]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,e){const n=this.Ht,r=this.Kt,i=this.$t,o=this.zt,s=this.Wt;if(0===t.length)return gn(this);if(!t.every((t=>void 0!==t[0]&&void 0!==t[1]&&r(t[0],t[1])<=0)))return bn(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",jt.InvalidArgument);const u=!e||!1!==e.includeLowers,c=e&&!0===e.includeUppers;let a,f=r;function l(t,e){return f(t[0],e[0])}try{a=t.reduce((function(t,e){let r=0,i=t.length;for(;r<i;++r){const i=t[r];if(n(e[0],i[1])<0&&n(e[1],i[0])>0){i[0]=o(i[0],e[0]),i[1]=s(i[1],e[1]);break}}return r===i&&t.push(e),t}),[]),a.sort(l)}catch(t){return bn(this,ze)}let h=0;const d=c?t=>r(t,a[h][1])>0:t=>r(t,a[h][1])>=0,v=u?t=>i(t,a[h][0])>0:t=>i(t,a[h][0])>=0;let y=d;const p=new this.Collection(this,(()=>En(a[0][0],a[a.length-1][1],!u,!c)));return p.qt=t=>{"next"===t?(y=d,f=r):(y=v,f=i),a.sort(l)},p.Lt(((t,e,n)=>{for(var i=t.key;y(i);)if(++h,h===a.length)return e(n),!1;return!!function(t){return!d(t)&&!v(t)}(i)||(0===this.Ht(i,a[h][1])||0===this.Ht(i,a[h][0])||e((()=>{f===r?t.continue(a[h][0]):t.continue(a[h][1])})),!1)})),p}startsWithAnyOf(){const t=ht.apply(lt,arguments);return t.every((t=>"string"==typeof t))?0===t.length?gn(this):this.inAnyRange(t.map((t=>[t,t+$e]))):bn(this,"startsWithAnyOf() only works with strings")}}function Tn(t){return Ee((function(e){return In(e),t(e.target.error),!1}))}function In(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const An=nn(null,"storagemutated");class jn{Jt(){return J(!ie.global),++this.Vt,1!==this.Vt||ie.global||(ie.lockOwnerFor=this),this}Yt(){if(J(!ie.global),0==--this.Vt)for(ie.global||(ie.lockOwnerFor=null);this.Xt.length>0&&!this.Qt();){var t=this.Xt.shift();try{Ue(t[1],t[0])}catch(t){}}return this}Qt(){return this.Vt&&ie.lockOwnerFor!==this}create(t){if(!this.mode)return this;const e=this.db.idbdb,n=this.db._.dbOpenError;if(J(!this.idbtrans),!t&&!e)switch(n&&n.name){case"DatabaseClosedError":throw new jt.DatabaseClosed(n);case"MissingAPIError":throw new jt.MissingAPI(n.message,n);default:throw new jt.OpenFailed(n)}if(!this.active)throw new jt.TransactionInactive;return J(null===this.Ct._),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):e.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Ee((e=>{In(e),this.O(t.error)})),t.onabort=Ee((e=>{In(e),this.active&&this.O(new jt.Abort(t.error)),this.active=!1,this.on("abort").fire(e)})),t.oncomplete=Ee((()=>{this.active=!1,this.S(),"mutatedParts"in t&&An.storagemutated.fire(t.mutatedParts)})),this}Tt(t,e,n){if("readwrite"===t&&"readwrite"!==this.mode)return He(new jt.ReadOnly("Transaction is readonly"));if(!this.active)return He(new jt.TransactionInactive);if(this.Qt())return new ce(((r,i)=>{this.Xt.push([()=>{this.Tt(t,e,n).then(r,i)},ie])}));if(n)return Pe((()=>{var t=new ce(((t,n)=>{this.Jt();const r=e(t,n,this);r&&r.then&&r.then(t,n)}));return t.finally((()=>this.Yt())),t.gt=!0,t}));var r=new ce(((t,n)=>{var r=e(t,n,this);r&&r.then&&r.then(t,n)}));return r.gt=!0,r}Zt(){return this.parent?this.parent.Zt():this}waitFor(t){var e=this.Zt();const n=ce.resolve(t);if(e.te)e.te=e.te.then((()=>n));else{e.te=n,e.ee=[];var r=e.idbtrans.objectStore(e.storeNames[0]);!function t(){for(++e.ne;e.ee.length;)e.ee.shift()();e.te&&(r.get(-1/0).onsuccess=t)}()}var i=e.te;return new ce(((t,r)=>{n.then((n=>e.ee.push(Ee(t.bind(null,n)))),(t=>e.ee.push(Ee(r.bind(null,t))))).finally((()=>{e.te===i&&(e.te=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this.O(new jt.Abort))}table(t){const e=this.re||(this.re={});if(U(e,t))return e[t];const n=this.schema[t];if(!n)throw new jt.NotFound("Table "+t+" not part of transaction");const r=new this.db.Table(t,n,this);return r.core=this.db.core.table(t),e[t]=r,r}}function Pn(t,e,n,r,i,o,s){return{name:t,keyPath:e,unique:n,multi:r,auto:i,compound:o,src:(n&&!s?"&":"")+(r?"*":"")+(i?"++":"")+Cn(e)}}function Cn(t){return"string"==typeof t?t:t?"["+[].join.call(t,"+")+"]":""}function xn(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:Y(n,(t=>[t.name,t]))}}let Rn=t=>{try{return t.only([[]]),Rn=()=>[[]],[[]]}catch(t){return Rn=()=>$e,$e}};function Dn(t){return null==t?()=>{}:"string"==typeof t?function(t){return 1===t.split(".").length?e=>e[t]:e=>X(e,t)}(t):e=>X(e,t)}function Nn(t){return[].slice.call(t)}let Bn=0;function Gn(t){return null==t?":id":"string"==typeof t?t:`[${t.join("+")}]`}function Un(t,e,n){function r(t){if(3===t.type)return null;if(4===t.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:n,upper:r,lowerOpen:i,upperOpen:o}=t;return void 0===n?void 0===r?null:e.upperBound(r,!!o):void 0===r?e.lowerBound(n,!!i):e.bound(n,r,!!i,!!o)}const{schema:i,hasGetAll:o}=function(t,e){const n=Nn(t.objectStoreNames);return{schema:{name:t.name,tables:n.map((t=>e.objectStore(t))).map((t=>{const{keyPath:e,autoIncrement:n}=t,r=D(e),i=null==e,o={},s={name:t.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:i,compound:r,keyPath:e,autoIncrement:n,unique:!0,extractKey:Dn(e)},indexes:Nn(t.indexNames).map((e=>t.index(e))).map((t=>{const{name:e,unique:n,multiEntry:r,keyPath:i}=t,s={name:e,compound:D(i),keyPath:i,unique:n,multiEntry:r,extractKey:Dn(i)};return o[Gn(i)]=s,s})),getIndexByKeyPath:t=>o[Gn(t)]};return o[":id"]=s.primaryKey,null!=e&&(o[Gn(e)]=s.primaryKey),s}))},hasGetAll:n.length>0&&"getAll"in e.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,n),s=i.tables.map((t=>function(t){const e=t.name;return{name:e,schema:t,mutate:function({trans:t,type:n,keys:i,values:o,range:s}){return new Promise(((u,c)=>{u=Ee(u);const a=t.objectStore(e),f=null==a.keyPath,l="put"===n||"add"===n;if(!l&&"delete"!==n&&"deleteRange"!==n)throw new Error("Invalid operation type: "+n);const{length:h}=i||o||{length:1};if(i&&o&&i.length!==o.length)throw new Error("Given keys array must have same length as given values array.");if(0===h)return u({numFailures:0,failures:{},results:[],lastResult:void 0});let d;const v=[],y=[];let p=0;const m=t=>{++p,In(t)};if("deleteRange"===n){if(4===s.type)return u({numFailures:p,failures:y,results:[],lastResult:void 0});3===s.type?v.push(d=a.clear()):v.push(d=a.delete(r(s)))}else{const[t,e]=l?f?[o,i]:[o,null]:[i,null];if(l)for(let r=0;r<h;++r)v.push(d=e&&void 0!==e[r]?a[n](t[r],e[r]):a[n](t[r])),d.onerror=m;else for(let e=0;e<h;++e)v.push(d=a[n](t[e])),d.onerror=m}const w=t=>{const e=t.target.result;v.forEach(((t,e)=>null!=t.error&&(y[e]=t.error))),u({numFailures:p,failures:y,results:"delete"===n?i:v.map((t=>t.result)),lastResult:e})};d.onerror=t=>{m(t),w(t)},d.onsuccess=w}))},getMany:({trans:t,keys:n})=>new Promise(((r,i)=>{r=Ee(r);const o=t.objectStore(e),s=n.length,u=new Array(s);let c,a=0,f=0;const l=t=>{const e=t.target;u[e.ie]=e.result,++f===a&&r(u)},h=Tn(i);for(let t=0;t<s;++t)null!=n[t]&&(c=o.get(n[t]),c.ie=t,c.onsuccess=l,c.onerror=h,++a);0===a&&r(u)})),get:({trans:t,key:n})=>new Promise(((r,i)=>{r=Ee(r);const o=t.objectStore(e).get(n);o.onsuccess=t=>r(t.target.result),o.onerror=Tn(i)})),query:function(t){return n=>new Promise(((i,o)=>{i=Ee(i);const{trans:s,values:u,limit:c,query:a}=n,f=c===1/0?void 0:c,{index:l,range:h}=a,d=s.objectStore(e),v=l.isPrimaryKey?d:d.index(l.name),y=r(h);if(0===c)return i({result:[]});if(t){const t=u?v.getAll(y,f):v.getAllKeys(y,f);t.onsuccess=t=>i({result:t.target.result}),t.onerror=Tn(o)}else{let t=0;const e=u||!("openKeyCursor"in v)?v.openCursor(y):v.openKeyCursor(y),n=[];e.onsuccess=r=>{const o=e.result;return o?(n.push(u?o.value:o.primaryKey),++t===c?i({result:n}):void o.continue()):i({result:n})},e.onerror=Tn(o)}}))}(o),openCursor:function({trans:t,values:n,query:i,reverse:o,unique:s}){return new Promise(((u,c)=>{u=Ee(u);const{index:a,range:f}=i,l=t.objectStore(e),h=a.isPrimaryKey?l:l.index(a.name),d=o?s?"prevunique":"prev":s?"nextunique":"next",v=n||!("openKeyCursor"in h)?h.openCursor(r(f),d):h.openKeyCursor(r(f),d);v.onerror=Tn(c),v.onsuccess=Ee((e=>{const n=v.result;if(!n)return void u(null);n.___id=++Bn,n.done=!1;const r=n.continue.bind(n);let i=n.continuePrimaryKey;i&&(i=i.bind(n));const o=n.advance.bind(n),s=()=>{throw new Error("Cursor not stopped")};n.trans=t,n.stop=n.continue=n.continuePrimaryKey=n.advance=()=>{throw new Error("Cursor not started")},n.fail=Ee(c),n.next=function(){let t=1;return this.start((()=>t--?this.continue():this.stop())).then((()=>this))},n.start=t=>{const e=new Promise(((t,e)=>{t=Ee(t),v.onerror=Tn(e),n.fail=e,n.stop=e=>{n.stop=n.continue=n.continuePrimaryKey=n.advance=s,t(e)}})),u=()=>{if(v.result)try{t()}catch(t){n.fail(t)}else n.done=!0,n.start=()=>{throw new Error("Cursor behind last entry")},n.stop()};return v.onsuccess=Ee((t=>{v.onsuccess=u,u()})),n.continue=r,n.continuePrimaryKey=i,n.advance=o,u(),e},u(n)}),c)}))},count({query:t,trans:n}){const{index:i,range:o}=t;return new Promise(((t,s)=>{const u=n.objectStore(e),c=i.isPrimaryKey?u:u.index(i.name),a=r(o),f=a?c.count(a):c.count();f.onsuccess=Ee((e=>t(e.target.result))),f.onerror=Tn(s)}))}}}(t))),u={};return s.forEach((t=>u[t.name]=t)),{stack:"dbcore",transaction:t.transaction.bind(t),table(t){if(!u[t])throw new Error(`Table '${t}' not found`);return u[t]},MIN_KEY:-1/0,MAX_KEY:Rn(e),schema:i}}function Fn({oe:t},e){const n=e.db,r=function(t,e,{IDBKeyRange:n,indexedDB:r},i){const o=function(t,e){return e.reduce(((t,{create:e})=>({...t,...e(t)})),t)}(Un(e,n,i),t.dbcore);return{dbcore:o}}(t.se,n,t.Bt,e);t.core=r.dbcore,t.tables.forEach((e=>{const n=e.name;t.core.schema.tables.some((t=>t.name===n))&&(e.core=t.core.table(n),t[n]instanceof t.Table&&(t[n].core=e.core))}))}function Mn({oe:t},e,n,r){n.forEach((n=>{const i=r[n];e.forEach((e=>{const r=K(e,n);(!r||"value"in r&&void 0===r.value)&&(e===t.Transaction.prototype||e instanceof t.Transaction?L(e,n,{get(){return this.table(n)},set(t){M(this,n,{value:t,writable:!0,configurable:!0,enumerable:!0})}}):e[n]=new t.Table(n,i))}))}))}function Ln({oe:t},e){e.forEach((e=>{for(let n in e)e[n]instanceof t.Table&&delete e[n]}))}function qn(t,e){return t.ue.version-e.ue.version}function Hn(t,e,n,r){const i=t.jt,o=t.At("readwrite",t.ce,i);o.create(n),o.Ct.catch(r);const s=o.O.bind(o),u=ie.transless||ie;Pe((()=>{ie.trans=o,ie.transless=u,0===e?(R(i).forEach((t=>{$n(n,t,i[t].primKey,i[t].indexes)})),Fn(t,n),ce.follow((()=>t.on.populate.fire(o))).catch(s)):function({oe:t},e,n,r){const i=[],o=t.ae;let s=t.jt=Wn(t,t.idbdb,r),u=!1;return o.filter((t=>t.ue.version>=e)).forEach((o=>{i.push((()=>{const i=s,c=o.ue.dbschema;Jn(t,i,r),Jn(t,c,r),s=t.jt=c;const a=Kn(i,c);a.add.forEach((t=>{$n(r,t[0],t[1].primKey,t[1].indexes)})),a.change.forEach((t=>{if(t.recreate)throw new jt.Upgrade("Not yet support for changing primary key");{const e=r.objectStore(t.name);t.add.forEach((t=>zn(e,t))),t.change.forEach((t=>{e.deleteIndex(t.name),zn(e,t)})),t.del.forEach((t=>e.deleteIndex(t)))}}));const f=o.ue.contentUpgrade;if(f&&o.ue.version>e){Fn(t,r),n.re={},u=!0;let e=Z(c);a.del.forEach((t=>{e[t]=i[t]})),Ln(t,[t.Transaction.prototype]),Mn(t,[t.Transaction.prototype],R(e),e),n.schema=e;const o=dt(f);let s;o&&Ce();const l=ce.follow((()=>{if(s=f(n),s&&o){var t=xe.bind(null,null);s.then(t,t)}}));return s&&"function"==typeof s.then?ce.resolve(s):l.then((()=>s))}})),i.push((e=>{u&&Ve||function(t,e){[].slice.call(e.db.objectStoreNames).forEach((n=>null==t[n]&&e.db.deleteObjectStore(n)))}(o.ue.dbschema,e),Ln(t,[t.Transaction.prototype]),Mn(t,[t.Transaction.prototype],t.ce,t.jt),n.schema=t.jt}))})),function t(){return i.length?ce.resolve(i.shift()(n.idbtrans)).then(t):ce.resolve()}().then((()=>{var t,e;e=r,R(t=s).forEach((n=>{e.db.objectStoreNames.contains(n)||$n(e,n,t[n].primKey,t[n].indexes)}))}))}(t,e,o,n).catch(s)}))}function Kn(t,e){const n={del:[],add:[],change:[]};let r;for(r in t)e[r]||n.del.push(r);for(r in e){const i=t[r],o=e[r];if(i){const t={name:r,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto&&!Je)t.recreate=!0,n.change.push(t);else{const e=i.idxByName,r=o.idxByName;let s;for(s in e)r[s]||t.del.push(s);for(s in r){const n=e[s],i=r[s];n?n.src!==i.src&&t.change.push(i):t.add.push(i)}(t.del.length>0||t.add.length>0||t.change.length>0)&&n.change.push(t)}}else n.add.push([r,o])}return n}function $n(t,e,n,r){const i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((t=>zn(i,t))),i}function zn(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function Wn(t,e,n){const r={};return z(e.objectStoreNames,0).forEach((t=>{const e=n.objectStore(t);let i=e.keyPath;const o=Pn(Cn(i),i||"",!1,!1,!!e.autoIncrement,i&&"string"!=typeof i,!0),s=[];for(let t=0;t<e.indexNames.length;++t){const n=e.index(e.indexNames[t]);i=n.keyPath;var u=Pn(n.name,i,!!n.unique,!!n.multiEntry,!1,i&&"string"!=typeof i,!1);s.push(u)}r[t]=xn(t,o,s)})),r}function Jn({oe:t},e,n){const r=n.db.objectStoreNames;for(let i=0;i<r.length;++i){const o=r[i],s=n.objectStore(o);t.fe="getAll"in s;for(let t=0;t<s.indexNames.length;++t){const n=s.indexNames[t],r=s.index(n).keyPath,i="string"==typeof r?r:"["+z(r).join("+")+"]";if(e[o]){const t=e[o].idxByName[i];t&&(t.name=n,delete e[o].idxByName[i],e[o].idxByName[n]=t)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&x.WorkerGlobalScope&&x instanceof x.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t.fe=!1)}class Vn{le(t,e){R(t).forEach((n=>{if(null!==t[n]){var r=t[n].split(",").map(((t,e)=>{const n=(t=t.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return Pn(n,r||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),D(r),0===e)})),i=r.shift();if(i.multi)throw new jt.Schema("Primary key cannot be multi-valued");r.forEach((t=>{if(t.auto)throw new jt.Schema("Only primary key can be marked as autoIncrement (++)");if(!t.keyPath)throw new jt.Schema("Index must have a name and cannot be an empty string")})),e[n]=xn(n,i,r)}}))}stores(t){const e=this.db;this.ue.storesSource=this.ue.storesSource?N(this.ue.storesSource,t):t;const n=e.ae,r={};let i={};return n.forEach((t=>{N(r,t.ue.storesSource),i=t.ue.dbschema={},t.le(r,i)})),e.jt=i,Ln(e,[e.he,e,e.Transaction.prototype]),Mn(e,[e.he,e,e.Transaction.prototype,this.ue.tables],R(i),i),e.ce=R(i),this}upgrade(t){return this.ue.contentUpgrade=Mt(this.ue.contentUpgrade||xt,t),this}}function Yn(t,e){let n=t.de;return n||(n=t.de=new mr("__dbnames",{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Xn(t){return t&&"function"==typeof t.databases}function Qn(t){return Pe((function(){return ie.letThrough=!0,t()}))}function Zn(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(e){var n=function(){return indexedDB.databases().finally(e)};t=setInterval(n,100),n()})).finally((function(){return clearInterval(t)})):Promise.resolve()}function tr(t){var e=e=>t.next(e),n=i(e),r=i((e=>t.throw(e)));function i(t){return e=>{var i=t(e),o=i.value;return i.done?o:o&&"function"==typeof o.then?o.then(n,r):D(o)?Promise.all(o).then(n,r):n(o)}}return i(e)()}function er(t,e,n){var r=arguments.length;if(r<2)throw new jt.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var o=et(i);return[t,o,n]}function nr(t,e,n,r,i){return ce.resolve().then((()=>{const o=ie.transless||ie,s=t.At(e,n,t.jt,r),u={trans:s,transless:o};if(r)s.idbtrans=r.idbtrans;else try{s.create(),t._.PR1398_maxLoop=3}catch(r){return r.name===It.InvalidState&&t.isOpen()&&--t._.PR1398_maxLoop>0?(t.Pt(),t.open().then((()=>nr(t,e,n,null,i)))):He(r)}const c=dt(i);let a;c&&Ce();const f=ce.follow((()=>{if(a=i.call(s,s),a)if(c){var t=xe.bind(null,null);a.then(t,t)}else"function"==typeof a.next&&"function"==typeof a.throw&&(a=tr(a))}),u);return(a&&"function"==typeof a.then?ce.resolve(a).then((t=>s.active?t:He(new jt.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):f.then((()=>a))).then((t=>(r&&s.S(),s.Ct.then((()=>t))))).catch((t=>(s.O(t),He(t))))}))}function rr(t,e,n){const r=D(t)?t.slice():[t];for(let t=0;t<n;++t)r.push(e);return r}const ir={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const n=t.table(e),{schema:r}=n,i={},o=[];function s(t,e,n){const r=Gn(t),u=i[r]=i[r]||[],c=null==t?0:"string"==typeof t?1:t.length,a=e>0,f={...n,isVirtual:a,keyTail:e,keyLength:c,extractKey:Dn(t),unique:!a&&n.unique};return u.push(f),f.isPrimaryKey||o.push(f),c>1&&s(2===c?t[0]:t.slice(0,c-1),e+1,n),u.sort(((t,e)=>t.keyTail-e.keyTail)),f}const u=s(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[u];for(const t of r.indexes)s(t.keyPath,0,t);function c(e){const n=e.query.index;return n.isVirtual?{...e,query:{index:n,range:(r=e.query.range,i=n.keyTail,{type:1===r.type?2:r.type,lower:rr(r.lower,r.lowerOpen?t.MAX_KEY:t.MIN_KEY,i),lowerOpen:!0,upper:rr(r.upper,r.upperOpen?t.MIN_KEY:t.MAX_KEY,i),upperOpen:!0})}}:e;var r,i}const a={...n,schema:{...r,primaryKey:u,indexes:o,getIndexByKeyPath:function(t){const e=i[Gn(t)];return e&&e[0]}},count:t=>n.count(c(t)),query:t=>n.query(c(t)),openCursor(e){const{keyTail:r,isVirtual:i,keyLength:o}=e.query.index;return i?n.openCursor(c(e)).then((n=>n&&function(n){const i=Object.create(n,{continue:{value:function(i){null!=i?n.continue(rr(i,e.reverse?t.MAX_KEY:t.MIN_KEY,r)):e.unique?n.continue(n.key.slice(0,o).concat(e.reverse?t.MIN_KEY:t.MAX_KEY,r)):n.continue()}},continuePrimaryKey:{value(e,i){n.continuePrimaryKey(rr(e,t.MAX_KEY,r),i)}},primaryKey:{get:()=>n.primaryKey},key:{get(){const t=n.key;return 1===o?t[0]:t.slice(0,o)}},value:{get:()=>n.value}});return i}(n))):n.openCursor(e)}};return a}}}};function or(t,e,n,r){return n=n||{},r=r||"",R(t).forEach((i=>{if(U(e,i)){var o=t[i],s=e[i];if("object"==typeof o&&"object"==typeof s&&o&&s){const t=ct(o);t!==ct(s)?n[r+i]=e[i]:"Object"===t?or(o,s,n,r+i+"."):o!==s&&(n[r+i]=e[i])}else o!==s&&(n[r+i]=e[i])}else n[r+i]=void 0})),R(e).forEach((i=>{U(t,i)||(n[r+i]=e[i])})),n}const sr={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const n=t.table(e),{primaryKey:r}=n.schema,i={...n,mutate(t){const i=ie.trans,{deleting:o,creating:s,updating:u}=i.table(e).hook;switch(t.type){case"add":if(s.fire===xt)break;return i.Tt("readwrite",(()=>c(t)),!0);case"put":if(s.fire===xt&&u.fire===xt)break;return i.Tt("readwrite",(()=>c(t)),!0);case"delete":if(o.fire===xt)break;return i.Tt("readwrite",(()=>c(t)),!0);case"deleteRange":if(o.fire===xt)break;return i.Tt("readwrite",(()=>function(t){return a(t.trans,t.range,1e4)}(t)),!0)}return n.mutate(t);function c(t){const e=ie.trans,i=t.keys||function(t,e){return"delete"===e.type?e.keys:e.keys||e.values.map(t.extractKey)}(r,t);if(!i)throw new Error("Keys missing");return"delete"!==(t="add"===t.type||"put"===t.type?{...t,keys:i}:{...t}).type&&(t.values=[...t.values]),t.keys&&(t.keys=[...t.keys]),function(t,e,n){return"add"===e.type?Promise.resolve([]):t.getMany({trans:e.trans,keys:n,cache:"immutable"})}(n,t,i).then((c=>{const a=i.map(((n,i)=>{const a=c[i],f={onerror:null,onsuccess:null};if("delete"===t.type)o.fire.call(f,n,a,e);else if("add"===t.type||void 0===a){const o=s.fire.call(f,n,t.values[i],e);null==n&&null!=o&&(n=o,t.keys[i]=n,r.outbound||Q(t.values[i],r.keyPath,n))}else{const r=or(a,t.values[i]),o=u.fire.call(f,r,n,a,e);if(o){const e=t.values[i];Object.keys(o).forEach((t=>{U(e,t)?e[t]=o[t]:Q(e,t,o[t])}))}}return f}));return n.mutate(t).then((({failures:e,results:n,numFailures:r,lastResult:o})=>{for(let r=0;r<i.length;++r){const o=n?n[r]:i[r],s=a[r];null==o?s.onerror&&s.onerror(e[r]):s.onsuccess&&s.onsuccess("put"===t.type&&c[r]?t.values[r]:o)}return{failures:e,results:n,numFailures:r,lastResult:o}})).catch((t=>(a.forEach((e=>e.onerror&&e.onerror(t))),Promise.reject(t))))}))}function a(t,e,i){return n.query({trans:t,values:!1,query:{index:r,range:e},limit:i}).then((({result:n})=>c({type:"delete",keys:n,trans:t}).then((r=>r.numFailures>0?Promise.reject(r.failures[0]):n.length<i?{failures:[],numFailures:0,lastResult:void 0}:a(t,{...e,lower:n[n.length-1],lowerOpen:!0},i)))))}}};return i}})};function ur(t,e,n){try{if(!e)return null;if(e.keys.length<t.length)return null;const r=[];for(let i=0,o=0;i<e.keys.length&&o<t.length;++i)0===hn(e.keys[i],t[o])&&(r.push(n?ot(e.values[i]):e.values[i]),++o);return r.length===t.length?r:null}catch(t){return null}}const cr={stack:"dbcore",level:-1,create:t=>({table:e=>{const n=t.table(e);return{...n,getMany:t=>{if(!t.cache)return n.getMany(t);const e=ur(t.keys,t.trans.ve,"clone"===t.cache);return e?ce.resolve(e):n.getMany(t).then((e=>(t.trans.ve={keys:t.keys,values:"clone"===t.cache?ot(e):e},e)))},mutate:t=>("add"!==t.type&&(t.trans.ve=null),n.mutate(t))}}})};function ar(t){return!("from"in t)}const fr=function(t,e){if(!this){const e=new fr;return t&&"d"in t&&N(e,t),e}N(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function lr(t,e,n){const r=hn(e,n);if(isNaN(r))return;if(r>0)throw RangeError();if(ar(t))return N(t,{from:e,to:n,d:1});const i=t.l,o=t.r;if(hn(n,t.from)<0)return i?lr(i,e,n):t.l={from:e,to:n,d:1,l:null,r:null},vr(t);if(hn(e,t.to)>0)return o?lr(o,e,n):t.r={from:e,to:n,d:1,l:null,r:null},vr(t);hn(e,t.from)<0&&(t.from=e,t.l=null,t.d=o?o.d+1:1),hn(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);const s=!t.r;i&&!t.l&&hr(t,i),o&&s&&hr(t,o)}function hr(t,e){ar(e)||function t(e,{from:n,to:r,l:i,r:o}){lr(e,n,r),i&&t(e,i),o&&t(e,o)}(t,e)}function dr(t){let e=ar(t)?null:{s:0,n:t};return{next(t){const n=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,n)for(;e.n.l&&hn(t,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!n||hn(t,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function vr(t){var e,n;const r=((null===(e=t.r)||void 0===e?void 0:e.d)||0)-((null===(n=t.l)||void 0===n?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){const e="r"===i?"l":"r",n={...t},r=t[i];t.from=r.from,t.to=r.to,t[i]=r[i],n[i]=r[e],t[e]=n,n.d=yr(n)}t.d=yr(t)}function yr({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}F(fr.prototype,{add(t){return hr(this,t),this},addKey(t){return lr(this,t,t),this},addKeys(t){return t.forEach((t=>lr(this,t,t))),this},[at](){return dr(this)}});const pr={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,n=new fr(t.MIN_KEY,t.MAX_KEY);return{...t,table:r=>{const i=t.table(r),{schema:o}=i,{primaryKey:s}=o,{extractKey:u,outbound:c}=s,a={...i,mutate:t=>{const s=t.trans,u=s.mutatedParts||(s.mutatedParts={}),c=t=>{const n=`idb://${e}/${r}/${t}`;return u[n]||(u[n]=new fr)},a=c(""),f=c(":dels"),{type:l}=t;let[h,d]="deleteRange"===t.type?[t.range]:"delete"===t.type?[t.keys]:t.values.length<50?[[],t.values]:[];const v=t.trans.ve;return i.mutate(t).then((t=>{if(D(h)){"delete"!==l&&(h=t.results),a.addKeys(h);const e=ur(h,v);e||"add"===l||f.addKeys(h),(e||d)&&function(t,e,n,r){e.indexes.forEach((function(e){const i=t(e.name||"");function o(t){return null!=t?e.extractKey(t):null}const s=t=>e.multiEntry&&D(t)?t.forEach((t=>i.addKey(t))):i.addKey(t);(n||r).forEach(((t,e)=>{const i=n&&o(n[e]),u=r&&o(r[e]);0!==hn(i,u)&&(null!=i&&s(i),null!=u&&s(u))}))}))}(c,o,e,d)}else if(h){const t={from:h.lower,to:h.upper};f.add(t),a.add(t)}else a.add(n),f.add(n),o.indexes.forEach((t=>c(t.name).add(n)));return t}))}},f=({query:{index:e,range:n}})=>{var r,i;return[e,new fr(null!==(r=n.lower)&&void 0!==r?r:t.MIN_KEY,null!==(i=n.upper)&&void 0!==i?i:t.MAX_KEY)]},l={get:t=>[s,new fr(t.key)],getMany:t=>[s,(new fr).addKeys(t.keys)],count:f,query:f,openCursor:f};return R(l).forEach((t=>{a[t]=function(o){const{subscr:s}=ie;if(s){const a=t=>{const n=`idb://${e}/${r}/${t}`;return s[n]||(s[n]=new fr)},f=a(""),h=a(":dels"),[d,v]=l[t](o);if(a(d.name||"").add(v),!d.isPrimaryKey){if("count"!==t){const e="query"===t&&c&&o.values&&i.query({...o,values:!1});return i[t].apply(this,arguments).then((n=>{if("query"===t){if(c&&o.values)return e.then((({result:t})=>(f.addKeys(t),n)));const t=o.values?n.result.map(u):n.result;o.values?f.addKeys(t):h.addKeys(t)}else if("openCursor"===t){const t=n,e=o.values;return t&&Object.create(t,{key:{get:()=>(h.addKey(t.primaryKey),t.key)},primaryKey:{get(){const e=t.primaryKey;return h.addKey(e),e}},value:{get:()=>(e&&f.addKey(t.primaryKey),t.value)}})}return n}))}h.add(n)}}return i[t].apply(this,arguments)}})),a}}}};class mr{constructor(t,e){this.se={},this.verno=0;const n=mr.dependencies;this.xt=e={addons:mr.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...e},this.Bt={indexedDB:e.indexedDB,IDBKeyRange:e.IDBKeyRange};const{addons:r}=e;this.jt={},this.ae=[],this.ce=[],this.he={},this.idbdb=null,this.oe=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:xt,dbReadyPromise:null,cancelOpen:xt,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var o;i.dbReadyPromise=new ce((t=>{i.dbReadyResolve=t})),i.openCanceller=new ce(((t,e)=>{i.cancelOpen=e})),this._=i,this.name=t,this.on=nn(this,"populate","blocked","versionchange","close",{ready:[Mt,xt]}),this.on.ready.subscribe=W(this.on.ready.subscribe,(t=>(e,n)=>{mr.vip((()=>{const r=this._;if(r.openComplete)r.dbOpenError||ce.resolve().then(e),n&&t(e);else if(r.onReadyBeingFired)r.onReadyBeingFired.push(e),n&&t(e);else{t(e);const r=this;n||t((function t(){r.on.ready.unsubscribe(e),r.on.ready.unsubscribe(t)}))}}))})),this.Collection=(o=this,rn(yn.prototype,(function(t,e){this.db=o;let n=Ze,r=null;if(e)try{n=e()}catch(t){r=t}const i=t.Ft,s=i.table,u=s.hook.reading.fire;this.Ft={table:s,index:i.index,isPrimKey:!i.index||s.schema.primKey.keyPath&&i.index===s.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:u!==Rt?u:null}}))),this.Table=function(t){return rn(en.prototype,(function(e,n,r){this.db=t,this.Dt=r,this.name=e,this.schema=n,this.hook=t.he[e]?t.he[e].hook:nn(null,{creating:[Bt,xt],reading:[Dt,Rt],updating:[Ut,xt],deleting:[Gt,xt]})}))}(this),this.Transaction=function(t){return rn(jn.prototype,(function(e,n,r,i,o){this.db=t,this.mode=e,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=nn(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this.Vt=0,this.Xt=[],this.S=null,this.O=null,this.te=null,this.ee=null,this.ne=0,this.Ct=new ce(((t,e)=>{this.S=t,this.O=e})),this.Ct.then((()=>{this.active=!1,this.on.complete.fire()}),(t=>{var e=this.active;return this.active=!1,this.on.error.fire(t),this.parent?this.parent.O(t):e&&this.idbtrans&&this.idbtrans.abort(),He(t)}))}))}(this),this.Version=function(t){return rn(Vn.prototype,(function(e){this.db=t,this.ue={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(t){return rn(On.prototype,(function(e,n,r){this.db=t,this.Ft={table:e,index:":id"===n?null:n,or:r};const i=t.Bt.indexedDB;if(!i)throw new jt.MissingAPI;this.Ht=this.Kt=i.cmp.bind(i),this.$t=(t,e)=>i.cmp(e,t),this.Wt=(t,e)=>i.cmp(t,e)>0?t:e,this.zt=(t,e)=>i.cmp(t,e)<0?t:e,this.ye=t.Bt.IDBKeyRange}))}(this),this.on("versionchange",(t=>{t.newVersion,this.close()})),this.on("blocked",(t=>{!t.newVersion||(t.newVersion,t.oldVersion)})),this.Nt=Rn(e.IDBKeyRange),this.At=(t,e,n,r)=>new this.Transaction(t,e,n,this.xt.chromeTransactionDurability,r),this.pe=t=>{this.on("blocked").fire(t),We.filter((t=>t.name===this.name&&t!==this&&!t._.vcFired)).map((e=>e.on("versionchange").fire(t)))},this.use(ir),this.use(sr),this.use(pr),this.use(cr),this.vip=Object.create(this,{It:{value:!0}}),r.forEach((t=>t(this)))}version(t){if(isNaN(t)||t<.1)throw new jt.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._.isBeingOpened)throw new jt.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);const e=this.ae;var n=e.filter((e=>e.ue.version===t))[0];return n||(n=new this.Version(t),e.push(n),e.sort(qn),n.stores({}),this._.autoSchema=!1,n)}me(t){return this.idbdb&&(this._.openComplete||ie.letThrough||this.It)?t():new ce(((t,e)=>{if(this._.openComplete)return e(new jt.DatabaseClosed(this._.dbOpenError));if(!this._.isBeingOpened){if(!this.xt.autoOpen)return void e(new jt.DatabaseClosed);this.open().catch(xt)}this._.dbReadyPromise.then(t,e)})).then(t)}use({stack:t,create:e,level:n,name:r}){r&&this.unuse({stack:t,name:r});const i=this.se[t]||(this.se[t]=[]);return i.push({stack:t,create:e,level:null==n?10:n,name:r}),i.sort(((t,e)=>t.level-e.level)),this}unuse({stack:t,name:e,create:n}){return t&&this.se[t]&&(this.se[t]=this.se[t].filter((t=>n?t.create!==n:!!e&&t.name!==e))),this}open(){return function(t){const e=t._,{indexedDB:n}=t.Bt;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then((()=>e.dbOpenError?He(e.dbOpenError):t));vt&&(e.openCanceller.kt=wt()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new jt.DatabaseClosed("db.open() was cancelled")}let o=e.dbReadyResolve,s=null,u=!1;return ce.race([r,("undefined"==typeof navigator?ce.resolve():Zn()).then((()=>new ce(((r,o)=>{if(i(),!n)throw new jt.MissingAPI;const c=t.name,a=e.autoSchema?n.open(c):n.open(c,Math.round(10*t.verno));if(!a)throw new jt.MissingAPI;a.onerror=Tn(o),a.onblocked=Ee(t.pe),a.onupgradeneeded=Ee((r=>{if(s=a.transaction,e.autoSchema&&!t.xt.allowEmptyDB){a.onerror=In,s.abort(),a.result.close();const t=n.deleteDatabase(c);t.onsuccess=t.onerror=Ee((()=>{o(new jt.NoSuchDatabase(`Database ${c} doesnt exist`))}))}else{s.onerror=Tn(o);var i=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;u=i<1,t.oe.idbdb=a.result,Hn(t,i/10,s,o)}}),o),a.onsuccess=Ee((()=>{s=null;const n=t.oe.idbdb=a.result,i=z(n.objectStoreNames);if(i.length>0)try{const r=n.transaction(1===(o=i).length?o[0]:o,"readonly");e.autoSchema?function({oe:t},e,n){t.verno=e.version/10;const r=t.jt=Wn(0,e,n);t.ce=z(e.objectStoreNames,0),Mn(t,[t.he],R(r),r)}(t,n,r):(Jn(t,t.jt,r),function(t,e){const n=Kn(Wn(0,t.idbdb,e),t.jt);n.add.length||n.change.some((t=>t.add.length||t.change.length))}(t,r)),Fn(t,r)}catch(t){}var o;We.push(t),n.onversionchange=Ee((n=>{e.vcFired=!0,t.on("versionchange").fire(n)})),n.onclose=Ee((e=>{t.on("close").fire(e)})),u&&function({indexedDB:t,IDBKeyRange:e},n){!Xn(t)&&"__dbnames"!==n&&Yn(t,e).put({name:n}).catch(xt)}(t.Bt,c),r()}),o)}))))]).then((()=>(i(),e.onReadyBeingFired=[],ce.resolve(Qn((()=>t.on.ready.fire(t.vip)))).then((function n(){if(e.onReadyBeingFired.length>0){let r=e.onReadyBeingFired.reduce(Mt,xt);return e.onReadyBeingFired=[],ce.resolve(Qn((()=>r(t.vip)))).then(n)}}))))).finally((()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1})).then((()=>t)).catch((n=>{e.dbOpenError=n;try{s&&s.abort()}catch(t){}return r===e.openCanceller&&t.Pt(),He(n)})).finally((()=>{e.openComplete=!0,o()}))}(this)}Pt(){const t=this._,e=We.indexOf(this);if(e>=0&&We.splice(e,1),this.idbdb){try{this.idbdb.close()}catch(t){}this.oe.idbdb=null}t.dbReadyPromise=new ce((e=>{t.dbReadyResolve=e})),t.openCanceller=new ce(((e,n)=>{t.cancelOpen=n}))}close(){this.Pt();const t=this._;this.xt.autoOpen=!1,t.dbOpenError=new jt.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)}delete(){const t=arguments.length>0,e=this._;return new ce(((n,r)=>{const i=()=>{this.close();var t=this.Bt.indexedDB.deleteDatabase(this.name);t.onsuccess=Ee((()=>{!function({indexedDB:t,IDBKeyRange:e},n){!Xn(t)&&"__dbnames"!==n&&Yn(t,e).delete(n).catch(xt)}(this.Bt,this.name),n()})),t.onerror=Tn(r),t.onblocked=this.pe};if(t)throw new jt.InvalidArgument("Arguments not allowed in db.delete()");e.isBeingOpened?e.dbReadyPromise.then(i):i()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const t=this._.dbOpenError;return t&&"DatabaseClosed"===t.name}hasFailed(){return null!==this._.dbOpenError}dynamicallyOpened(){return this._.autoSchema}get tables(){return R(this.he).map((t=>this.he[t]))}transaction(){const t=er.apply(this,arguments);return this.we.apply(this,t)}we(t,e,n){let r=ie.trans;r&&r.db===this&&-1===t.indexOf("!")||(r=null);const i=-1!==t.indexOf("?");let o,s;t=t.replace("!","").replace("?","");try{if(s=e.map((t=>{var e=t instanceof this.Table?t.name:t;if("string"!=typeof e)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return e})),"r"==t||"readonly"===t)o="readonly";else{if("rw"!=t&&"readwrite"!=t)throw new jt.InvalidArgument("Invalid transaction mode: "+t);o="readwrite"}if(r){if("readonly"===r.mode&&"readwrite"===o){if(!i)throw new jt.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&s.forEach((t=>{if(r&&-1===r.storeNames.indexOf(t)){if(!i)throw new jt.SubTransaction("Table "+t+" not included in parent transaction.");r=null}})),i&&r&&!r.active&&(r=null)}}catch(t){return r?r.Tt(null,((e,n)=>{n(t)})):He(t)}const u=nr.bind(null,this,o,s,r,n);return r?r.Tt(o,u,"lock"):ie.trans?Ue(ie.transless,(()=>this.me(u))):this.me(u)}table(t){if(!U(this.he,t))throw new jt.InvalidTable(`Table ${t} does not exist`);return this.he[t]}}const wr="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class br{constructor(t){this.be=t}subscribe(t,e,n){return this.be(t&&"function"!=typeof t?t:{next:t,error:e,complete:n})}[wr](){return this}}function gr(t,e){return R(e).forEach((n=>{hr(t[n]||(t[n]=new fr),e[n])})),t}let _r;try{_r={indexedDB:x.indexedDB||x.mozIndexedDB||x.webkitIndexedDB||x.msIndexedDB,IDBKeyRange:x.IDBKeyRange||x.webkitIDBKeyRange}}catch(x){_r={indexedDB:null,IDBKeyRange:null}}const kr=mr;function Er(t){let e=Sr;try{Sr=!0,An.storagemutated.fire(t)}finally{Sr=e}}F(kr,{...Ct,delete:t=>new kr(t,{addons:[]}).delete(),exists:t=>new kr(t,{addons:[]}).open().then((t=>(t.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(t){try{return function({indexedDB:t,IDBKeyRange:e}){return Xn(t)?Promise.resolve(t.databases()).then((t=>t.map((t=>t.name)).filter((t=>"__dbnames"!==t)))):Yn(t,e).toCollection().primaryKeys()}(kr.dependencies).then(t)}catch(t){return He(new jt.MissingAPI)}},defineClass:()=>function(t){N(this,t)},ignoreTransaction:t=>ie.trans?Ue(ie.transless,t):t(),vip:Qn,async:function(t){return function(){try{var e=tr(t.apply(this,arguments));return e&&"function"==typeof e.then?e:ce.resolve(e)}catch(t){return He(t)}}},spawn:function(t,e,n){try{var r=tr(t.apply(n,e||[]));return r&&"function"==typeof r.then?r:ce.resolve(r)}catch(t){return He(t)}},currentTransaction:{get:()=>ie.trans||null},waitFor:function(t,e){const n=ce.resolve("function"==typeof t?kr.ignoreTransaction(t):t).timeout(e||6e4);return ie.trans?ie.trans.waitFor(n):n},Promise:ce,debug:{get:()=>vt,set:t=>{yt(t,"dexie"===t?()=>!0:Xe)}},derive:q,extend:N,props:F,override:W,Events:nn,on:An,liveQuery:function(t){return new br((e=>{const n=dt(t);let r=!1,i={},o={};const s={get closed(){return r},unsubscribe:()=>{r=!0,An.storagemutated.unsubscribe(f)}};e.start&&e.start(s);let u=!1,c=!1;function a(){return R(o).some((t=>i[t]&&function(t,e){const n=dr(e);let r=n.next();if(r.done)return!1;let i=r.value;const o=dr(t);let s=o.next(i.from),u=s.value;for(;!r.done&&!s.done;){if(hn(u.from,i.to)<=0&&hn(u.to,i.from)>=0)return!0;hn(i.from,u.from)<0?i=(r=n.next(u.from)).value:u=(s=o.next(i.from)).value}return!1}(i[t],o[t])))}const f=t=>{gr(i,t),a()&&l()},l=()=>{if(u||r)return;i={};const h={},d=function(e){n&&Ce();const r=()=>Pe(t,{subscr:e,trans:null}),i=ie.trans?Ue(ie.transless,r):r();return n&&i.then(xe,xe),i}(h);c||(An("storagemutated",f),c=!0),u=!0,Promise.resolve(d).then((t=>{u=!1,r||(a()?l():(i={},o=h,e.next&&e.next(t)))}),(t=>{u=!1,e.error&&e.error(t),s.unsubscribe()}))};return l(),s}))},extendObservabilitySet:gr,getByKeyPath:X,setByKeyPath:Q,delByKeyPath:function(t,e){"string"==typeof e?Q(t,e,void 0):"length"in e&&[].map.call(e,(function(e){Q(t,e,void 0)}))},shallowClone:Z,deepClone:ot,getObjectDiff:or,cmp:hn,asap:V,minKey:-1/0,addons:[],connections:We,errnames:It,dependencies:_r,semVer:"3.2.2",version:"3.2.2".split(".").map((t=>parseInt(t))).reduce(((t,e,n)=>t+e/Math.pow(10,2*n)))}),kr.maxKey=Rn(kr.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(An("storagemutated",(t=>{if(!Sr){let e;Je?(e=document.createEvent("CustomEvent"),e.initCustomEvent("x-storagemutated-1",!0,!0,t)):e=new CustomEvent("x-storagemutated-1",{detail:t}),Sr=!0,dispatchEvent(e),Sr=!1}})),addEventListener("x-storagemutated-1",(({detail:t})=>{Sr||Er(t)})));let Sr=!1;if("undefined"!=typeof BroadcastChannel){const t=new BroadcastChannel("x-storagemutated-1");An("storagemutated",(e=>{Sr||t.postMessage(e)})),t.onmessage=t=>{t.data&&Er(t.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){An("storagemutated",(t=>{try{Sr||("undefined"!=typeof localStorage&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:t})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((e=>e.postMessage({type:"x-storagemutated-1",changedParts:t}))))}catch(t){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(t=>{if("x-storagemutated-1"===t.key){const e=JSON.parse(t.newValue);e&&Er(e.changedParts)}}));const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",(function({data:t}){t&&"x-storagemutated-1"===t.type&&Er(t.changedParts)}))}ce.rejectionMapper=function(t,e){if(!t||t instanceof Et||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Pt[t.name])return t;var n=new Pt[t.name](e||t.message,t);return"stack"in t&&L(n,"stack",{get:function(){return this.inner.stack}}),n},yt(vt,Xe);var Or=__webpack_require__(6304);const Tr=["2 girls 1 cup","anal","anus","areole","arian","arrse","arse","arsehole","aryan","asanchez","ass","assbang","assbanged","asses","assfuck","assfucker","assfukka","asshole","assmunch","asswhole","autoerotic","ballsack","bastard","bdsm","beastial","beastiality","bellend","bestial","bestiality","bimbo","bimbos","bitch","bitches","bitchin","bitching","blowjob","blowjobs","blue waffle","bondage","boner","boob","boobs","booobs","boooobs","booooobs","booooooobs","booty call","breasts","brown shower","brown showers","buceta","bukake","bukkake","bullshit","busty","butthole","carpet muncher","cawk","chink","cipa","clit","clitoris","clits","cnut","cock","cockface","cockhead","cockmunch","cockmuncher","cocks","cocksuck","cocksucked","cocksucker","cocksucking","cocksucks","cokmuncher","coon","cowgirl","cowgirls","crap","crotch","cum","cuming","cummer","cumming","cums","cumshot","cunilingus","cunillingus","cunnilingus","cunt","cuntlicker","cuntlicking","cunts","damn","deepthroat","dick","dickhead","dildo","dildos","dink","dinks","dlck","dog style","dog-fucker","doggiestyle","doggin","dogging","doggystyle","dong","donkeyribber","doofus","doosh","dopey","douche","douchebag","douchebags","douchey","drunk","duche","dumass","dumbass","dumbasses","dummy","dyke","dykes","eatadick","eathairpie","ejaculate","ejaculated","ejaculates","ejaculating","ejaculatings","ejaculation","ejakulate","enlargement","erect","erection","erotic","erotism","essohbee","extacy","extasy","facial","fack","fag","fagg","fagged","fagging","faggit","faggitt","faggot","faggs","fagot","fagots","fags","faig","faigt","fanny","fannybandit","fannyflaps","fannyfucker","fanyy","fart","fartknocker","fat","fatass","fcuk","fcuker","fcuking","feck","fecker","felch","felcher","felching","fellate","fellatio","feltch","feltcher","femdom","fingerfuck","fingerfucked","fingerfucker","fingerfuckers","fingerfucking","fingerfucks","fingering","fisted","fistfuck","fistfucked","fistfucker","fistfuckers","fistfucking","fistfuckings","fistfucks","fisting","fisty","flange","flogthelog","floozy","foad","fondle","foobar","fook","fooker","footjob","foreskin","freex","frigg","frigga","fubar","fuck","fucka","fuckass","fuckbitch","fucked","fucker","fuckers","fuckface","fuckhead","fuckheads","fuckhole","fuckin","fucking","fuckings","fuckingshitmotherfucker","fuckme","fuckmeat","fucknugget","fucknut","fuckoff","fuckpuppet","fucks","fucktard","fucktoy","fucktrophy","fuckup","fuckwad","fuckwhit","fuckwit","fuckyomama","fudgepacker","fuk","fuker","fukker","fukkin","fukking","fuks","fukwhit","fukwit","futanari","futanary","fux","fuxor","fxck","gae","gai","gangbang","gangbanged","gangbangs","ganja","gassyass","gay","gaylord","gays","gaysex","gey","gfy","ghay","ghey","gigolo","glans","goatse","god","godamn","godamnit","goddam","goddammit","goddamn","goddamned","gokkun","goldenshower","gonad","gonads","gook","gooks","gringo","gspot","gtfo","guido","hamflap","handjob","hardcoresex","hardon","hebe","heeb","hell","hemp","hentai","heroin","herp","herpes","herpy","heshe","hitler","hiv","hoar","hoare","hobag","hoer","homey","homo","homoerotic","homoey","honky","hooch","hookah","hooker","hoor","hootch","hooter","hooters","hore","horniest","horny","hotsex","howtokill","howtomurdep","hump","humped","humping","hussy","hymen","inbred","incest","injun","jackass","jackhole","jackoff","jap","japs","jerk","jerked","jerkoff","jism","jiz","jizm","jizz","jizzed","junkie","junky","kawk","kike","kikes","kill","kinbaku","kinky","kinkyJesus","kkk","klan","knob","knobead","knobed","knobend","knobhead","knobjocky","knobjokey","kock","kondum","kondums","kooch","kooches","kootch","kraut","kum","kummer","kumming","kums","kunilingus","kwif","kyke","l3itch","labia","lech","len","leper","lesbians","lesbo","lesbos","lez","lezbian","lezbians","lezbo","lezbos","lezzie","lezzies","lezzy","lmao","lmfao","loin","loins","lube","lust","lusting","lusty","m-fucking","mafugly","mams","masochist","massa","masterb8","masterbate","masterbating","masterbation","masterbations","masturbate","masturbating","masturbation","maxi","menses","menstruate","menstruation","meth","milf","mofo","molest","moolie","moron","mothafuck","mothafucka","mothafuckas","mothafuckaz","mothafucked","mothafucker","mothafuckers","mothafuckin","mothafucking","mothafuckings","mothafucks","motherfuck","motherfucka","motherfucked","motherfucker","motherfuckers","motherfuckin","motherfucking","motherfuckings","motherfuckka","motherfucks","mtherfucker","mthrfucker","mthrfucking","muff","muffdiver","muffpuff","murder","mutha","muthafecker","muthafuckaz","muthafucker","muthafuckker","muther","mutherfucker","mutherfucking","muthrfucking","nad","nads","naked","napalm","nappy","nazi","nazism","needthedick","negro","nig","nigg","nigga","niggah","niggas","niggaz","nigger","niggers","niggle","niglet","nimrod","ninny","nipple","nipples","nob","nobhead","nobjocky","nobjokey","nooky","nude","nudes","numbnuts","nutbutter","nutsack","nympho","omg","opiate","opium","oral","orally","organ","orgasim","orgasims","orgasm","orgasmic","orgasms","orgies","orgy","ovary","ovum","ovums","paddy","paki","pantie","panties","panty","pastie","pasty","pawn","pcp","pecker","pedo","pedophile","pedophilia","pedophiliac","pee","peepee","penetrate","penetration","penial","penile","penis","penisfucker","perversion","peyote","phalli","phallic","phonesex","phuck","phuk","phuked","phuking","phukked","phukking","phuks","phuq","pigfucker","pillowbiter","pimp","pimpis","pinko","piss","pissed","pisser","pissers","pisses","pissflaps","pissin","pissing","pissoff","playboy","pms","polack","pollock","poon","poontang","poop","porn","porno","pornography","pornos","pot","potty","prick","pricks","prig","pron","prostitute","prude","pube","pubic","pubis","punkass","punky","puss","pusse","pussi","pussies","pussy","pussyfart","pussypalace","pussypounder","pussys","puto","queaf","queef","queer","queero","queers","quicky","quim","racy","rape","raped","raper","raping","rapist","raunch","rectal","rectum","rectus","reefer","reetard","reich","retard","retarded","revue","rimjaw","rimjob","rimming","ritard","rtard","rum","rump","rumprammer","ruski","sadism","sadist","sandbar","sausagequeen","scag","scantily","schizo","schlong","screw","screwed","screwing","scroat","scrog","scrot","scrote","scrotum","scrud","scum","seaman","seamen","seduce","semen","sex","sexual","shag","shagger","shaggin","shagging","shamedame","shemale","shibari","shibary","shit","shitdick","shite","shiteater","shited","shitey","shitface","shitfuck","shitfucker","shitfull","shithead","shithole","shithouse","shiting","shitings","shits","shitt","shitted","shitter","shitters","shitting","shittings","shitty","shiz","shota","sissy","skag","skank","slave","sleaze","sleazy","slope","slut","slutbucket","slutdumper","slutkiss","sluts","smegma","smut","smutty","snatch","sniper","snuff","sob","sodom","son-of-a-bitch","souse","soused","spac","sperm","spic","spick","spik","spiks","spooge","spunk","steamy","stfu","stiffy","stoned","strip","strip club","stripclub","stroke","stupid","suck","sucked","sucking","sumofabiatch","tampon","tard","tawdry","teabagging","teat","teets","teez","terd","teste","testee","testes","testical","testicle","testis","threesome","throating","thrust","thug","tinkle","tit","titfuck","titi","tits","titt","tittiefucker","titties","titty","tittyfuck","tittyfucker","tittywank","titwank","toke","toots","tosser","tramp","transsexual","trashy","tubgirl","turd","tush","twat","twathead","twats","twatty","twunt","twunter","ugly","undies","unwed","urinal","urine","uterus","uzi","vag","vagina","vaginas","valium","viagra","vigra","virgin","vixen","vodka","vomit","voyeur","vulgar","vulva","wad","wang","wank","wanker","wanky","wazoo","wedgie","weed","weenie","weewee","weiner","weirdo","wench","wetback","whitey","whiz","whoar","whoralicious","whore","whorealicious","whored","whoreface","whorehopper","whorehouse","whores","whoring","wigger","willies","willy","womb","woody","woose","wop","wtf","x-rated2g1c","xx","xxx","yaoi","yury"];var Ir=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};let Ar="";const jr=!1;let Pr,Cr;const xr=t=>{new Date;Ar=new mr(t),Ar.version(1).stores({documents:"++id, indexed_at, created_at, site, site_identifier, content, metadata, score, use_count, site_username, css_identifier, url, deleted_at",sections:"++id, parentid, content"}),Pr=new Or.Index({language:"us"}),Cr=new Or.Document({document:{id:"id",index:[{field:"content",language:"us"},{field:"parentid"}]}}),Ar.documents.count().then((t=>{t>0&&Ar.documents.toArray().then((t=>{t.forEach((t=>{Pr.add(t.id,t.content)}))}))})),Ar.sections.toArray().then((t=>{t.forEach((t=>{var e;Cr.add({id:t.id,content:null===(e=t.content)||void 0===e?void 0:e.toLowerCase(),parentid:t.parentid})}))}))},Rr=(t,e=-1)=>{var n,r,i,o,s;let u=[];if(u=e?(null===(n=null==e?void 0:e.settings)||void 0===n?void 0:n.excludedWords)?null===(s=null===(o=null===(i=null===(r=null==e?void 0:e.settings)||void 0===r?void 0:r.excludedWords)||void 0===i?void 0:i.toString())||void 0===o?void 0:o.split(","))||void 0===s?void 0:s.filter((t=>!!t.trim())):[]:Tr,u=null==u?void 0:u.filter((t=>!!t.trim())).map((t=>`\\b${t}\\b`)),u.length){let e=new RegExp(null==u?void 0:u.join("|"),"gi");if(t.match(e))return!1}return!0},Dr=({createdAt:t,site:e,siteIdentifier:n,content:r,metadata:i,score:o,useCount:s,siteUsername:u,cssIdentifier:c,url:a,manual:f})=>Ir(void 0,void 0,void 0,(function*(){new Date;let l=!0;if(f||(l=yield Zr().then((t=>Rr(r,t)))),!l)return{status:"unsaved",message:"User filter"};const h=e?yield Ar.documents.where({site:e,site_identifier:n}).first():yield Ar.documents.where({site_identifier:n}).first();let d=null;return h?(d=yield Ar.documents.update(h.id,{indexed_at:(new Date).getTime(),created_at:t,site:e,site_identifier:n,content:r,metadata:i,score:o,use_count:s,site_username:u,css_identifier:c,url:a,deleted_at:null}),Pr.update(d,r)):(d=yield Ar.documents.add({indexed_at:(new Date).getTime(),created_at:t,site:e,site_identifier:n,content:r,metadata:i,score:o,use_count:s,site_username:u,css_identifier:c,url:a,deleted_at:null}),Pr.add(d,r)),yield((t,e)=>Ir(void 0,void 0,void 0,(function*(){yield Ar.sections.where("parentid").equals(e).delete(),Cr.remove({parentid:e});let n=[],r=(null==t?void 0:t.split(/[.?!]/))||[],i="";for(let t=0;t<r.length;t++)r[t].length>0&&(i+=r[t]+"."),i.length>0&&(t%4==0||t===r.length-1)&&(Rr(i)&&n.push({id:Math.floor(1e10*Math.random()),content:i.toLowerCase(),parentid:e}),i="");yield Ar.sections.bulkAdd(n),n.forEach((t=>{Cr.add({id:t.id,content:t.content,parentid:t.parentid})}))})))(r,d),{status:"saved",message:"Document indexed"}})),Nr=({id:t,site:e,siteIdentifier:n})=>Ir(void 0,void 0,void 0,(function*(){let e="";if(t)e=t,yield Ar.documents.update(t,{content:null,metadata:null,deleted_at:(new Date).getTime()}),Pr.remove(t);else{jr;const t=yield Ar.documents.where({site_identifier:n}).first();jr,t&&(e=t.id,yield Ar.documents.update(e,{content:null,metadata:null,deleted_at:(new Date).getTime()}),Pr.remove(e))}yield Ar.sections.where("parentid").equals(e).delete();const r=Cr.search(e,{index:["parentid"]});r.forEach((t=>{var e;null===(e=t.result)||void 0===e||e.forEach((t=>{Cr.remove(t)}))}))}));var Br=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};let Gr,Ur,Fr,Mr,Lr=!0;const qr="tokens",Hr="token";let Kr=null;chrome.runtime.onMessageExternal.addListener((function(t,e,n){var r;return Br(this,void 0,void 0,(function*(){if("token"===t.type&&t.token){Vr(),yield $r(t.token);const e=Yr(t.token)["https://example.com/email"];e!==Kr&&(Kr=e,xr(e)),(null===(r=null==t?void 0:t.user)||void 0===r?void 0:r.picture)&&chrome.storage.local.set({userPicture:t.user.picture},(function(){})),n({success:!0})}else"getVersion"===t.type&&n({success:200,version:chrome.runtime.getManifest().version})}))}));const $r=t=>Br(void 0,void 0,void 0,(function*(){const e=yield ei({auth0AccessToken:t});Gr=e.token;const n=Yr(Gr);Ur=1e3*n.exp,yield Jr(Gr),Fr=yield ti({refreshToken:Gr});const r=Yr(Fr);Mr=1e3*r.exp-6e4})),zr=()=>Br(void 0,void 0,void 0,(function*(){if(Fr&&Mr>=Date.now())return Fr;if(Gr&&Ur>=Date.now()){const t=yield ti({refreshToken:Gr});Fr=t.token;const e=Yr(Fr);return Mr=1e3*e.exp-6e4,Fr}return Promise.reject({error:"login_required"})})),Wr=()=>new Promise(((t,e)=>{try{let n=indexedDB.open("tokenDB",1);n.onerror=function(t){e(t.target.error)},n.onsuccess=function(e){let n=e.target.result;t(n)},n.onupgradeneeded=function(t){let e=t.target.result;e.objectStoreNames.contains(qr)||e.createObjectStore(qr)}}catch(t){e(t)}})),Jr=t=>new Promise(((e,n)=>{t&&Wr().then((r=>{let i=r.transaction(qr,"readwrite");i.objectStore(qr).put(t,Hr),i.onerror=function(t){n(t.target.error)},i.oncomplete=function(){e(t)}})).catch((t=>{A(t),n(t)}))}));new Promise(((t,e)=>{Wr().then((n=>{let r=n.transaction(qr,"readonly").objectStore(qr).get(Hr);r.onerror=function(t){e(t.target.error)},r.onsuccess=function(e){return Br(this,void 0,void 0,(function*(){let n="";try{n=e.target.result}catch(e){return void t(null)}if(!n)return void t(null);const r=Yr(n),i=r["https://example.com/email"];i&&xr(i),Gr=n,Ur=1e3*r.exp;const o=yield ti({refreshToken:Gr}).catch((t=>{A(t)})),s=null==o?void 0:o.token;if(s){Fr=s;const t=Yr(s);Mr=1e3*t.exp}return t(n)}))}})).catch((t=>{e(t),A(t)}))}));const Vr=()=>(Gr=null,Ur=null,Fr=null,Mr=null,new Promise((()=>{Wr().then((t=>{t.transaction(qr,"readwrite").objectStore(qr).clear()}))}))),Yr=t=>{try{let e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(e).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(n)}catch(t){return{}}};var Xr=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};const Qr=C.BASE_URL,Zr=()=>Xr(void 0,void 0,void 0,(function*(){const t=Qr+"/loadUserExternalSettings",e=yield zr(),n=new FormData;return n.append("subscriptionData","true"),fetch(t,{method:"POST",body:n,headers:{Authorization:`Bearer ${e}`}}).then((t=>t.ok?t.json():{success:!1})).catch((t=>(A(t),{success:!1})))})),ti=({refreshToken:t})=>Xr(void 0,void 0,void 0,(function*(){let e={method:"POST",headers:{Authorization:`Bearer ${t}`}};return P({category:"hyperwriteAPI",message:"hyperwriteAPI::getOthersideAccessToken",level:"info"}),fetch("https://api.hyperwriteai.com/getOthersideAccessToken",e).then((t=>t.json())).catch((t=>{throw A(t),t}))})),ei=({auth0AccessToken:t})=>Xr(void 0,void 0,void 0,(function*(){return fetch("https://api.hyperwriteai.com/getOthersideRefreshToken",{method:"POST",headers:{Authorization:`Bearer ${t}`}}).then((t=>t.json())).catch((t=>{throw A(t),t}))})),ni=({name:t,source:e="Not specified",isError:n="false",metadata:r={}})=>Xr(void 0,void 0,void 0,(function*(){let i=new FormData;const o=yield zr();let s={version:chrome.runtime.getManifest().version};r&&(r=Object.assign(Object.assign({},s),r)),i.append("name",t),i.append("source",e),i.append("isError",n),i.append("metadata",JSON.stringify(r));let u={method:"POST",body:i,redirect:"follow",headers:{Authorization:`Bearer ${o}`}};return yield fetch(Qr+"/clientEvent",u).then((t=>t.json())).catch((t=>(A(t),["Error saving"])))}));var ri=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};const ii={h1:"https://api.hyperwriteai.com/",a1:"https://otherside-authedflaskapi.zeet-otherside.zeet.app/",l1:"http://127.0.0.1:5000/",c1:"https://typeaheads.hyperwriteai.com/",d1:"https://hyperwrite-api-dev.herokuapp.com/",z1:"https://typeaheads.hyperwriteai.com/"};let oi=ii.h1,si=C.OVERRIDE_TYPEAHEAD_URL||ii.z1;const ui=({isEarlyTypeahead:t,typeaheadMetadata:e,text:n,title:r="Email",description:i="Email",history:o,priorText:s,email:u="",doSpeedy:c,app:a="",history_format:f="",metadata:l={},temperature:h,gens:d,tokens:v,reason:y="",similarSnippets:p=[],typeaheadLength:m="short",typeaheadCreativity:w="default"})=>ri(void 0,void 0,void 0,(function*(){let b=new FormData;const g=yield zr();b.append("writing",n),b.append("title",r),b.append("description",i),b.append("snippets",JSON.stringify(p)),b.append("typeaheadLength",m),b.append("typeaheadCreativity",w),(null==e?void 0:e.history)&&(e.history=[...e.history,{time:(new Date).getTime(),function:"api_leaving_getTypeAheads",timeTaken:(new Date).getTime()-e.history.slice(-1)[0].time}]),b.append("typeaheadMetadata",JSON.stringify(e)),b.append("website","Superhuman"),b.append("withScores","true"),t&&b.append("isEarlyTypeahead","true"),o&&b.append("history",JSON.stringify(o)),s&&b.append("priorText",s),c&&b.append("doSpeedy",c),a&&b.append("app",a),f&&b.append("history_format",f),l&&b.append("metadata",JSON.stringify(l)),h&&b.append("temperature",h),d&&b.append("gens",d),v&&b.append("tokens",v),y&&b.append("reason",y),b.append("allowPartial","true"),b.append("version","0.0.3");let _={method:"POST",body:b,redirect:"follow",headers:{Authorization:`Bearer ${g}`}},k=(new Date).getTime();const E=yield fetch(si+"/typeaheadnsorted",_).then((t=>t.json())).catch((t=>(A(t),["Error generating typeahead"])));if(u.endsWith("@othersideai.com")){(new Date).getTime();false}return E.setEndpoint&&(t=>{const e=ii[t];e&&(si=e),C.OVERRIDE_TYPEAHEAD_URL&&(oi=C.OVERRIDE_TYPEAHEAD_URL)})(E.setEndpoint),E}));var ci=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var ai=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};const fi=!1;let li="";function hi(t){if("authentication"===t.name&&t.onMessage.addListener((function(e){return ai(this,void 0,void 0,(function*(){if("login"===e.action){fi,chrome.storage.local.set({authenticated:!1},(()=>{fi}));const n=100;yield new Promise((t=>setTimeout(t,n)));let r="",i="";try{fi,r=yield zr().catch((e=>{i=e.error,A(e),"login_required"===(null==e?void 0:e.error)&&t.postMessage({function:"checkAccessCall",loginError:!0,status:"error"})}))}catch(t){fi}if(chrome.storage.local.get(["authedId"],(t=>{if(r){const e=di(r)["https://example.com/userid"],n=chrome.runtime.getManifest().version;!t.authedId&&e&&(chrome.storage.local.set({authedId:e},(()=>{})),chrome.runtime.setUninstallURL(`https://app.hyperwriteai.com/uninstall?user=${e}&version=${n}`))}})),r){const n=di(r)["https://example.com/email"];chrome.storage.local.set({authenticated:!0},(()=>{fi})),yield function({site:t,isAuthed:e,universalOn:n,port:r,email:i}){return ai(this,void 0,void 0,(function*(){Iu.includes(t)&&(e=!1),r.postMessage({result:{authed:e,email:i,universalOn:n},email:i,status:"complete",function:"checkAccessCall"})}))}({site:e.site,isAuthed:!0,port:t,email:n})}else"login_required"===i&&t.postMessage({function:"checkAccessCall",status:"error"})}}))})),"acceptGenerationOption"===t.name&&t.onMessage.addListener((function(e){(({suggestionKey:t,option:e})=>Xr(void 0,void 0,void 0,(function*(){const n=Qr+"/acceptsuggestion",r=yield zr();let i=new FormData;return i.append("key",t),i.append("option",e),yield fetch(n,{method:"POST",body:i,headers:{Authorization:`Bearer ${r}`}}).then((t=>t.json())).catch((t=>{A(t)}))})))({suggestionKey:e.key,option:e.index}).then((e=>{t.postMessage(e)}))})),"loadDocumentSettings"===t.name)try{t.onMessage.addListener((function(e){const n=null==e?void 0:e.url.substr(35,44);(({source:t,source_identifier:e})=>Xr(void 0,void 0,void 0,(function*(){const n=Qr+"/loadExternalSettings",r=yield zr();P({category:"hyperwriteAPI",message:"hyperwriteAPI::loadSettings",level:"info"});let i=new FormData;return i.append("source",t),i.append("source_identifier",e),yield fetch(n,{method:"POST",body:i,headers:{Authorization:`Bearer ${r}`}}).then((t=>t.json())).catch((t=>{A(t)}))})))({source:e.source,source_identifier:n}).then((e=>{t.postMessage(e)}))}))}catch(e){t.postMessage(e)}if("loadUserSettings"===t.name)try{t.onMessage.addListener((function(){Zr().then((e=>{if(null==e?void 0:e.disable_otherside_auth){if(!!Lr&&(Vr(),Gr=void 0,Ur=void 0,Fr=void 0,Mr=void 0,Lr=!1,!0))return}if(null==e?void 0:e.enable_otherside_auth){if(!Lr&&(Lr=!0,Gr=void 0,Ur=void 0,Fr=void 0,Mr=void 0,!0))return}"token expired"!==(null==e?void 0:e.status)?t.postMessage(e):Vr()}))}))}catch(e){t.postMessage(e)}if("getWorkflows"===t.name)try{t.onMessage.addListener((function(){(({})=>ci(void 0,void 0,void 0,(function*(){const t=yield zr();return fetch(Qr+"/get_workflows",{method:"POST",headers:{Authorization:`Bearer ${t}`}}).then((t=>t.json())).then((t=>({payload:t,status:"success"}))).catch((t=>({status:"error",error:t})))})))({}).then((e=>{t.postMessage(e)}))}))}catch(e){t.postMessage(e)}if("cancelWorkflow"===t.name)try{t.onMessage.addListener((function(e){(({sessionId:t})=>ci(void 0,void 0,void 0,(function*(){const e=yield zr(),n=new FormData;return n.append("workflow_status","cancelled"),n.append("session_id",t),fetch(Qr+"/update_workflow",{method:"POST",body:n,headers:{Authorization:`Bearer ${e}`}}).then((t=>t.json())).then((t=>({payload:t,status:"success"}))).catch((t=>({status:"error",error:t})))})))({sessionId:e.sessionId}).then((e=>{t.postMessage(e)}))}))}catch(e){t.postMessage(e)}if("saveWorkflow"===t.name)try{t.onMessage.addListener((function(e){(({sessionId:t})=>ci(void 0,void 0,void 0,(function*(){const e=yield zr(),n=new FormData;return n.append("workflow_status","completed"),n.append("session_id",t),fetch(Qr+"/update_workflow",{method:"POST",body:n,headers:{Authorization:`Bearer ${e}`}}).then((t=>t.json())).then((t=>({payload:t,status:"success"}))).catch((t=>({status:"error",error:t})))})))({sessionId:e.sessionId}).then((e=>{t.postMessage(e)}))}))}catch(e){t.postMessage(e)}if("checkModels"===t.name)try{t.onMessage.addListener((function(){chrome.tabs.query({currentWindow:!0,active:!0},(function(){Xr(void 0,void 0,void 0,(function*(){const t=yield zr();P({category:"hyperwriteAPI",message:"hyperwriteAPI::checkAvailableModels",level:"info"});let e={method:"GET",headers:{Authorization:`Bearer ${t}`}};return yield fetch(Qr+"/checkAvailableModels",e).then((t=>t.json())).catch((t=>(A(t),t)))})).then((e=>{t.postMessage(e)}))}))}))}catch(e){t.postMessage(e)}if("postGenerationFeedback"===t.name)try{t.onMessage.addListener((function(t){chrome.tabs.query({currentWindow:!0,active:!0},(function(){(({content_type:t,related_content:e,reason:n,user_comment:r})=>{Xr(void 0,void 0,void 0,(function*(){const i=yield zr(),o=Qr+"/submitSuggestionFeedback";let s=new FormData;return s.append("content_type",t),s.append("related_content",e),s.append("reason",n),s.append("user_comment",r),yield fetch(o,{method:"POST",body:s,headers:{Authorization:`Bearer ${i}`}}).then((t=>{})).catch((t=>(A(t),{})))}))})({content_type:t.content_type,related_content:t.related_content,reason:t.reason,user_comment:t.user_comment})}))}))}catch(e){t.postMessage(e)}if("saveExampleEmails"===t.name)try{t.onMessage.addListener((function(e){return ai(this,void 0,void 0,(function*(){ni({name:"Indexing: Index local document",source:e.platform});const n=yield Dr({site:e.platform,siteIdentifier:e.id,url:e.url,content:e.text,id:e.id,manual:e.manual});t.postMessage(n)}))}))}catch(e){t.postMessage(e)}if("checkSavedEmailIndexedStatus"===t.name)try{t.onMessage.addListener((function(e){return ai(this,void 0,void 0,(function*(){t.postMessage({status:"ack"});let n=!1;const{id:r}=e.email[0];n=yield(({site:t,siteIdentifier:e})=>Ir(void 0,void 0,void 0,(function*(){const n=t?yield Ar.documents.where({site:t,site_identifier:e}).first():yield Ar.documents.where({site_identifier:e}).first();return n?n.deleted_at&&!n.content?-1:{results:{[e]:"saved"}}:{results:{[e]:"unsaved"}}})))({siteIdentifier:r}),t.postMessage({indexedStatus:n,contentId:e.id})}))}))}catch(e){t.postMessage(e)}if("removeExampleEmail"===t.name)try{t.onMessage.addListener((function(t){return ai(this,void 0,void 0,(function*(){ni({name:"Indexing: Delete local document",source:t.platform}),Nr({siteIdentifier:t.id,site:t.platform})}))}))}catch(e){t.postMessage(e)}"getTypeAheads"===t.name&&t.onMessage.addListener((function(e){t.postMessage({status:"getting typeaheds"}),function({port:t,message:e}){ai(this,void 0,void 0,(function*(){let n=e.typeaheadMetadata;(null==n?void 0:n.history)&&(n.history=[...n.history,{time:(new Date).getTime(),function:"background_leaving_callTypeahead",timeTaken:(new Date).getTime()-n.history.slice(-1)[0].time}]);const r=e.contentIdentifier||"";let i=[];e.ignoreSearch||(i=yield((t,e)=>Ir(void 0,void 0,void 0,(function*(){var n;if(!t)return[];let r="";if(e){const t=yield Ar.documents.where({site_identifier:e}).first();t&&(r=t.id)}let i=Pr.search(t,5,{suggest:!0});i&&r&&(i=i.filter((t=>t!==r)));const o=Cr.search({parentid:i,index:["content"],query:t.trim(),expand:!0,suggest:!0,limit:6});let s=[];const u=null===(n=null==o?void 0:o[0])||void 0===n?void 0:n.result;if(null==u?void 0:u.length)for(let t=0;t<u.length;t++){const e=yield Ar.sections.get(u[t]);if(e){const t=e.content;s.push({text:t})}}return s})))(e.text,r)),ui({isEarlyTypeahead:e.isEarlyTypeahead,typeaheadMetadata:n,text:e.text,title:e.title,description:e.description,history:e.history,priorText:e.priorText,email:e.email,doSpeedy:e.doSpeedy,app:e.app,history_format:e.history_format,metadata:e.metadata,temperature:e.temperature,gens:e.generations,tokens:e.length,reason:e.reason,similarSnippets:i,typeaheadLength:e.typeaheadLength,typeaheadCreativity:e.typeaheadCreativity}).then((r=>{var i;n=null==r?void 0:r.typeaheadMetadata,(null==n?void 0:n.history)&&(n.history=[...n.history,{time:(new Date).getTime(),function:"background_returning_callTypeahead",timeTaken:(new Date).getTime()-n.history.slice(-1)[0].time}]),(null===(i=null==r?void 0:r.experiments)||void 0===i?void 0:i.subscriptionTier)&&(li=r.experiments.subscriptionTier),t.postMessage(Object.assign(Object.assign({},r),{typeaheadMetadata:n,options:null==r?void 0:r.choices,key:null==e?void 0:e.key,function:"doTypeahead",status:"complete",experiments:null==r?void 0:r.experiments,flagged:(null==r?void 0:r.ContentFlag)||"Pre-Filter"===(null==r?void 0:r.error),config:null==r?void 0:r.config}))}))}))}({port:t,message:e})})),"getIndexDbCount"===t.name&&t.onMessage.addListener((function(e){return ai(this,void 0,void 0,(function*(){t.postMessage({status:"getting document count"});const n=yield(r=e.platform,Ir(void 0,void 0,void 0,(function*(){if(Ar.documents){let t="";return t="reset"===r?"":r,yield Ar.documents.filter((e=>!e.deleted_at&&e.site&&e.site.includes(t))).count()}})));var r;t.postMessage(n)}))})),"checkBetaAccess"===t.name&&t.onMessage.addListener((function(e){return ai(this,void 0,void 0,(function*(){t.postMessage({status:"checking beta access"});const n=yield(e.email,Xr(void 0,void 0,void 0,(function*(){const t=yield zr();return fetch(Qr+"/checkBetaAccess",{method:"POST",headers:{Authorization:`Bearer ${t}`}}).then((t=>t.json())).then((t=>t))})));t.postMessage(n)}))})),"grantBetaAccess"===t.name&&t.onMessage.addListener((function(e){return ai(this,void 0,void 0,(function*(){t.postMessage({status:"granting beta access"});const n=yield(e.email,Xr(void 0,void 0,void 0,(function*(){const t=yield zr();return fetch(Qr+"/grantBetaAccess",{method:"POST",headers:{Authorization:`Bearer ${t}`}}).then((t=>t.json())).then((t=>t))})));t.postMessage(n)}))})),"listIndexDbDocuments"===t.name&&t.onMessage.addListener((function({pageNo:e,pageLimit:n,filterParams:r}){return ai(this,void 0,void 0,(function*(){t.postMessage({status:"getting documents"});const i=yield(({pageNo:t,pageLimit:e,filterParams:n})=>Ir(void 0,void 0,void 0,(function*(){let r="";return r="reset"===n.platform?"":n.platform,Ar.documents?yield Ar.documents.filter((t=>n.platform.length>0?!t.deleted_at&&t.site&&t.site.includes(r):!t.deleted_at)).offset(t*e).limit(e).toArray():[]})))({pageNo:e,pageLimit:n,filterParams:r});t.postMessage(i)}))})),"deleteIndexDbDocument"===t.name&&t.onMessage.addListener((function(e){return ai(this,void 0,void 0,(function*(){t.postMessage({status:"getting documents"});const n=yield Nr(Object.assign({},e));t.postMessage(n)}))})),"saveMeasurements"===t.name&&t.onMessage.addListener((function(e){var n;t.postMessage({status:"saving measurements"}),n=e,ri(void 0,void 0,void 0,(function*(){const t=oi+"/saveTypeAheadMeasurements";let e=new FormData;const r=yield zr();return(null==n?void 0:n.messageTime)&&e.append("messageTime",n.messageTime),(null==n?void 0:n.keyDownCount)&&e.append("keyDownCount",n.keyDownCount),(null==n?void 0:n.appName)&&e.append("platform",n.appName),(null==n?void 0:n.acceptedCount)&&e.append("acceptedCount",n.acceptedCount),(null==n?void 0:n.notAcceptedCount)&&e.append("notAcceptedCount",n.notAcceptedCount),yield fetch(t,{method:"POST",body:e,headers:{Authorization:`Bearer ${r}`}}).then((t=>{})).catch((t=>(A(t),{})))}))})),"logAcceptedTypeahead"===t.name&&t.onMessage.addListener((function(e){return ai(this,void 0,void 0,(function*(){t.postMessage({status:"getting typeaheds"}),yield(({type:t,metadata:e,app:n})=>ri(void 0,void 0,void 0,(function*(){let r=new FormData;const i=yield zr();r.append("type",t),r.append("metadata",JSON.stringify(e)),r.append("app",n);let o={method:"POST",body:r,redirect:"follow",headers:{Authorization:`Bearer ${i}`}};return yield fetch(oi+"/logAcceptedTypeahead",o).then((t=>t.json())).catch((t=>(A(t),["Error saving"])))})))({type:e.type,metadata:e.metadata,app:e.app})}))})),"logShownTypeahead"===t.name&&t.onMessage.addListener((function(e){return ai(this,void 0,void 0,(function*(){t.postMessage({status:"getting typeaheds"}),yield(({type:t,app:e,metadata:n})=>ri(void 0,void 0,void 0,(function*(){let r=new FormData;const i=yield zr();r.append("type",t),r.append("app",e),r.append("metadata",JSON.stringify(n));let o={method:"POST",body:r,redirect:"follow",headers:{Authorization:`Bearer ${i}`}};return yield fetch(oi+"/logShownTypeahead",o).then((t=>t.json())).catch((t=>(A(t),["Error saving"])))})))({type:e.type,app:e.app,metadata:e.metadata})}))})),"triggerEvent"===t.name&&t.onMessage.addListener((function(e){return ai(this,void 0,void 0,(function*(){if(t.postMessage({status:"triggering event"}),li){let t=Object.assign(Object.assign({},null==e?void 0:e.metadata),{subscriptionStatus:li});e=Object.assign(Object.assign({},e),{metadata:t})}(null==e?void 0:e.source)?ni(e):chrome.tabs.query({active:!0,currentWindow:!0},(function(t){var n;return ai(this,void 0,void 0,(function*(){let r=t[0],i=(null===(n=null==r?void 0:r.url)||void 0===n?void 0:n.split("/")[2])||"";e=Object.assign(Object.assign({},e),{source:i}),ni(e)}))}))}))})),"checkInvitesRemaining"===t.name&&t.onMessage.addListener((function(){return ai(this,void 0,void 0,(function*(){t.postMessage({status:"checking invites remaining"});const e=yield Xr(void 0,void 0,void 0,(function*(){const t=yield zr();return fetch(Qr+"/checkInvitesRemaining",{method:"POST",headers:{Authorization:`Bearer ${t}`}}).then((t=>t.json())).catch((t=>(A(t),t)))}));t.postMessage({invitesRemaining:e,status:"complete"})}))})),"generateInviteCode"===t.name&&t.onMessage.addListener((function(){return ai(this,void 0,void 0,(function*(){t.postMessage({status:"generating invite code"});const e=yield Xr(void 0,void 0,void 0,(function*(){const t=yield zr();return j("hyperwriteAPIs::generateInviteCode"),fetch(Qr+"/generateInviteCode",{method:"POST",headers:{Authorization:`Bearer ${t}`}}).then((t=>t.json())).catch((t=>(A(t),t)))}));t.postMessage({inviteCode:e,status:"complete"})}))})),"genSuccessFailure"===t.name&&t.onMessage.addListener((function(e){return ai(this,void 0,void 0,(function*(){t.postMessage({status:"genSuccessFailure"});const n=yield(({site:t,successFailure:e,time:n})=>Xr(void 0,void 0,void 0,(function*(){let r=new FormData;const i=yield zr();return r.append("site",t),r.append("successFailure",e),r.append("time",n),fetch(Qr+"/genSuccessFailure",{method:"POST",body:r,headers:{Authorization:`Bearer ${i}`}}).then((t=>t.json())).catch((t=>(A(t),t)))})))({site:e.site,successFailure:e.successFailure,time:e.time});t.postMessage({successFailure:n,status:"complete"})}))})),"logSlowInstance"===t.name&&t.onMessage.addListener((function(e){return ai(this,void 0,void 0,(function*(){t.postMessage({status:"logSlowInstance"});const n=yield(({site:t})=>Xr(void 0,void 0,void 0,(function*(){let e=new FormData;const n=yield zr();return j("hyperwriteAPIs::logSlowInstance"),e.append("site",t),fetch(Qr+"/logSlowInstance",{method:"POST",body:e,headers:{Authorization:`Bearer ${n}`}}).then((t=>t.json())).catch((t=>(A(t),t)))})))({site:e.site});t.postMessage({slowInstance:n,status:"complete"})}))})),"loadTypeaheadAccess"===t.name&&t.onMessage.addListener((function(){return ai(this,void 0,void 0,(function*(){const e=yield ri(void 0,void 0,void 0,(function*(){const t=yield zr(),e=oi+"/loadTypeaheadAccess";return yield fetch(e,{method:"POST",mode:"cors",headers:{Authorization:`Bearer ${t}`}}).then((t=>t.json())).catch((t=>{}))}));t.postMessage({results:e})}))})),"saveTypeaheadAccess"===t.name&&t.onMessage.addListener((function(e){return ai(this,void 0,void 0,(function*(){const n=yield(({applicationAccess:t})=>ri(void 0,void 0,void 0,(function*(){const e=yield zr();let n=new FormData;return n.append("applicationAccess",JSON.stringify(t)),fetch(oi+"/userRequestUpdateTypeaheadAccess",{method:"POST",mode:"cors",body:n,redirect:"manual",headers:{Authorization:`Bearer ${e}`}}).then((t=>t.json())).catch((t=>{}))})))(e);t.postMessage({results:n})}))})),"submitSurvey"===t.name&&t.onMessage.addListener((function(){return ai(this,void 0,void 0,(function*(){t.postMessage({})}))})),"checkSurveyComplete"===t.name&&t.onMessage.addListener((function(e){return ai(this,void 0,void 0,(function*(){const n=yield(r=e,ri(void 0,void 0,void 0,(function*(){const t=yield zr(),e=oi+"/checkSurveyComplete";let n=new FormData;return n.append("surveyid",r.surveyId),yield fetch(e,{method:"POST",body:n,headers:{Authorization:`Bearer ${t}`}}).then((t=>t.json())).catch((t=>(A(t),{})))})));var r;t.postMessage(n)}))})),"registerCompletedTypeahead"===t.name&&t.onMessage.addListener((function(e){return ai(this,void 0,void 0,(function*(){const n=yield(r=e,ri(void 0,void 0,void 0,(function*(){const t=yield zr(),e=oi+"/registerCompletedTypeahead";let n=new FormData;return n.append("id",r.id),n.append("metadata",JSON.stringify(r.metadata)),yield fetch(e,{method:"POST",body:n,headers:{Authorization:`Bearer ${t}`}}).then((t=>t.json())).catch((t=>(A(t),{})))})));var r;t.postMessage(n)}))})),"callChatbot"===t.name&&t.onMessage.addListener((function(e){return ai(this,void 0,void 0,(function*(){const n=yield zr();e=Object.assign(Object.assign({},e),{accessToken:n});const r=yield(({payload:t})=>Xr(void 0,void 0,void 0,(function*(){const e=Qr+"/api/v1/chatbot",n=yield zr();let r=new FormData;return r.append("payload",JSON.stringify(t)),fetch(e,{method:"POST",body:r,headers:{Authorization:`Bearer ${n}`}}).then((t=>t.json())).then((t=>({payload:t,status:"success"}))).catch((t=>({status:"error",error:t})))})))(e),i=Object.assign(Object.assign({},r),{status:"complete"});t.postMessage(i)}))}))}function di(t){let e=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(e).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(n)}function vi(t,e,n){if("content"===t.from&&"showPageAction"===t.subject&&chrome.pageAction.show(e.tab.id),"submitFeedback"===t.apiRequest&&((({feedback:t,type:e})=>{Xr(void 0,void 0,void 0,(function*(){const n=Qr+"/submitFeedback",r=chrome.runtime.getManifest().version,i={app:"extension",type:e,version:r},o=yield zr();let s=new FormData;return"opinion"===e?s.append("feedback","Extension feedback - "+t):s.append("feedback","Extension bug - "+t),s.append("metadata",JSON.stringify(i)),s.append("requestsResponse","true"),yield fetch(n,{method:"POST",body:s,headers:{Authorization:`Bearer ${o}`}}).then((t=>{t.json()})).catch((t=>{A(t)}))}))})({feedback:t.text,type:t.type}),n("Feedback API request received")),"voteOnAction"===t.apiRequest&&((({session_id:t,action_id:e,vote:n,vote_feedback:r})=>{Xr(void 0,void 0,void 0,(function*(){const i=Qr+"/save_upvoted_action",o=yield zr();let s=new FormData;return s.append("session_id",t),s.append("action_id",e),s.append("vote",n),null!==r&&s.append("vote_feedback",r),yield fetch(i,{method:"POST",body:s,headers:{Authorization:`Bearer ${o}`}}).then((t=>{t.json()})).catch((t=>{A(t)}))}))})({session_id:t.session_id,action_id:t.action_id,vote:t.vote,vote_feedback:t.vote_feedback}),n("Vote API request received")),"voteOnWorkflow"===t.apiRequest&&((({sessionId:t,vote:e,feedback:n,objective:r,startingUrl:i})=>{Xr(void 0,void 0,void 0,(function*(){const o=Qr+"/save_voted_chain",s=yield zr();let u=new FormData;return u.append("sessionId",t),u.append("vote",e),u.append("feedback",n),u.append("objective",r),u.append("startingUrl",i),yield fetch(o,{method:"POST",body:u,headers:{Authorization:`Bearer ${s}`}}).then((t=>{t.json()})).catch((t=>{A(t)}))}))})({sessionId:t.sessionId,vote:t.vote,feedback:t.feedback,objective:t.objective,startingUrl:t.startingUrl}),n("Vote on Workflow API request received")),"saveDocumentSettings"===t.apiRequest){try{const e=null==t?void 0:t.url.substr(35,44);(({source:t,source_identifier:e,settings:n})=>{Xr(void 0,void 0,void 0,(function*(){const r=Qr+"/saveExternalSettings",i=yield zr();P({category:"hyperwriteAPI",message:"hyperwriteAPI::saveSettings",level:"info"});let o=new FormData;return o.append("source",t),o.append("source_identifier",e),o.append("settings",JSON.stringify(n)),yield fetch(r,{method:"POST",body:o,headers:{Authorization:`Bearer ${i}`}}).then((t=>t.json())).catch((t=>{A(t)}))}))})({source:t.source,source_identifier:e,settings:t.settings})}catch(t){}n("message received")}if("saveUserSettings"===t.apiRequest){try{(({settings:t})=>{Xr(void 0,void 0,void 0,(function*(){const e=yield zr(),n=Qr+"/saveUserExternalSettings";let r=new FormData;return r.append("settings",JSON.stringify(t)),yield fetch(n,{method:"POST",body:r,headers:{Authorization:`Bearer ${e}`}}).then((t=>t.json())).catch((t=>{A(t)}))}))})({settings:t.settings})}catch(t){}n("message received")}if("saveTypeAheadContentFeedback"===t.request){try{(({feedback:t,metadata:e,user_comment:n})=>{ri(void 0,void 0,void 0,(function*(){const r=yield zr(),i=oi+"/submitSuggestionFeedback";let o=new FormData;return o.append("content_type","typeahead"),o.append("reason",t),e&&o.append("metadata",JSON.stringify(e)),o.append("user_comment",null!=n?n:""),yield fetch(i,{method:"POST",body:o,headers:{Authorization:`Bearer ${r}`}}).then((t=>{})).catch((t=>(A(t),{})))}))})({feedback:t.feedback,metadata:t.metadata,user_comment:t.user_comment})}catch(t){}n("message received")}}var yi=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};function pi(t){return yi(this,void 0,void 0,(function*(){let e=chrome.runtime.getManifest();"install"===t.reason&&(chrome.runtime.setUninstallURL(`https://app.hyperwriteai.com/uninstall?user=not-authed-yet&version=${e.version}`),chrome.tabs.create({url:"https://www.hyperwriteai.com/onboarding/1"})),chrome.storage.local.get(["activeSites","universalOn"],(t=>{var e;void 0===(null==t?void 0:t.universalOn)&&chrome.storage.local.set({universalOn:!0}),chrome.storage.local.set({badSites:Iu});let n={};for(let r=0;r<Iu.length;r++){const i=Iu[r];void 0===(null===(e=null==t?void 0:t.activeSites)||void 0===e?void 0:e[i])&&(n[i]={personalAssistant:!1})}chrome.storage.local.set({activeSites:Object.assign(Object.assign({},t.activeSites),n)})}))}))}var mi=function(t,e){return mi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},mi(t,e)};function wi(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}mi(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function bi(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))}function gi(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&u[0]?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,r=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){s=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){s.label=u[1];break}if(6===u[0]&&s.label<i[1]){s.label=i[1],i=u;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(u);break}i[2]&&s.ops.pop(),s.trys.pop();continue}u=e.call(t,s)}catch(t){u=[6,t],r=0}finally{n=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}Object.create;function _i(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ki(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function Ei(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function Si(t){return this instanceof Si?(this.v=t,this):new Si(t)}function Oi(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(t){i[t]&&(r[t]=function(e){return new Promise((function(n,r){o.push([t,e,n,r])>1||u(t,e)}))})}function u(t,e){try{!function(t){t.value instanceof Si?Promise.resolve(t.value.v).then(c,a):f(o[0][2],t)}(i[t](e))}catch(t){f(o[0][3],t)}}function c(t){u("next",t)}function a(t){u("throw",t)}function f(t,e){t(e),o.shift(),o.length&&u(o[0][0],o[0][1])}}function Ti(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=_i(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,i){(function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)})(r,i,(e=t[n](e)).done,e.value)}))}}}Object.create;function Ii(t){return"function"==typeof t}var Ai,ji,Pi=(Ai=function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}},(ji=Ai((function(t){Error.call(t),t.stack=(new Error).stack}))).prototype=Object.create(Error.prototype),ji.prototype.constructor=ji,ji);function Ci(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var xi=function(){function t(t){this.initialTeardown=t,this.closed=!1,this.ge=null,this._e=null}var e;return t.prototype.unsubscribe=function(){var t,e,n,r,i;if(!this.closed){this.closed=!0;var o=this.ge;if(o)if(this.ge=null,Array.isArray(o))try{for(var s=_i(o),u=s.next();!u.done;u=s.next()){u.value.remove(this)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}else o.remove(this);var c=this.initialTeardown;if(Ii(c))try{c()}catch(t){i=t instanceof Pi?t.errors:[t]}var a=this._e;if(a){this._e=null;try{for(var f=_i(a),l=f.next();!l.done;l=f.next()){var h=l.value;try{Di(h)}catch(t){i=null!=i?i:[],t instanceof Pi?i=Ei(Ei([],ki(i)),ki(t.errors)):i.push(t)}}}catch(t){n={error:t}}finally{try{l&&!l.done&&(r=f.return)&&r.call(f)}finally{if(n)throw n.error}}}if(i)throw new Pi(i)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)Di(e);else{if(e instanceof t){if(e.closed||e.ke(this))return;e.Ee(this)}(this._e=null!==(n=this._e)&&void 0!==n?n:[]).push(e)}},t.prototype.ke=function(t){var e=this.ge;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype.Ee=function(t){var e=this.ge;this.ge=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype.Se=function(t){var e=this.ge;e===t?this.ge=null:Array.isArray(e)&&Ci(e,t)},t.prototype.remove=function(e){var n=this._e;n&&Ci(n,e),e instanceof t&&e.Se(this)},t.EMPTY=((e=new t).closed=!0,e),t}();xi.EMPTY;function Ri(t){return t instanceof xi||t&&"closed"in t&&Ii(t.remove)&&Ii(t.add)&&Ii(t.unsubscribe)}function Di(t){Ii(t)?t():t.unsubscribe()}var Ni={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Bi={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=Bi.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,Ei([t,e],ki(n))):setTimeout.apply(void 0,Ei([t,e],ki(n)))},clearTimeout:function(t){var e=Bi.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function Gi(t){Bi.setTimeout((function(){var e=Ni.onUnhandledError;if(!e)throw t;e(t)}))}function Ui(){}var Fi=Mi("C",void 0,void 0);function Mi(t,e,n){return{kind:t,value:e,error:n}}var Li=null;var qi=function(t){function e(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,Ri(e)&&e.add(n)):n.destination=Vi,n}return wi(e,t),e.create=function(t,e,n){return new zi(t,e,n)},e.prototype.next=function(t){this.isStopped?Ji(function(t){return Mi("N",t,void 0)}(t),this):this.Oe(t)},e.prototype.error=function(t){this.isStopped?Ji(Mi("E",void 0,t),this):(this.isStopped=!0,this.Te(t))},e.prototype.complete=function(){this.isStopped?Ji(Fi,this):(this.isStopped=!0,this.Ie())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype.Oe=function(t){this.destination.next(t)},e.prototype.Te=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype.Ie=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(xi),Hi=Function.prototype.bind;function Ki(t,e){return Hi.call(t,e)}var $i=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){Wi(t)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){Wi(t)}else Wi(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){Wi(t)}},t}(),zi=function(t){function e(e,n,r){var i,o,s=t.call(this)||this;Ii(e)||!e?i={next:null!=e?e:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&Ni.useDeprecatedNextContext?((o=Object.create(e)).unsubscribe=function(){return s.unsubscribe()},i={next:e.next&&Ki(e.next,o),error:e.error&&Ki(e.error,o),complete:e.complete&&Ki(e.complete,o)}):i=e;return s.destination=new $i(i),s}return wi(e,t),e}(qi);function Wi(t){var e;Ni.useDeprecatedSynchronousErrorHandling?(e=t,Ni.useDeprecatedSynchronousErrorHandling&&Li&&(Li.errorThrown=!0,Li.error=e)):Gi(t)}function Ji(t,e){var n=Ni.onStoppedNotification;n&&Bi.setTimeout((function(){return n(t,e)}))}var Vi={closed:!0,next:Ui,error:function(t){throw t},complete:Ui},Yi="function"==typeof Symbol&&Symbol.observable||"@@observable";function Xi(t){return t}function Qi(t){return 0===t.length?Xi:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var Zi=function(){function t(t){t&&(this.be=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r,i=this,o=(r=t)&&r instanceof qi||function(t){return t&&Ii(t.next)&&Ii(t.error)&&Ii(t.complete)}(r)&&Ri(r)?t:new zi(t,e,n);return function(t){if(Ni.useDeprecatedSynchronousErrorHandling){var e=!Li;if(e&&(Li={errorThrown:!1,error:null}),t(),e){var n=Li,r=n.errorThrown,i=n.error;if(Li=null,r)throw i}}else t()}((function(){var t=i,e=t.operator,n=t.source;o.add(e?e.call(o,n):n?i.be(o):i.Ae(o))})),o},t.prototype.Ae=function(t){try{return this.be(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=to(e))((function(e,r){var i=new zi({next:function(e){try{t(e)}catch(t){r(t),i.unsubscribe()}},error:r,complete:e});n.subscribe(i)}))},t.prototype.be=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[Yi]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Qi(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=to(t))((function(t,n){var r;e.subscribe((function(t){return r=t}),(function(t){return n(t)}),(function(){return t(r)}))}))},t.create=function(e){return new t(e)},t}();function to(t){var e;return null!==(e=null!=t?t:Ni.Promise)&&void 0!==e?e:Promise}function eo(t){return function(e){if(function(t){return Ii(null==t?void 0:t.lift)}(e))return e.lift((function(e){try{return t(e,this)}catch(t){this.error(t)}}));throw new TypeError("Unable to lift unknown Observable type")}}function no(t,e,n,r,i){return new ro(t,e,n,r,i)}var ro=function(t){function e(e,n,r,i,o,s){var u=t.call(this,e)||this;return u.onFinalize=o,u.shouldUnsubscribe=s,u.Oe=n?function(t){try{n(t)}catch(t){e.error(t)}}:t.prototype.Oe,u.Te=i?function(t){try{i(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype.Te,u.Ie=r?function(){try{r()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype.Ie,u}return wi(e,t),e.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;t.prototype.unsubscribe.call(this),!n&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}},e}(qi);function io(t,e){return eo((function(n,r){var i=0;n.subscribe(no(r,(function(n){r.next(t.call(e,n,i++))})))}))}var oo=Array.isArray;function so(t){return io((function(e){return function(t,e){return oo(e)?t.apply(void 0,Ei([],ki(e))):t(e)}(t,e)}))}function uo(t,e,n){return n?uo(t,e).pipe(so(n)):new Zi((function(n){var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n.next(1===t.length?t[0]:t)},i=t(r);return Ii(e)?function(){return e(r,i)}:void 0}))}var co=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function ao(t){return Ii(null==t?void 0:t.then)}function fo(t){return Ii(t[Yi])}function lo(t){return Symbol.asyncIterator&&Ii(null==t?void 0:t[Symbol.asyncIterator])}function ho(t){return new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var vo="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function yo(t){return Ii(null==t?void 0:t[vo])}function po(t){return Oi(this,arguments,(function(){var e,n,r;return gi(this,(function(i){switch(i.label){case 0:e=t.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,Si(e.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,Si(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,Si(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}}))}))}function mo(t){return Ii(null==t?void 0:t.getReader)}function wo(t){if(t instanceof Zi)return t;if(null!=t){if(fo(t))return i=t,new Zi((function(t){var e=i[Yi]();if(Ii(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(co(t))return r=t,new Zi((function(t){for(var e=0;e<r.length&&!t.closed;e++)t.next(r[e]);t.complete()}));if(ao(t))return n=t,new Zi((function(t){n.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,Gi)}));if(lo(t))return bo(t);if(yo(t))return e=t,new Zi((function(t){var n,r;try{for(var i=_i(e),o=i.next();!o.done;o=i.next()){var s=o.value;if(t.next(s),t.closed)return}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}t.complete()}));if(mo(t))return bo(po(t))}var e,n,r,i;throw ho(t)}function bo(t){return new Zi((function(e){(function(t,e){var n,r,i,o;return bi(this,void 0,void 0,(function(){var s,u;return gi(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=Ti(t),c.label=1;case 1:return[4,n.next()];case 2:if((r=c.sent()).done)return[3,4];if(s=r.value,e.next(s),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return u=c.sent(),i={error:u},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}}))}))})(t,e).catch((function(t){return e.error(t)}))}))}function go(t,e,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var o=e.schedule((function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()}),r);if(t.add(o),!i)return o}function _o(t,e,n){return void 0===n&&(n=1/0),Ii(e)?_o((function(n,r){return io((function(t,i){return e(n,t,r,i)}))(wo(t(n,r)))}),n):("number"==typeof e&&(n=e),eo((function(e,r){return function(t,e,n,r,i,o,s,u){var c=[],a=0,f=0,l=!1,h=function(){!l||c.length||a||e.complete()},d=function(t){return a<r?v(t):c.push(t)},v=function(t){o&&e.next(t),a++;var u=!1;wo(n(t,f++)).subscribe(no(e,(function(t){null==i||i(t),o?d(t):e.next(t)}),(function(){u=!0}),void 0,(function(){if(u)try{a--;for(var t=function(){var t=c.shift();s?go(e,s,(function(){return v(t)})):v(t)};c.length&&a<r;)t();h()}catch(t){e.error(t)}})))};return t.subscribe(no(e,d,(function(){l=!0,h()}))),function(){null==u||u()}}(e,r,t,n)})))}function ko(){return void 0===(t=1)&&(t=1/0),_o(Xi,t);var t}function Eo(t){return t[t.length-1]}function So(t){return(e=Eo(t))&&Ii(e.schedule)?t.pop():void 0;var e}function Oo(t,e){return void 0===e&&(e=0),eo((function(n,r){n.subscribe(no(r,(function(n){return go(r,t,(function(){return r.next(n)}),e)}),(function(){return go(r,t,(function(){return r.complete()}),e)}),(function(n){return go(r,t,(function(){return r.error(n)}),e)})))}))}function To(t,e){return void 0===e&&(e=0),eo((function(n,r){r.add(t.schedule((function(){return n.subscribe(r)}),e))}))}function Io(t,e){if(!t)throw new Error("Iterable cannot be null");return new Zi((function(n){go(n,e,(function(){var r=t[Symbol.asyncIterator]();go(n,e,(function(){r.next().then((function(t){t.done?n.complete():n.next(t.value)}))}),0,!0)}))}))}function Ao(t,e){if(null!=t){if(fo(t))return function(t,e){return wo(t).pipe(To(e),Oo(e))}(t,e);if(co(t))return function(t,e){return new Zi((function(n){var r=0;return e.schedule((function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())}))}))}(t,e);if(ao(t))return function(t,e){return wo(t).pipe(To(e),Oo(e))}(t,e);if(lo(t))return Io(t,e);if(yo(t))return function(t,e){return new Zi((function(n){var r;return go(n,e,(function(){r=t[vo](),go(n,e,(function(){var t,e,i;try{e=(t=r.next()).value,i=t.done}catch(t){return void n.error(t)}i?n.complete():n.next(e)}),0,!0)})),function(){return Ii(null==r?void 0:r.return)&&r.return()}}))}(t,e);if(mo(t))return function(t,e){return Io(po(t),e)}(t,e)}throw ho(t)}function jo(t,e){return e?Ao(t,e):wo(t)}function Po(t,e){return eo((function(n,r){var i=0;n.subscribe(no(r,(function(n){return t.call(e,n,i++)&&r.next(n)})))}))}var Co=__webpack_require__(4116),xo=__webpack_require__.n(Co);function Ro(t){return null!=t}function Do(t,e){e||(e="local");const n=(t=>{switch(t){case"local":return xo().storage.local;case"sync":return xo().storage.sync;case"managed":return xo().storage.managed;default:throw new TypeError('area must be "local" | "sync" | "managed"')}})(e),r=`extend-chrome/storage__${t}`,i=`${r}_keys`,o=t=>`${r}--${t}`,s=t=>t.replace(`${r}--`,""),u=t=>e=>Object.keys(e).reduce(((n,r)=>Object.assign(Object.assign({},n),{[t(r)]:e[r]})),{}),c=t=>t.map(o),a=u(o),f=u(s),l=async()=>(await n.get(i))[i]||[];let h=null;async function d(t){if(h)return h;if(null==t){const t=await l();if(t.length){const e=c(t),r=await n.get(e);return f(r)}return{}}if("string"==typeof t){const e=o(t),r=await n.get(e);return f(r)}if(Array.isArray(t)){const e=c(t),r=await n.get(e);return f(r)}{const e=a(t),r=await n.get(e);return f(r)}}function v(t){if(null==t)return d();if("string"==typeof t||"object"==typeof t)return d(t);if("function"==typeof t)return d().then(t);throw new TypeError("Unexpected argument type: "+typeof t)}const y=t=>t;let p=y;function m(t){return new Promise(((e,r)=>{let o;o="function"==typeof t?e=>{const n=t(e),i=(t=>{if(Array.isArray(t))return"Unexpected setter result value: Array";switch(typeof t){case"object":case"undefined":return;default:return"Unexpected setter return value: "+typeof t}})(n);return i?(r(new TypeError(i)),e):Object.assign(Object.assign({},e),n)}:e=>Object.assign(Object.assign({},e),t);const s=p;p=t=>Object.assign(Object.assign({},t),o(s(t))),null===h&&(h=d().then((t=>{try{const e=p(t),r=a(e);return r[i]=Object.keys(e),n.set(r).then((()=>e))}finally{p=y,h=null}}))),h.then(e).catch(r)}))}const w=uo((t=>{chrome.storage.onChanged.addListener(t)}),(t=>{chrome.storage.onChanged.removeListener(t)})).pipe(Po((([t,n])=>n===e&&Object.keys(t).some((t=>t.startsWith(r))))),io((([t])=>{const e=Object.keys(t).filter((t=>t.startsWith(r)&&t!==i));return e.length?e.reduce(((e,n)=>Object.assign(Object.assign({},e),{[s(n)]:t[n]})),{}):void 0})),Po(Ro));return{set:m,get:v,remove:t=>{const e=[].concat(t);e.forEach((t=>{if("string"!=typeof t)throw new TypeError("Unexpected argument type: "+typeof t)}));return n.remove(c(e)).then(l).then((t=>(t=>n.set({[i]:t}))(t.filter((t=>!e.includes(t))))))},async clear(){const t=await l(),e=[i,...c(t)];return n.remove(e)},async update(t){const e=await v();return m(await t(e))},getKeys:async()=>l(),get changeStream(){return w},get valueStream(){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ko()(jo(t,So(t)))}(jo(v()),w.pipe(_o((()=>v()))))}}}Do("local","local"),Do("sync","sync"),Do("managed","managed");var No=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var Bo=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};function Go(t,e){return Bo(this,void 0,void 0,(function*(){var n;return n=t.sessionId,No(void 0,void 0,void 0,(function*(){const t=Qr+"/api/hide_chat_session",e=yield zr(),r=new FormData;r.append("sessionId",n);const i=yield fetch(t,{method:"POST",headers:{Authorization:`Bearer ${e}`},body:r});return yield i.json()})),Object.assign(Object.assign({},e),{chat:Object.assign(Object.assign({},e.chat),{history:Object.assign({},(e.chat.history||[]).filter((e=>e.sessionId!==t.sessionId)))})})}))}function Uo(t,e,n){const r=t.chat.active.findIndex((t=>t.subscribedTabIds.includes(e)));return-1===r?Object.assign(Object.assign({},t),{chat:Object.assign(Object.assign({},t.chat),{active:t.chat.active.concat(n({sessionId:null,subscribedTabIds:[e],messages:[],title:null}))})}):Object.assign(Object.assign({},t),{chat:Object.assign(Object.assign({},t.chat),{active:[...t.chat.active.slice(0,r),n(t.chat.active[r]),...t.chat.active.slice(r+1)]})})}var Fo=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};const Mo={};function Lo(t,e){return Fo(this,void 0,void 0,(function*(){if(t.sessionId&&!e.chat.active.find((e=>e.sessionId===t.sessionId)))throw new Error("no active chat matches session id");var n,r;return(n=t.userMessage,r=t.sessionId,No(void 0,void 0,void 0,(function*(){const t=Qr+"/api/browser_chatbot_streaming",e=yield zr(),i=new FormData;i.append("payload",JSON.stringify({message:n,role:"user",sessionId:r})),i.append("hasExtension","true"),i.append("fromExtension","true");const o=yield fetch(t,{method:"POST",body:i,headers:{Authorization:`Bearer ${e}`}});if(o.ok){if(!o.body)throw new Error("bad response is not readable");return o.body.getReader()}{const t=yield o.json();throw new Error(t.error)}}))).then((e=>{const n=String(performance.now());Mo[n]=e,vu.postMessage({type:"BG_CHAT_GENERATE_MESSAGE_CONTINUE",tabId:t.tabId,initialWindowId:t.initialWindowId,txid:n,sessionId:t.sessionId,assistantLastHistoryId:t.assistantLastHistoryId}),setTimeout((()=>{Mo[n]&&vu.postMessage({type:"BG_CHAT_GENERATE_MESSAGE_ERROR",tabId:t.tabId,message:"Chat stream timed out after 60s",txid:n,sessionId:t.sessionId,assistantLastHistoryId:t.assistantLastHistoryId})}),6e4)})).catch((e=>{vu.postMessage({type:"BG_CHAT_GENERATE_MESSAGE_ERROR",tabId:t.tabId,message:e.message,txid:null,sessionId:t.sessionId,assistantLastHistoryId:t.assistantLastHistoryId})})),Uo(e,t.tabId,(e=>Object.assign(Object.assign({},e),{subscribedTabIds:[...new Set(e.subscribedTabIds).add(t.tabId)],messages:e.messages.concat({assistantLastHistoryId:null,role:"user",text:t.userMessage})})))}))}var qo=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};const Ho=new TextDecoder("utf-8");function Ko(t,e){var n,r;return qo(this,void 0,void 0,(function*(){if(t.sessionId&&!e.chat.active.find((e=>e.sessionId===t.sessionId)))throw Mo[t.txid].cancel(),delete Mo[t.txid],new Error("no chat thread found with the provided sessionId");let i;try{i=yield Mo[t.txid].read()}catch(n){return Mo[t.txid].cancel(),delete Mo[t.txid],vu.postMessage({type:"BG_CHAT_GENERATE_MESSAGE_ERROR",tabId:t.tabId,message:"Error streaming network response",txid:t.txid,sessionId:t.sessionId,assistantLastHistoryId:t.assistantLastHistoryId}),e}if(i.done){if(delete Mo[t.txid],!t.assistantLastHistoryId)throw new Error("response never got assistantLastHistoryId");if(!t.sessionId)throw new Error("response never got sessionId");const n=function(t,e){const n=t.chat.active.find((t=>t.subscribedTabIds.includes(e)));if(!n)throw new Error(`cant find active chat with subscribedTabId ${e}`);return n}(e,t.tabId);if(![2,4,10].includes(n.messages.length))return e;const{title:r}=yield(t=>No(void 0,void 0,void 0,(function*(){const e=Qr+"/api/summarize_chat_for_title",n=yield zr(),r=new FormData;r.append("sessionId",t);const i=yield fetch(e,{method:"POST",body:r,headers:{Authorization:`Bearer ${n}`}}),o=yield i.json();if("success"===o.status)return o;throw new Error("error summarizing chat for title")})))(t.sessionId);return vu.postMessage({type:"CS_CHAT_GENERATE_MESSAGE_CONTINUE",__tabId:t.tabId,txid:t.txid,sessionId:t.sessionId,newText:null,assistantLastHistoryId:t.assistantLastHistoryId,title:r}),Uo(e,t.tabId,(t=>Object.assign(Object.assign({},t),{title:r})))}const o=Ho.decode(i.value).split("\n").filter((t=>t.trim())).map((t=>JSON.parse(t))),s=t.sessionId||(null===(n=o.find((t=>t.sessionId)))||void 0===n?void 0:n.sessionId);if(!s)throw new Error("no sessionId provided nor derived");const u=t.assistantLastHistoryId||(null===(r=o.find((t=>t.assistantLastHistoryId)))||void 0===r?void 0:r.assistantLastHistoryId)||null,c=o.find((t=>{var e;return null===(e=t.functionArgs)||void 0===e?void 0:e.objective}));if(c){Mo[t.txid].cancel(),delete Mo[t.txid];const n=c.functionArgs.objective,r=[{message:n,sender:"user",vote:null,feedback:null,feedbackDismissed:null}];return vu.postMessage({type:"BG_CREATE_WORKFLOW",tabId:t.tabId,appTabId:null,chatLog:r,initialWindowId:t.initialWindowId,model:"default",objective:n}),vu.postMessage({type:"CS_CHAT_GENERATE_MESSAGE_CONTINUE",__tabId:t.tabId,txid:t.txid,sessionId:s,newText:"Personal Assistant is using the browser",assistantLastHistoryId:u,title:null}),Uo(e,t.tabId,(t=>Object.assign(Object.assign({},t),{messages:t.messages.concat({role:"assistant",text:"Personal Assistant is using the browser",assistantLastHistoryId:u})})))}const a=o.map((t=>t.message)).join("");return vu.postMessage({type:"BG_CHAT_GENERATE_MESSAGE_CONTINUE",tabId:t.tabId,initialWindowId:t.initialWindowId,txid:t.txid,sessionId:s,assistantLastHistoryId:u}),o.forEach((e=>{vu.postMessage({type:"CS_CHAT_GENERATE_MESSAGE_CONTINUE",__tabId:t.tabId,txid:t.txid,sessionId:s,newText:e.message,assistantLastHistoryId:u,title:null})})),Uo(e,t.tabId,(t=>{const e=function(t,e){const n=e.messages.at(-1);return n?null===t?"assistant"===n.role&&null===n.assistantLastHistoryId?e.messages.length-1:-1:null===n.assistantLastHistoryId?e.messages.length-1:e.messages.findLastIndex((e=>"assistant"===e.role&&e.assistantLastHistoryId===t)):-1}(u,t);if(-1===e)return Object.assign(Object.assign({},t),{sessionId:s,messages:t.messages.concat({assistantLastHistoryId:u,role:"assistant",text:a})});const n=t.messages[e];return Object.assign(Object.assign({},t),{sessionId:s,messages:[...t.messages.slice(0,e),{assistantLastHistoryId:u,role:"assistant",text:n.text+a},...t.messages.slice(e+1)]})}))}))}var $o=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var zo=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};function Wo(t,e){return zo(this,void 0,void 0,(function*(){return No(void 0,void 0,void 0,(function*(){const t=Qr+"/api/get_chat_sessions",e=yield zr(),n=yield fetch(t,{method:"GET",headers:{Authorization:`Bearer ${e}`}}),r=yield n.json();if("success"===r.status)return r.results;throw new Error("error fetching chat sessions")})).then((e=>{vu.postMessage({type:"BG_CHAT_SET_SESSION_HISTORY_SUCCESS",tabId:t.tabId,history:e})})),Object.assign(Object.assign({},e),{chat:Object.assign(Object.assign({},e.chat),{history:[]})})}))}var Jo=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var Vo=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};function Yo(t,e){return Vo(this,void 0,void 0,(function*(){var n;return(n=t.sessionId,No(void 0,void 0,void 0,(function*(){const t=Qr+"/api/get_chat_history",e=yield zr(),r=new FormData;r.append("sessionId",n);const i=yield fetch(t,{method:"POST",headers:{Authorization:`Bearer ${e}`},body:r}),o=yield i.json();if("success"===o.status)return o.results;throw new Error("error fetching chat history")}))).then((e=>{const n=e.map((t=>{switch(t.role){case"user":return{assistantLastHistoryId:null,role:t.role,text:t.text};case"assistant":return{assistantLastHistoryId:t.assistantLastHistoryId,role:t.role,text:t.text};default:throw new Error("unknown message role: "+JSON.stringify(t))}}));vu.postMessage({type:"BG_CHAT_GET_ACTIVE_CHAT_SUCCESS",tabId:t.tabId,sessionId:t.sessionId,messages:n})})),e}))}var Xo=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var Qo,Zo=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};!function(t){t.Unstable="UNSTABLE",t.StablePending="STABLE_PENDING",t.Stable="STABLE"}(Qo||(Qo={}));const ts={appTabId:null,initialWindowId:null,tabIds:[],studioErrorMessage:null,trainingRequest:null,trainingResponse:null,trainingScreenshotPhase:Qo.Unstable,awaitingUserResponse:null,chatLog:[],isOpen:null,isPaused:null,isRunning:null,model:null,objective:null,runNumber:-1,sessionId:null,startingUrl:null,taskHeadline:null,tasks:[],trainingOmit:null,userMessage:null,recordingEnded:null};function es(t,e,n){return t.workflows.some((t=>t.tabIds.includes(e)))?Object.assign(Object.assign({},t),{workflows:t.workflows.map((t=>t.tabIds.includes(e)?n(t):t))}):Object.assign(Object.assign({},t),{workflows:t.workflows.concat(n(Object.assign(Object.assign({},ts),{tabIds:[e]})))})}var ns=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};const rs=[],is=()=>{ss(null),rs.length=0};let os=null;const ss=t=>{os=t};var us=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};function cs(t,e){const n=t.workflows.find((t=>t.tabIds.includes(e)));if(!n)throw new Error(`cant find workflow with tabId ${e}`);return n}var as=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};function fs(t){return as(this,void 0,void 0,(function*(){try{let e=yield chrome.tabs.get(t);if(!e.active)throw new Error("tab inactive");const n=yield chrome.tabs.captureVisibleTab(e.windowId,{format:"jpeg"});if(e=yield chrome.tabs.get(t),!e.active)throw new Error("tab inactive");return n}catch(t){return"ERROR"}}))}var ls=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};let hs=0;var ds=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};let vs,ys;const ps=()=>{clearTimeout(vs),clearTimeout(ys)};var ms=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var ws=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var bs=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};const gs="STUDIO_TRAINER",_s="LORA_TRAINER";function ks(t){return"workflows"===t.name&&Es(t.sender)}function Es(t){var e,n;return"number"==typeof(null===(e=null==t?void 0:t.tab)||void 0===e?void 0:e.id)&&"number"==typeof(null===(n=null==t?void 0:t.tab)||void 0===n?void 0:n.windowId)}var Ss=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};function Os(t,e){return Ss(this,void 0,void 0,(function*(){const n=cs(e,t.tabId),{sessionId:r}=n;if(!r)throw new Error("no sessionId");if(ps(),!n.trainingResponse)throw new Error("no training response");const i=function(t,e){if(!function(t){return t&&"string"==typeof t.sessionId&&"string"==typeof t.objective&&"string"==typeof t.model&&"string"==typeof t.url&&"string"==typeof t.browserContent&&"string"==typeof t.screenshot&&"number"==typeof t.devicePixelRatio&&Array.isArray(t.elementPositions)&&"number"==typeof t.percentOfDocumentScrolled&&"number"==typeof t.currentPageNumber&&"number"==typeof t.totalNumberOfPages&&"string"==typeof t.previousCommandStatus&&"string"==typeof t.user_message}(t)){if(t&&e.action.startsWith("GO_TO"))return{screenshot:t.screenshot||"ERROR",sessionId:gs,objective:"TODO: fill this in",model:gs,url:"",browserContent:"",devicePixelRatio:2,elementPositions:[],previousCommandStatus:"success",user_message:"",percentOfDocumentScrolled:0,currentPageNumber:0,totalNumberOfPages:0};throw new Error("no training request or request.screenshot")}return t}(n.trainingRequest,n.trainingResponse);return function(t,e,n){return ci(this,void 0,void 0,(function*(){const r=yield zr(),i=yield fetch(Qr+"/ingest_events",{method:"POST",body:JSON.stringify({session_id:t,studio_training_data:{sessionId:t,request:e,response:n}}),headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`}});return yield i.json()}))}(r,i,n.trainingResponse).then((e=>{vu.postMessage({type:"BG_STUDIO_SAVE_TRAINING_DATA_SUCCESS",tabId:t.tabId,response:e})})).catch((t=>{})),es(e,t.tabId,(t=>Object.assign(Object.assign({},t),{trainingRequest:null,trainingResponse:null})))}))}var Ts=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var Is=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var As=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var js=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};function Ps(t,e){return js(this,void 0,void 0,(function*(){const n=yield new Promise(((t,e)=>{chrome.tabs.query({active:!0,currentWindow:!0},(function(n){n[0]&&n[0].url?t(n[0].url):e("No active tab found or URL is undefined")}))})),{session_id:r,reason:i}=yield function(t,e,n){return ci(this,void 0,void 0,(function*(){const r=yield zr(),i=new FormData;i.append("workflow_name",t),i.append("workflow_description",e),i.append("starting_url",n);const o=yield fetch(Qr+"/start_recording_session",{method:"POST",body:i,headers:{Authorization:`Bearer ${r}`}});return yield o.json()}))}(t.workflowName,t.workflowDescription,n);return"rate_limit"===i?(vu.postMessage({type:"CS_TERMINATE_RECORDING",__tabId:t.tabId,message:"No credits available. Please upgrade to use."}),e):(vu.postMessage({type:"CS_STUDIO_START_RECORDING_SUCCESS",__tabId:t.tabId,sessionId:r}),es(e,t.tabId,(()=>Object.assign(Object.assign({},ts),{tabIds:[t.tabId],initialWindowId:t.initialWindowId,appTabId:t.appTabId,model:gs,sessionId:r,trainingRequest:null,trainingResponse:null,isRunning:!0,isOpen:!1}))))}))}var Cs=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var xs=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};function Rs(t,e){return xs(this,void 0,void 0,(function*(){const n=!(null!==t.appTabId)&&!C.TEST_MODE,r=yield function(t,e,n){return xs(this,void 0,void 0,(function*(){const r=yield new Promise((e=>chrome.tabs.duplicate(t,e)));if(!(i=r)||"number"!=typeof i.id)throw new Error("could not duplicate tab");var i;return n&&""!==n?(yield chrome.tabs.update(r.id,{url:n}),yield chrome.windows.create({tabId:r.id,type:"popup",focused:e})):yield chrome.windows.create({tabId:r.id,type:"popup",focused:e}),r}))}(t.tabId,n,t.workflowStartUrl),i=!!pu[r.id],o={type:"CS_CREATE_WORKFLOW",__tabId:r.id,__appTabId:t.appTabId,chatLog:t.chatLog};let s=ts.tasks;return i?vu.postMessage(o):s=[o],es(e,r.id,(()=>Object.assign(Object.assign({},ts),{tabIds:[r.id],initialWindowId:t.initialWindowId,appTabId:t.appTabId,objective:t.objective,model:t.model,chatLog:t.chatLog,tasks:s,isRunning:!0,isOpen:!0})))}))}var Ds=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var Ns=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var Bs=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};function Gs(t,e){return Bs(this,void 0,void 0,(function*(){const n=cs(e,t.tabId),{objective:r,model:i,sessionId:o,taskHeadline:s}=n,u=performance.now(),c=yield fs(t.tabId);vu.postMessage({type:"CS_SHOW_AFTER_SCREENSHOT",__tabId:t.tabId,__appTabId:n.appTabId,screenshot:c}),function({sessionId:t,objective:e,model:n,url:r,browserContent:i,screenshot:o,elementPositions:s,devicePixelRatio:u,percentOfDocumentScrolled:c,currentPageNumber:a,totalNumberOfPages:f,previousCommandStatus:l,user_message:h}){return Ns(this,void 0,void 0,(function*(){const d=(C.TEST_MODE?"http://0.0.0.0:5001":Qr)+"/get_action_from_session_id",v=yield zr(),y=chrome.runtime.getManifest();let p=new FormData;t&&p.append("session_id",t),p.append("objective",e),p.append("model",n),p.append("url",r),p.append("percent_of_document_scrolled",String(c)),p.append("current_page_number",String(a)),p.append("total_number_of_pages",String(f)),p.append("previous_command_status",l),p.append("user_message",h),p.append("version",y.version),p.append("browser_content",i),p.append("device_pixel_ratio",String(u)),p.append("element_positions",JSON.stringify(s)),p.append("screenshot",o);let m={method:"POST",body:p,headers:{Authorization:`Bearer ${v}`}};try{const t=yield fetch(d,m);return yield t.json()}catch(t){return{status:"error",message:String(t)}}}))}({sessionId:o,objective:r,model:i,url:t.url,browserContent:t.document,screenshot:c,devicePixelRatio:t.devicePixelRatio,elementPositions:t.elementPositions,previousCommandStatus:t.previousCommandStatus,user_message:t.userMessage||"",percentOfDocumentScrolled:0,currentPageNumber:0,totalNumberOfPages:0}).then((e=>{!function(t){return"error"===t.status}(e)?vu.postMessage({type:"BG_GET_NEXT_COMMAND_SUCCESS",tabId:t.tabId,cmd:e.action,lastMessage:e.lastMessage,userMessageHistoryId:e.userMessageHistoryId,sessionId:e.session_id,runNumber:u,taskHeadline:e.taskHeadline}):vu.postMessage({type:"BG_GET_NEXT_COMMAND_ERROR",tabId:t.tabId,message:e.message,runNumber:u})}));const a="string"==typeof t.userMessage?n.chatLog.concat({sender:"user",message:t.userMessage,vote:null,feedback:null,feedbackDismissed:null}):n.chatLog;return es(e,t.tabId,(t=>Object.assign(Object.assign({},t),{runNumber:u,chatLog:a,taskHeadline:s})))}))}var Us=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var Fs=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};function Ms(t,e){const n=cs(e,t.tabId);t.userMessageHistoryId===_s&&function(t,e){return Fs(this,void 0,void 0,(function*(){const n=yield zr();(new FormData).append("loraTrainingData",JSON.stringify(t));try{const r=yield fetch("https://loratrainerapi.mattshumer2.repl.co/lora_trainer",{method:"POST",body:JSON.stringify({loraTrainingData:t,loraCategory:e}),headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});return yield r.json()}catch(t){return{status:"error",message:String(t)}}}))}(rs,os).then((()=>{is()}));const r={id:t.lastMessage.action_id,message:JSON.parse(t.lastMessage.content)["your thoughts"],sender:"bot",vote:null,feedback:null,feedbackDismissed:null};vu.postMessage({type:"CS_COMPLETE_WORKFLOW",__tabId:t.tabId,__appTabId:n.appTabId,chatMessage:r,command:t.cmd,userMessageHistoryId:t.userMessageHistoryId,taskHeadline:t.taskHeadline});const i=t.tabId,o=cs(e,i);return e&&e.workflows&&(null==o?void 0:o.appTabId)&&e.workflows.forEach((t=>{t.tabIds&&t.initialWindowId&&t.tabIds.includes(i)&&t.tabIds.forEach((e=>{chrome.tabs.move(e,{index:-1,windowId:t.initialWindowId}),chrome.windows.update(t.initialWindowId,{drawAttention:!0})}))})),es(e,t.tabId,(e=>Object.assign(Object.assign({},e),{chatLog:e.chatLog.concat(r),sessionId:t.sessionId,taskHeadline:t.taskHeadline||e.taskHeadline})))}var Ls=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};function qs(t,e){return Ls(this,void 0,void 0,(function*(){const n=cs(e,t.tabId);if(n.runNumber!==t.runNumber)return e;if(n.isPaused)return es(e,t.tabId,(e=>Object.assign(Object.assign({},e),{tasks:[t]})));if(t.cmd.startsWith("ASK_USER"))return function(t,e){const n=cs(e,t.tabId),r=(o=t.cmd,o.replace('ASK_USER "',"").slice(0,-1).replace(/\\/g,"")),i={message:r,id:t.lastMessage.action_id,sender:"bot",vote:null,feedback:null,feedbackDismissed:null};var o;return vu.postMessage({type:"CS_ASK_USER",__tabId:t.tabId,__appTabId:n.appTabId,sessionId:t.sessionId,chatMessage:i,command:t.cmd,userMessageHistoryId:t.userMessageHistoryId,askUserText:r,taskHeadline:t.taskHeadline}),es(e,t.tabId,(e=>Object.assign(Object.assign({},e),{awaitingUserResponse:!0,isPaused:!0,sessionId:t.sessionId,chatLog:e.chatLog.concat(i)})))}(t,e);if("TASK_COMPLETED_SUCCESSFULLY"===t.cmd)return Ms(t,e);{const r={id:t.lastMessage.action_id,message:JSON.parse(t.lastMessage.content)["your thoughts"],sender:"bot",vote:null,feedback:null,feedbackDismissed:null};return vu.postMessage({type:"CS_GET_NEXT_COMMAND_SUCCESS",__tabId:n.tabIds.at(-1),__appTabId:n.appTabId,cmd:t.cmd,chatMessage:r,sessionId:t.sessionId,taskHeadline:t.taskHeadline}),es(e,t.tabId,(e=>Object.assign(Object.assign({},e),{chatLog:e.chatLog.concat(r),sessionId:t.sessionId,taskHeadline:t.taskHeadline||e.taskHeadline})))}}))}var Hs=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};function Ks(t,e){return Hs(this,void 0,void 0,(function*(){const n=cs(e,t.tabId),{appTabId:r,objective:i,model:o,taskHeadline:s}=n,u=performance.now(),c=yield function(t){return Hs(this,void 0,void 0,(function*(){try{let e=yield chrome.tabs.get(t);if(!e.active)throw new Error("tab inactive");const n=yield chrome.tabs.captureVisibleTab(e.windowId,{format:"jpeg"});if(e=yield chrome.tabs.get(t),!e.active)throw new Error("tab inactive");return n}catch(t){return"ERROR"}}))}(t.tabId);vu.postMessage({type:"CS_SHOW_AFTER_SCREENSHOT",__tabId:t.tabId,__appTabId:n.appTabId,screenshot:c}),vu.postMessage({type:"CS_GET_NEXT_FAKE_COMMAND",__tabId:t.tabId,__appTabId:r,runNumber:u});const a="string"==typeof t.userMessage?n.chatLog.concat({sender:"user",message:t.userMessage,vote:null,feedback:null,feedbackDismissed:null}):n.chatLog;return rs.push({request:{sessionId:_s,objective:i,model:o,url:t.url,previousCommandStatus:t.previousCommandStatus,user_message:t.userMessage||"",browserContent:t.document,elementPositions:t.elementPositions,devicePixelRatio:t.devicePixelRatio,screenshot:c,percentOfDocumentScrolled:0,currentPageNumber:0,totalNumberOfPages:0},response:null,omitTraining:null}),es(e,t.tabId,(t=>Object.assign(Object.assign({},t),{runNumber:u,chatLog:a,taskHeadline:s})))}))}var $s=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};const zs=5<<20;function Ws(t,e){return $s(this,void 0,void 0,(function*(){const n=cs(e,t.tabId),r=yield fetch(t.pdfUrl),i=function(t){const e=t.headers.get("content-length");if(null!==e){const t=parseInt(e,10);if(!isNaN(t))return t}return null}(r),o=r.body.getReader();for(;;){const{value:e,done:r}=yield o.read();if(r)break;for(let r=0;r<e.length;r+=zs)vu.postMessage({type:"CS_GET_PDF_ARRAY_BUFFER_CONTINUE",__tabId:t.tabId,__appTabId:n.appTabId,txid:t.txid,totalSize:i,chunk:e.slice(r,r+zs),then:t.then})}return vu.postMessage({type:"CS_GET_PDF_ARRAY_BUFFER_CONTINUE",__tabId:t.tabId,__appTabId:n.appTabId,txid:t.txid,totalSize:i,chunk:null,then:t.then}),e}))}var Js=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var Vs=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var Ys=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var Xs=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var Qs=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var Zs=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var tu=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};function eu(t){return tu(this,void 0,void 0,(function*(){if(null===t)return null;try{return yield chrome.windows.get(t)}catch(t){return null}}))}var nu=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var ru=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var iu=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};var ou=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};let su=null,uu=null;function cu(t,e){return ou(this,void 0,void 0,(function*(){const n=new Date,r=new Date(n.getTime()-864e5);return su&&su>r&&uu?vu.postMessage({type:"CS_TOOLS_GET_ACTIVE_TOOLS_SUCCESS",__tabId:t.tabId,tools:uu}):iu(void 0,void 0,void 0,(function*(){const t=Qr+"/get_active_tools",e=yield zr(),n=yield fetch(t,{method:"GET",headers:{Authorization:`Bearer ${e}`}}),r=yield n.json();if(r.tools)return r.tools;throw new Error("error fetching active tools")})).then((e=>{su=new Date,uu=e,vu.postMessage({type:"CS_TOOLS_GET_ACTIVE_TOOLS_SUCCESS",__tabId:t.tabId,tools:e})})),e}))}var au=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))};function fu(t,e){return au(this,void 0,void 0,(function*(){switch(t.type){case"BG_BEGIN_NEXT_TASK":return function(t,e){return Cs(this,void 0,void 0,(function*(){const n=cs(e,t.tabId),{isPaused:r,isRunning:i,tasks:o}=n;return!i||r?e:o.length?(vu.postMessage(o[0]),es(e,t.tabId,(t=>Object.assign(Object.assign({},t),{tasks:t.tasks.slice(1)})))):e}))}(t,e);case"BG_CREATE_WORKFLOW":return Rs(t,e);case"BG_FOCUS_TAB":return function(t,e){return Ds(this,void 0,void 0,(function*(){return chrome.tabs.get(t.tabId,(function(t){chrome.windows.update(t.windowId,{focused:!0})})),e}))}(t,e);case"BG_BEGIN_NEW_CHAT":return function(t,e){return ru(this,void 0,void 0,(function*(){return Object.assign(Object.assign({},e),{chat:Object.assign(Object.assign({},e.chat),{active:e.chat.active.filter((e=>!e.subscribedTabIds.includes(t.tabId)))})})}))}(t,e);case"BG_CHAT_DELETE_SESSION":return Go(t,e);case"BG_CHAT_SET_SESSION_HISTORY":return Wo(t,e);case"BG_CHAT_SET_SESSION_HISTORY_SUCCESS":return function(t,e){return Jo(this,void 0,void 0,(function*(){return vu.postMessage({type:"CS_CHAT_SET_SESSION_HISTORY_SUCCESS",__tabId:t.tabId,history:t.history}),Object.assign(Object.assign({},e),{chat:Object.assign(Object.assign({},e.chat),{history:t.history})})}))}(t,e);case"BG_CHAT_GENERATE_MESSAGE":return Lo(t,e);case"BG_CHAT_GENERATE_MESSAGE_CONTINUE":return Ko(t,e);case"BG_CHAT_GENERATE_MESSAGE_ERROR":return function(t,e){return $o(this,void 0,void 0,(function*(){return t.txid&&Mo[t.txid]&&(Mo[t.txid].cancel(),delete Mo[t.txid]),vu.postMessage({type:"CS_CHAT_GENERATE_MESSAGE_ERROR",__tabId:t.tabId,txid:t.txid,sessionId:t.sessionId,message:t.message}),Uo(e,t.tabId,(e=>Object.assign(Object.assign({},e),{messages:e.messages.concat({role:"error",text:t.message,assistantLastHistoryId:null})})))}))}(t,e);case"BG_CHAT_GET_ACTIVE_CHAT":return Yo(t,e);case"BG_CHAT_GET_ACTIVE_CHAT_SUCCESS":return function(t,e){return Xo(this,void 0,void 0,(function*(){return vu.postMessage({type:"CS_CHAT_SET_ACTIVE_CHAT_SUCCESS",__tabId:t.tabId,sessionId:t.sessionId,messages:t.messages}),Uo(e,t.tabId,(e=>Object.assign(Object.assign({},e),{subscribedTabIds:[...new Set(e.subscribedTabIds).add(t.tabId)],sessionId:t.sessionId,messages:t.messages})))}))}(t,e);case"BG_CHAT_STOP_ACTIVE_CHAT":return function(t,e){return Zo(this,void 0,void 0,(function*(){const n=e.chat.active.map((e=>e.subscribedTabIds.includes(t.tabId)?Object.assign(Object.assign({},e),{subscribedTabIds:e.subscribedTabIds.filter((e=>e!==t.tabId))}):e)).filter((t=>t.subscribedTabIds.length));return Object.assign(Object.assign({},e),{chat:Object.assign(Object.assign({},e.chat),{active:n})})}))}(t,e);case"BG_GET_NEXT_COMMAND":return Gs(t,e);case"BG_GET_NEXT_COMMAND_ERROR":return function(t,e){return Us(this,void 0,void 0,(function*(){const n=cs(e,t.tabId);if(t.runNumber!==n.runNumber)return e;if(n.isPaused)return es(e,t.tabId,(e=>Object.assign(Object.assign({},e),{tasks:[t]})));const r={message:t.message||"Something went wrong. Please try again and let us know if the error persists.",sender:"error",vote:null,feedback:null,feedbackDismissed:null};return vu.postMessage({type:"CS_GET_NEXT_COMMAND_ERROR",__tabId:n.tabIds.at(-1),__appTabId:n.appTabId,chatMessage:r}),es(e,t.tabId,(t=>Object.assign(Object.assign({},t),{chatLog:t.chatLog.concat(r)})))}))}(t,e);case"BG_GET_NEXT_COMMAND_SUCCESS":return qs(t,e);case"BG_GET_NEXT_FAKE_COMMAND":return Ks(t,e);case"BG_GET_NEXT_FAKE_COMMAND_SUCCESS":return function(t,e){const n=cs(e,t.tabId),{runNumber:r}=n,i=rs.pop();vu.postMessage({type:"BG_GET_NEXT_COMMAND_SUCCESS",tabId:t.tabId,cmd:t.commandString,lastMessage:{content:JSON.stringify({"your thoughts":t.thoughts}),action_id:_s},userMessageHistoryId:_s,sessionId:_s,runNumber:r,taskHeadline:i.request.objective});const o={request:i.request,response:{session_id:_s,action:t.commandString,lastMessage:{action_id:_s,content:t.thoughts||""},taskHeadline:i.request.objective,userMessageHistoryId:_s},omitTraining:t.omitTraining};return ss(t.loraCategory),rs.push(o),e}(t,e);case"BG_GET_STYLESHEET":return function(t,e){return Js(this,void 0,void 0,(function*(){try{const e=yield fetch(t.href),n=yield e.text();vu.postMessage({type:"CS_GET_STYLESHEET_SUCCESS",__tabId:t.tabId,__appTabId:null,href:t.href,stylesheetText:n,then:t.then})}catch(e){vu.postMessage({type:"CS_GET_STYLESHEET_SUCCESS",__tabId:t.tabId,__appTabId:null,href:t.href,stylesheetText:"",then:t.then})}return e}))}(t,e);case"BG_GET_PDF_ARRAY_BUFFER":return Ws(t,e);case"BG_OPEN":return function(t,e){return ns(this,void 0,void 0,(function*(){return chrome.storage.local.set({screenshotArray:[]}),es(e,t.tabId,(t=>Object.assign(Object.assign({},t),{isOpen:!0})))}))}(t,e);case"BG_PAUSE_FOR_VOTING":return function(t,e){return Vs(this,void 0,void 0,(function*(){return es(e,t.tabId,(t=>Object.assign(Object.assign({},t),{isPaused:!0})))}))}(t,e);case"BG_PAUSE_TASKS":return function(t,e){return Ys(this,void 0,void 0,(function*(){const n=cs(e,t.tabId),r=n.chatLog.concat({message:"Paused the workflow",sender:"user",vote:null,feedback:null,feedbackDismissed:null});return t.fromApp?vu.postMessage({type:"CS_PAUSE_WORKFLOW",__tabId:t.tabId,__appTabId:n.appTabId,chatLog:r}):vu.postMessage({type:"APP_PAUSE_TASKS",__appTabId:n.appTabId,chatLog:r}),es(e,t.tabId,(t=>Object.assign(Object.assign({},t),{isPaused:!0,chatLog:r})))}))}(t,e);case"BG_PREPEND_NEW_TASKS":return function(t,e){return Xs(this,void 0,void 0,(function*(){return es(e,t.tabId,(e=>Object.assign(Object.assign({},e),{tasks:t.tasks.concat(e.tasks)})))}))}(t,e);case"BG_RESET_STATE":return function(t,e){return us(this,void 0,void 0,(function*(){return vu.postMessage({type:"CS_RESET_STATE",__tabId:t.tabId,__appTabId:t.appTabId}),is(),Object.assign(Object.assign({},e),{workflows:e.workflows.filter((e=>!e.tabIds.includes(t.tabId)))})}))}(t,e);case"BG_RESUME_TASKS":return function(t,e){return Qs(this,void 0,void 0,(function*(){const n=cs(e,t.tabId),{isPaused:r,chatLog:i}=n,o=i.concat({message:"Resumed the workflow",sender:"user",vote:null,feedback:null,feedbackDismissed:null});return t.fromApp?vu.postMessage({type:"CS_RESUME_WORKFLOW",__tabId:t.tabId,__appTabId:n.appTabId,chatLog:t.modifyChatLog?o:i}):t.modifyChatLog&&vu.postMessage({type:"APP_RESUME_TASKS",__appTabId:n.appTabId,chatLog:t.modifyChatLog?o:i}),r&&t.modifyChatLog?es(e,t.tabId,(t=>Object.assign(Object.assign({},t),{isRunning:!0,isPaused:!1,awaitingUserResponse:!1,chatLog:o}))):es(e,t.tabId,(t=>Object.assign(Object.assign({},t),{isRunning:!0,isPaused:!1,awaitingUserResponse:!1})))}))}(t,e);case"BG_SAVE_VOTE_STATE":return function(t,e){return Zs(this,void 0,void 0,(function*(){const n=cs(e,t.tabId).chatLog.slice(),r=n.findIndex((e=>e.id===t.chatMessage.id));return n.splice(r,1,Object.assign(Object.assign({},n[r]),t.chatMessage)),es(e,t.tabId,(t=>Object.assign(Object.assign({},t),{chatLog:n})))}))}(t,e);case"BG_STUDIO_START_RECORDING":return Ps(t,e);case"BG_STUDIO_PAUSE_RECORDING":return function(t,e){return bs(this,void 0,void 0,(function*(){return ps(),es(e,t.tabId,(t=>Object.assign(Object.assign({},t),{isPaused:!0})))}))}(t,e);case"BG_STUDIO_SET_REQUEST":return function(t,e){return Is(this,void 0,void 0,(function*(){return es(e,t.tabId,(e=>Object.assign(Object.assign({},e),{trainingRequest:Object.assign(Object.assign({},e.trainingRequest||{screenshot:"ERROR"}),t.trainingRequestWithoutScreenshot)})))}))}(t,e);case"BG_STUDIO_SET_RESPONSE":return function(t,e){return As(this,void 0,void 0,(function*(){return es(e,t.tabId,(e=>Object.assign(Object.assign({},e),{trainingResponse:t.trainingResponse,trainingScreenshotPhase:Qo.Unstable})))}))}(t,e);case"BG_STUDIO_SAVE_TRAINING_DATA":return Os(t,e);case"BG_STUDIO_SAVE_TRAINING_DATA_SUCCESS":return function(t,e){return Ts(this,void 0,void 0,(function*(){return"rate_limit"===t.response.reason?(vu.postMessage({type:"CS_TERMINATE_RECORDING",__tabId:t.tabId,message:"Recording limit reached"}),es(e,t.tabId,(t=>Object.assign(Object.assign({},t),{isPaused:!0,studioErrorMessage:"Recording limit reached"})))):e}))}(t,e);case"BG_STUDIO_TAKE_SCREENSHOT":return function(t,e){return ls(this,void 0,void 0,(function*(){const n=cs(e,t.tabId);Math.floor(hs-performance.now());const r=yield fs(t.tabId);if(hs=performance.now()+501,n.trainingScreenshotPhase===Qo.StablePending)return vu.postMessage({type:"CS_STUDIO_SET_PHASE",__tabId:t.tabId,trainingScreenshotPhase:Qo.Stable}),es(e,t.tabId,(t=>Object.assign(Object.assign({},t),{trainingRequest:Object.assign(Object.assign({},t.trainingRequest),{screenshot:r}),trainingScreenshotPhase:Qo.Stable})));throw new Error(`${n.trainingScreenshotPhase} is not a pending state`)}))}(t,e);case"BG_STUDIO_DEBOUNCE_SCREENSHOT":return function(t,e){return ds(this,void 0,void 0,(function*(){if(cs(e,t.tabId).trainingScreenshotPhase!==Qo.Unstable)throw new Error("debounce screenshot requested when not unstable");return ys||(ys=setTimeout((()=>{ps(),vu.postMessage({type:"BG_STUDIO_DEBOUNCE_SCREENSHOT_CONTINUE",tabId:t.tabId})}),5e3)),clearTimeout(vs),vs=setTimeout((()=>{ps(),vu.postMessage({type:"BG_STUDIO_DEBOUNCE_SCREENSHOT_CONTINUE",tabId:t.tabId})}),501),e}))}(t,e);case"BG_STUDIO_DEBOUNCE_SCREENSHOT_CANCEL":return function(t,e){return ms(this,void 0,void 0,(function*(){return ps(),e}))}(0,e);case"BG_STUDIO_DEBOUNCE_SCREENSHOT_CONTINUE":return function(t,e){return ws(this,void 0,void 0,(function*(){const n=cs(e,t.tabId),{isPaused:r,trainingScreenshotPhase:i}=n;if(r)return e;if(i===Qo.Unstable)return vu.postMessage({type:"CS_STUDIO_SET_PHASE",__tabId:t.tabId,trainingScreenshotPhase:Qo.StablePending}),es(e,t.tabId,(t=>Object.assign(Object.assign({},t),{trainingScreenshotPhase:Qo.StablePending})));throw new Error("screenshot triggered but phase is not Unstable")}))}(t,e);case"BG_STOP_WORKFLOW":return function(t,e){return tu(this,void 0,void 0,(function*(){const n=cs(e,t.tabId),r=n.tabIds.at(-1),i=yield eu(n.appTabId),o=yield eu(n.initialWindowId);return i?(yield chrome.tabs.move(r,{index:-1,windowId:i.id}),yield chrome.windows.update(i.id,{drawAttention:!0})):o?(yield chrome.tabs.move(r,{index:-1,windowId:o.id}),yield chrome.windows.update(n.initialWindowId,{drawAttention:!0})):yield chrome.windows.create({tabId:r,state:"maximized"}),vu.postMessage({type:"CS_RESET_STATE",__tabId:r,__appTabId:n.appTabId}),t.shouldReload&&(yield chrome.tabs.reload(r)),is(),Object.assign(Object.assign({},e),{workflows:e.workflows.filter((e=>!e.tabIds.includes(t.tabId)))})}))}(t,e);case"BG_TOOLS_GET_ACTIVE_TOOLS":return cu(t,e);case"BG_VOTE_ON_WORKFLOW":return function(t,e){return nu(this,void 0,void 0,(function*(){const n=cs(e,t.tabId);return"app"===t.voted?vu.postMessage({type:"CS_VOTE_ON_WORKFLOW",__tabId:t.tabId}):"cs"===t.voted&&vu.postMessage({type:"APP_VOTE_ON_WORKFLOW",__appTabId:n.appTabId||-1}),Object.assign(Object.assign({},e),{workflows:e.workflows.map((e=>e.tabIds.includes(t.tabId)?n:e))})}))}(t,e);default:return e}}))}var lu=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((r=r.apply(t,e||[])).next())}))},hu=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n};let du={workflows:[],chat:{history:null,active:[]}};let vu,yu,pu={},mu={};setInterval((()=>{const t=Object.keys(Object.assign(Object.assign({},pu),mu));t.length&&chrome.tabs.sendMessage(Number(t[0]),{heartbeat:!0})}),1e4);let wu=Promise.resolve();function bu(t){ks(t)&&(t.onMessage.addListener(_u),t.onDisconnect.addListener(ku),pu[t.sender.tab.id]=t)}function gu(t){ks(t)&&(t.onMessage.addListener(_u),t.onDisconnect.addListener(Eu),mu[t.sender.tab.id]=t)}function _u(t,e){ks(e)&&vu.postMessage(t)}function ku(t){ks(t)&&pu[t.sender.tab.id]===t&&(t.onMessage.removeListener(_u),t.onMessage.removeListener(ku),delete pu[t.sender.tab.id])}function Eu(t){ks(t)&&mu[t.sender.tab.id]===t&&(t.onMessage.removeListener(_u),t.onMessage.removeListener(Eu),delete mu[t.sender.tab.id])}function Su({data:t}){return lu(this,void 0,void 0,(function*(){if(("number"==typeof(e=t).type&&1e3<=e.type&&e.type<2e3||"string"==typeof e.type&&e.type.startsWith("CS_"))&&"number"==typeof e.__tabId||function(t){return"number"==typeof t.type&&3e3<=t.type&&t.type<4e3||"string"==typeof t.type&&t.type.startsWith("APP_")}(t))if("CS_GET_PDF_ARRAY_BUFFER_CONTINUE"===t.type){const e=pu[t.__tabId];e&&e.postMessage(t)}else Object.values(pu).forEach((e=>e.postMessage(t))),Object.values(mu).forEach((e=>e.postMessage(t)));else(function(t){return"number"==typeof t.type&&2e3<=t.type&&t.type<3e3||"string"==typeof t.type&&t.type.startsWith("BG_")||"string"==typeof t.type&&"BACKGROUND_ACTION"===t.type})(t)&&(wu=wu.then((()=>lu(this,void 0,void 0,(function*(){!function(t){du=Object.assign({},t)}(yield fu(t,du))})))).catch(console.error));var e}))}function Ou(t,e,n){if(function(t){return"workflows"===t.type&&("GET_INITIAL_STATE"===t.name||"GET_TAB_IDS"===t.name)}(t)&&Es(e)){const t=function(t,e){try{const n=cs(t,e),{trainingRequest:r,trainingResponse:i}=n;return hu(n,["trainingRequest","trainingResponse"])}catch(t){if(String(t).includes(`cant find workflow with tabId ${e}`)){const{trainingRequest:t,trainingResponse:e}=ts;return hu(ts,["trainingRequest","trainingResponse"])}throw t}}(du,e.tab.id),r=function(t,e){return{history:t.chat.history,active:t.chat.active.find((t=>t.subscribedTabIds.includes(e)))||null}}(du,e.tab.id);return n({tabId:e.tab.id,windowId:e.tab.windowId,workflow:t,chat:r}),!0}if("reloadExtension"===t.request)return chrome.runtime.reload(),!0}function Tu(t){return lu(this,void 0,void 0,(function*(){const e=du.workflows.find((e=>e.tabIds.includes(t)));e?vu.postMessage({type:"BG_RESET_STATE",tabId:t,appTabId:e.appTabId}):du.workflows.some((e=>e.appTabId===t))&&du.workflows.forEach((e=>lu(this,void 0,void 0,(function*(){if(e.appTabId===t){vu.postMessage({type:"BG_RESET_STATE",tabId:e.tabIds[0],appTabId:e.appTabId});const{windowId:t}=yield chrome.tabs.get(e.tabIds[0]);e.initialWindowId!==t&&chrome.tabs.remove(e.tabIds[0])}}))));du.chat.active.some((e=>e.subscribedTabIds.includes(t)))&&vu.postMessage({type:"BG_CHAT_STOP_ACTIVE_CHAT",tabId:t})}))}chrome.runtime.onInstalled.addListener(pi),chrome.runtime.onMessage.addListener(vi),chrome.runtime.onConnect.addListener(hi),function(){lu(this,void 0,void 0,(function*(){Do("background","local").clear(),vu=new BroadcastChannel("workflows"),null==yu||yu.removeEventListener("message",Su),yu=new BroadcastChannel("workflows"),yu.addEventListener("message",Su),chrome.runtime.onConnect.addListener(bu),chrome.runtime.onConnectExternal.addListener(gu),chrome.runtime.onMessage.addListener(Ou),chrome.runtime.onMessageExternal.addListener(Ou),chrome.tabs.onRemoved.addListener(Tu)}))}();const Iu=["hyperwriteai.com","app.hyperwriteai.com","www.youtube.com","www.weebly.com","insight.adsrvr.org","www.netflix.com"]})()})();