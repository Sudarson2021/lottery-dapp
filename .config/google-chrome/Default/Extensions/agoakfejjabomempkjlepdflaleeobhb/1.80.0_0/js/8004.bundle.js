"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="08ae3e7a-bc26-5e0b-bfb6-c866374a2d2c")}catch(e){}}();
(self.webpackChunkavalanche_extension=self.webpackChunkavalanche_extension||[]).push([[8004],{69131:function(e,t,i){var r,s,a,n,o,c,d,h,l,u,p,f,y=i(23085).lW,w=this&&this.__classPrivateFieldSet||function(e,t,i,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,i):s?s.value=i:t.set(e,i),i},g=this&&this.__classPrivateFieldGet||function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)},b=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OidcClient=t.CubeSignerApi=t.createHttpClient=t.OpClient=void 0;const m=b(i(13425)),v=i(89411),_=i(49212),k=i(45156),S=i(78975),E=i(46825),P=i(58396),I=i(8056),C=i(88004);class A{constructor(e,t,i,o){r.set(this,void 0),s.set(this,void 0),a.set(this,void 0),n.set(this,void 0),w(this,r,e,"f"),w(this,s,t,"f"),w(this,a,i,"f"),w(this,n,o??{codes:[...Array(100).keys()].map((e=>500+e)),delaysMs:[100,200,400]},"f")}get op(){return g(this,r,"f")}async assertOk(e){if(e.error){const t=e.error,i=new S.ErrResponse({operation:this.op,requestId:t?.request_id,message:t?.message,statusText:e.response?.statusText,status:e.response?.status,url:e.response?.url,errorCode:t?.error_code});throw await g(this,a,"f").classifyAndEmitError(i),i}if(void 0===e.data)throw new Error("Response data is undefined");return e.data}withRetries(e){return this.withRetrySettings({codes:g(this,n,"f").codes,delaysMs:e})}withRetrySettings(e){return new A(this.op,g(this,s,"f"),g(this,a,"f"),e)}async execute(e){let t=await e(),i=0;for(;g(this,n,"f").codes.includes(t.response?.status)&&i<g(this,n,"f").delaysMs.length;)await(0,v.delay)(g(this,n,"f").delaysMs[i]),t=await e(),i++;return await this.assertOk(t)}async get(e,t){return await this.execute((()=>g(this,s,"f").get(e,t)))}async post(e,t){return await this.execute((()=>g(this,s,"f").post(e,t)))}async patch(e,t){return await this.execute((()=>g(this,s,"f").patch(e,t)))}async del(e,t){return await this.execute((()=>g(this,s,"f").del(e,t)))}async put(e,t){return await this.execute((()=>g(this,s,"f").put(e,t)))}}function O(e,t){return(0,m.default)({baseUrl:e,cache:"no-store",headers:{Authorization:t,"User-Agent":`${C.NAME}@${C.VERSION}`,"X-Cubist-Ts-Sdk":`${C.NAME}@${C.VERSION}`}})}t.OpClient=A,r=new WeakMap,s=new WeakMap,a=new WeakMap,n=new WeakMap,t.createHttpClient=O;class x{get sessionMgr(){return g(this,c,"f")}get env(){return this.sessionMgr.env}constructor(e,t,i){o.set(this,void 0),c.set(this,void 0),d.set(this,void 0),h.set(this,void 0),w(this,c,e,"f"),w(this,d,new I.EventEmitter([e.events]),"f"),w(this,o,t??e.orgId,"f"),w(this,h,i,"f")}withOrg(e){return e?new x(g(this,c,"f"),e):this}get orgId(){return g(this,o,"f")}async client(e){const t=await g(this,c,"f").client(e);return new A(e,t,g(this,d,"f"),g(this,h,"f"))}async userGet(){if("undefined"==`${this.orgId}`){const e=await this.client("aboutMeLegacy");return await e.get("/v0/about_me",{})}{const e=await this.client("aboutMe");return await e.get("/v0/org/{org_id}/user/me",{params:{path:{org_id:this.orgId}}})}}async userTotpResetInit(e,t){return await k.CubeSignerResponse.create((async t=>{const i=await this.client("userResetTotpInit"),r=await i.post("/v0/org/{org_id}/user/me/totp",{headers:t,params:{path:{org_id:this.orgId}},body:e?{issuer:e}:null});return(0,k.mapResponse)(r,(e=>new _.TotpChallenge(this,e)))}),t)}async userTotpResetComplete(e,t){const i=await this.client("userResetTotpComplete");await i.patch("/v0/org/{org_id}/user/me/totp",{params:{path:{org_id:this.orgId}},body:{totp_id:e,code:t}})}async userTotpVerify(e){const t=await this.client("userVerifyTotp");await t.post("/v0/org/{org_id}/user/me/totp/verify",{params:{path:{org_id:this.orgId}},body:{code:e}})}async userTotpDelete(e){return await k.CubeSignerResponse.create((async e=>{const t=await this.client("userDeleteTotp");return await t.del("/v0/org/{org_id}/user/me/totp",{headers:e,params:{path:{org_id:this.orgId}},body:null})}),e)}async userFidoRegisterInit(e,t){return await k.CubeSignerResponse.create((async t=>{const i=await this.client("userRegisterFidoInit"),r=await i.post("/v0/org/{org_id}/user/me/fido",{headers:t,params:{path:{org_id:this.orgId}},body:{name:e}});return(0,k.mapResponse)(r,(e=>new _.AddFidoChallenge(this,e)))}),t)}async userFidoRegisterComplete(e,t){const i=await this.client("userRegisterFidoComplete");await i.patch("/v0/org/{org_id}/user/me/fido",{params:{path:{org_id:this.orgId}},body:{challenge_id:e,credential:t}})}async userFidoDelete(e,t){return await k.CubeSignerResponse.create((async t=>{const i=await this.client("userDeleteFido");return await i.del("/v0/org/{org_id}/user/me/fido/{fido_id}",{headers:t,params:{path:{org_id:this.orgId,fido_id:e}},body:null})}),t)}async orgGet(){const e=await this.client("getOrg");return await e.get("/v0/org/{org_id}",{params:{path:{org_id:this.orgId}}})}async orgUpdate(e){const t=await this.client("updateOrg");return await t.patch("/v0/org/{org_id}",{params:{path:{org_id:this.orgId}},body:e})}async orgUserInvite(e,t,i){const r=await this.client("invite");await r.post("/v0/org/{org_id}/invite",{params:{path:{org_id:this.orgId}},body:{email:e,name:t,role:i,skip_email:!1}})}async orgUsersList(){const e=await this.client("listUsersInOrg");return(await e.get("/v0/org/{org_id}/users",{params:{path:{org_id:this.orgId}}})).users}async orgUserCreateOidc(e,t,i={}){const r=await this.client("createOidcUser");return(await r.post("/v0/org/{org_id}/users",{params:{path:{org_id:this.orgId}},body:{identity:e,role:i.memberRole??"Alien",email:t,name:i.name,mfa_policy:i.mfaPolicy}})).user_id}async orgUserDeleteOidc(e){const t=await this.client("deleteOidcUser");return await t.del("/v0/org/{org_id}/users/oidc",{params:{path:{org_id:this.orgId}},body:e})}async keyGet(e){const t=await this.client("getKeyInOrg");return await t.get("/v0/org/{org_id}/keys/{key_id}",{params:{path:{org_id:this.orgId,key_id:e}}})}keyRolesList(e,t){return new E.Paginator(t??E.Page.default(),(async t=>{const i=await this.client("listKeyRoles");return await i.get("/v0/org/{org_id}/keys/{key_id}/roles",{params:{path:{org_id:this.orgId,key_id:e},query:t}})}),(e=>e.roles),(e=>e.last_evaluated_key))}async keyUpdate(e,t){const i=await this.client("updateKey");return await i.patch("/v0/org/{org_id}/keys/{key_id}",{params:{path:{org_id:this.orgId,key_id:e}},body:t})}async keyDelete(e){const t=await this.client("deleteKey");await t.del("/v0/org/{org_id}/keys/{key_id}",{params:{path:{org_id:this.orgId,key_id:e}}})}async keysCreate(e,t,i,r){const s=await this.client("createKey");return(await s.post("/v0/org/{org_id}/keys",{params:{path:{org_id:this.orgId}},body:{count:t,chain_id:0,key_type:e,...r,owner:r?.owner??i}})).keys}async keysDerive(e,t,i){const r=await this.client("deriveKey");return(await r.put("/v0/org/{org_id}/derive_key",{params:{path:{org_id:this.orgId}},body:{derivation_path:t,mnemonic_id:i,key_type:e}})).keys}keysList(e,t){return new E.Paginator(t??E.Page.default(),(async t=>{const i=await this.client("listKeysInOrg");return await i.get("/v0/org/{org_id}/keys",{params:{path:{org_id:this.orgId},query:{key_type:e,...t}}})}),(e=>e.keys),(e=>e.last_evaluated_key))}async roleCreate(e){const t=await this.client("createRole");return(await t.post("/v0/org/{org_id}/roles",{params:{path:{org_id:this.orgId}},body:e?{name:e}:void 0})).role_id}async roleGet(e){const t=await this.client("getRole");return await t.get("/v0/org/{org_id}/roles/{role_id}",{params:{path:{org_id:this.orgId,role_id:e}}})}async roleUpdate(e,t){const i=await this.client("updateRole");return await i.patch("/v0/org/{org_id}/roles/{role_id}",{params:{path:{org_id:this.orgId,role_id:e}},body:t})}async roleDelete(e){const t=await this.client("deleteRole");await t.del("/v0/org/{org_id}/roles/{role_id}",{params:{path:{org_id:this.orgId,role_id:e}}})}rolesList(e){return new E.Paginator(e??E.Page.default(),(async e=>{const t=await this.client("listRoles");return await t.get("/v0/org/{org_id}/roles",{params:{path:{org_id:this.orgId},query:e}})}),(e=>e.roles),(e=>e.last_evaluated_key))}async roleKeysAdd(e,t,i){const r=await this.client("addKeysToRole");await r.put("/v0/org/{org_id}/roles/{role_id}/add_keys",{params:{path:{org_id:g(this,o,"f"),role_id:e}},body:{key_ids:t,policy:i??null}})}async roleKeysRemove(e,t){const i=await this.client("removeKeyFromRole");await i.del("/v0/org/{org_id}/roles/{role_id}/keys/{key_id}",{params:{path:{org_id:g(this,o,"f"),role_id:e,key_id:t}}})}roleKeysList(e,t){return new E.Paginator(t??E.Page.default(),(async t=>{const i=await this.client("listRoleKeys");return await i.get("/v0/org/{org_id}/roles/{role_id}/keys",{params:{path:{org_id:this.orgId,role_id:e},query:t}})}),(e=>e.keys),(e=>e.last_evaluated_key))}async roleUserAdd(e,t){const i=await this.client("addUserToRole");await i.put("/v0/org/{org_id}/roles/{role_id}/add_user/{user_id}",{params:{path:{org_id:g(this,o,"f"),role_id:e,user_id:t}}})}async roleUserRemove(e,t){const i=await this.client("removeUserFromRole");await i.del("/v0/org/{org_id}/roles/{role_id}/users/{user_id}",{params:{path:{org_id:this.orgId,role_id:e,user_id:t}}})}roleUsersList(e,t){return new E.Paginator(t??E.Page.default(),(async t=>{const i=await this.client("listRoleUsers");return await i.get("/v0/org/{org_id}/roles/{role_id}/users",{params:{path:{org_id:this.orgId,role_id:e},query:t}})}),(e=>e.users),(e=>e.last_evaluated_key))}async sessionCreate(e,t,i){i??=j;const r=await this.client("createSession"),s=await r.post("/v0/org/{org_id}/session",{params:{path:{org_id:this.orgId}},body:{purpose:e,scopes:t,auth_lifetime:i.auth,refresh_lifetime:i.refresh,session_lifetime:i.session,grace_lifetime:i.grace}});return{org_id:this.orgId,role_id:void 0,purpose:e,token:s.token,session_info:s.session_info,session_exp:s.expiration,env:{"Dev-CubeSignerStack":g(this,c,"f").env}}}async sessionCreateForRole(e,t,i,r){r??=j;const s=(i||[]).filter((e=>!e.startsWith("sign:")));if(s.length>0)throw new Error(`Role scopes must start with 'sign:'; invalid scopes: ${s}`);const a=await this.client("createRoleToken"),n=await a.post("/v0/org/{org_id}/roles/{role_id}/tokens",{params:{path:{org_id:this.orgId,role_id:e}},body:{purpose:t,scopes:i,auth_lifetime:r.auth,refresh_lifetime:r.refresh,session_lifetime:r.session,grace_lifetime:r.grace}});return{org_id:this.orgId,role_id:e,purpose:t,token:n.token,session_info:n.session_info,session_exp:n.expiration,env:{"Dev-CubeSignerStack":g(this,c,"f").env}}}async sessionRevoke(e){const t=await this.client("revokeSession");await t.del("/v0/org/{org_id}/session/{session_id}",{params:{path:{org_id:this.orgId,session_id:e}}})}sessionsList(e,t){return new E.Paginator(t??E.Page.default(),(async t=>{const i=await this.client("listSessions");return await i.get("/v0/org/{org_id}/session",{params:{path:{org_id:g(this,o,"f")},query:{role:e,...t}}})}),(e=>e.sessions),(e=>e.last_evaluated_key))}async sessionKeysList(){const e=await this.client("listTokenKeys");return(await e.get("/v0/org/{org_id}/token/keys",{params:{path:{org_id:this.orgId}}})).keys}async identityProve(){const e=await this.client("createProofCubeSigner");return await e.post("/v0/org/{org_id}/identity/prove",{params:{path:{org_id:this.orgId}}})}async identityVerify(e){const t=await this.client("verifyProof");await t.post("/v0/org/{org_id}/identity/verify",{params:{path:{org_id:this.orgId}},body:e})}async mfaGet(e){const t=await this.client("mfaGet");return await t.get("/v0/org/{org_id}/mfa/{mfa_id}",{params:{path:{org_id:this.orgId,mfa_id:e}}})}async mfaList(){const e=await this.client("mfaList");return(await e.get("/v0/org/{org_id}/mfa",{params:{path:{org_id:this.orgId}}})).mfa_requests}async mfaVoteCs(e,t){const i=await this.client("mfaVoteCs");return await i.patch("/v0/org/{org_id}/mfa/{mfa_id}",{params:{path:{org_id:this.orgId,mfa_id:e},query:{mfa_vote:t}}})}async mfaVoteTotp(e,t,i){const r=await this.client("mfaVoteTotp");return await r.patch("/v0/org/{org_id}/mfa/{mfa_id}/totp",{params:{path:{org_id:g(this,o,"f"),mfa_id:e},query:{mfa_vote:i}},body:{code:t}})}async mfaFidoInit(e){const t=await this.client("mfaFidoInit"),i=await t.post("/v0/org/{org_id}/mfa/{mfa_id}/fido",{params:{path:{org_id:this.orgId,mfa_id:e}}});return new _.MfaFidoChallenge(this,e,i)}async mfaVoteFidoComplete(e,t,i,r){const s=await this.client("mfaVoteFidoComplete");return await s.patch("/v0/org/{org_id}/mfa/{mfa_id}/fido",{params:{path:{org_id:this.orgId,mfa_id:e},query:{mfa_vote:t}},body:{challenge_id:i,credential:r}})}async signEvm(e,t,i){const r="string"==typeof e?e:e.materialId;return await k.CubeSignerResponse.create((async e=>{const i=await this.client("eth1Sign");return await i.post("/v1/org/{org_id}/eth1/sign/{pubkey}",{params:{path:{org_id:this.orgId,pubkey:r}},body:t,headers:e})}),i)}async signEip191(e,t,i){const r="string"==typeof e?e:e.materialId;return await k.CubeSignerResponse.create((async e=>{const i=await this.client("eip191Sign");return await i.post("/v0/org/{org_id}/evm/eip191/sign/{pubkey}",{params:{path:{org_id:this.orgId,pubkey:r}},body:t,headers:e})}),i)}async signEip712(e,t,i){const r="string"==typeof e?e:e.materialId;return await k.CubeSignerResponse.create((async e=>{const i=await this.client("eip712Sign");return await i.post("/v0/org/{org_id}/evm/eip712/sign/{pubkey}",{params:{path:{org_id:this.orgId,pubkey:r}},body:t,headers:e})}),i)}async signEth2(e,t,i){const r="string"==typeof e?e:e.materialId;return await k.CubeSignerResponse.create((async e=>{const i=await this.client("eth2Sign");return await i.post("/v1/org/{org_id}/eth2/sign/{pubkey}",{params:{path:{org_id:this.orgId,pubkey:r}},body:t,headers:e})}),i)}async signStake(e,t){return await k.CubeSignerResponse.create((async t=>{const i=await this.client("stake");return await i.post("/v1/org/{org_id}/eth2/stake",{params:{path:{org_id:this.orgId}},body:e,headers:t})}),t)}async signUnstake(e,t,i){const r="string"==typeof e?e:e.materialId;return await k.CubeSignerResponse.create((async e=>{const i=await this.client("unstake");return await i.post("/v1/org/{org_id}/eth2/unstake/{pubkey}",{params:{path:{org_id:this.orgId,pubkey:r}},body:t,headers:e})}),i)}async signAva(e,t,i){const r="string"==typeof e?e:e.materialId;return await k.CubeSignerResponse.create((async e=>{const i={tx:t},s=await this.client("avaSign");return await s.post("/v0/org/{org_id}/ava/sign/{pubkey}",{params:{path:{org_id:this.orgId,pubkey:r}},body:i,headers:e})}),i)}async signBlob(e,t,i){const r="string"==typeof e?e:e.id;return await k.CubeSignerResponse.create((async e=>{const i=await this.client("blobSign");return await i.post("/v1/org/{org_id}/blob/sign/{key_id}",{params:{path:{org_id:this.orgId,key_id:r}},body:t,headers:e})}),i)}async signBtc(e,t,i){const r="string"==typeof e?e:e.materialId;return await k.CubeSignerResponse.create((async e=>{const i=await this.client("btcSign");return await i.post("/v0/org/{org_id}/btc/sign/{pubkey}",{params:{path:{org_id:this.orgId,pubkey:r}},body:t,headers:e})}),i)}async signSolana(e,t,i){const r="string"==typeof e?e:e.materialId;return await k.CubeSignerResponse.create((async e=>{const i=await this.client("solanaSign");return await i.post("/v0/org/{org_id}/solana/sign/{pubkey}",{params:{path:{org_id:this.orgId,pubkey:r}},body:t,headers:e})}),i)}userExportList(e,t,i){return new E.Paginator(i??E.Page.default(),(async i=>{const r=await this.client("userExportList");return await r.get("/v0/org/{org_id}/user/me/export",{params:{path:{org_id:this.orgId},query:{user_id:t,key_id:e,...i}}})}),(e=>e.export_requests),(e=>e.last_evaluated_key))}async userExportDelete(e,t){const i=await this.client("userExportDelete");await i.del("/v0/org/{org_id}/user/me/export",{params:{path:{org_id:this.orgId},query:{key_id:e,user_id:t}}})}async userExportInit(e,t){return await k.CubeSignerResponse.create((async t=>{const i=await this.client("userExportInit");return await i.post("/v0/org/{org_id}/user/me/export",{params:{path:{org_id:this.orgId}},body:{key_id:e},headers:t})}),t)}async userExportComplete(e,t,i){const r=await(0,P.loadSubtleCrypto)(),s=(0,v.encodeToBase64)(y.from(await r.exportKey("raw",t)));return await k.CubeSignerResponse.create((async t=>{const i=await this.client("userExportComplete");return await i.patch("/v0/org/{org_id}/user/me/export",{params:{path:{org_id:this.orgId}},body:{key_id:e,public_key:s},headers:t})}),i)}async heartbeat(){const e=await this.client("cube3signerHeartbeat");await e.post("/v1/org/{org_id}/cube3signer/heartbeat",{params:{path:{org_id:this.orgId}}})}}t.CubeSignerApi=x,o=new WeakMap,c=new WeakMap,d=new WeakMap,h=new WeakMap,t.OidcClient=class{constructor(e,t,i,r){l.set(this,void 0),u.set(this,void 0),p.set(this,void 0),f.set(this,void 0),w(this,u,t,"f"),w(this,l,e,"f"),w(this,p,O(e.SignerApiRoot,i),"f"),w(this,f,r,"f")}client(e){return new A(e,g(this,p,"f"),new I.EventEmitter([]),g(this,f,"f"))}async sessionCreate(e,t,i){return await k.CubeSignerResponse.create((async i=>{const r=this.client("oidcAuth"),s=await r.post("/v0/org/{org_id}/oidc",{params:{path:{org_id:g(this,u,"f")}},headers:i,body:{scopes:e,tokens:t}});return(0,k.mapResponse)(s,(e=>({env:{"Dev-CubeSignerStack":g(this,l,"f")},org_id:g(this,u,"f"),token:e.token,purpose:"sign via oidc",session_info:e.session_info})))}),i)}async identityProve(){const e=this.client("createProofOidc");return await e.post("/v0/org/{org_id}/identity/prove/oidc",{params:{path:{org_id:g(this,u,"f")}}})}},l=new WeakMap,u=new WeakMap,p=new WeakMap,f=new WeakMap;const j={session:604800,auth:300,refresh:86400,grace:30}},11844:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CubeSignerClient=void 0;const r=i(52274),s=i(69131),a=i(46563),n=i(84945),o=i(79306);class c extends s.CubeSignerApi{constructor(e,t){super(e,t)}withOrg(e){return e?new c(this.sessionMgr,e):this}static async loadManagementSession(e){if((await e.retrieve()).id_token)throw new Error("It appears that the storage contains the old (Cognito) session; please update your session by updating your 'cs' to version 'v0.37.0' or later and then running 'cs login'");const t=await r.SignerSessionManager.loadFromStorage(e);return new c(t)}async createKey(e,t,i){const r=await this.keysCreate(e,1,t,i);return new a.Key(this,r[0])}async createKeys(e,t,i){return(await this.keysCreate(e,t,i)).map((e=>new a.Key(this,e)))}async deriveKey(e,t,i){return(await this.deriveKeys(e,[t],i))[0]}async deriveKeys(e,t,i){return(await this.keysDerive(e,t,i)).map((e=>new a.Key(this,e)))}newOidcClient(e){return new s.OidcClient(this.sessionMgr.env,this.orgId,e)}async oidcAuth(e,t,i){const s=this.newOidcClient(e),a=await s.sessionCreate(t,i?.lifetimes,i?.mfaReceipt);return await r.SignerSessionManager.loadFromStorage(new o.MemorySessionStorage(a.data()))}get createUser(){return this.orgUserInvite.bind(this)}get createOidcUser(){return this.orgUserCreateOidc.bind(this)}get deleteOidcUser(){return this.orgUserDeleteOidc.bind(this)}get users(){return this.orgUsersList.bind(this)}get user(){return this.userGet.bind(this)}async org(e){return await this.withOrg(e).orgGet()}get aboutMe(){return this.userGet.bind(this)}async getKey(e){const t=await this.keyGet(e);return new a.Key(this,t)}async orgKeys(e,t){const i=this.keysList(e,t);return(await i.fetch()).map((e=>new a.Key(this,e)))}async createRole(e){const t=await this.roleCreate(e),i=await this.roleGet(t);return new n.Role(this,i)}async getRole(e){const t=await this.roleGet(e);return new n.Role(this,t)}async listRoles(e){return(await this.rolesList(e).fetch()).map((e=>new n.Role(this,e)))}get listUsers(){return this.orgUsersList.bind(this)}async mfaApprove(e){return await this.mfaVoteCs(e,"approve")}async mfaReject(e){return await this.mfaVoteCs(e,"reject")}get approveMfaRequest(){return this.mfaApprove.bind(this)}async mfaApproveTotp(e,t){return await this.mfaVoteTotp(e,t,"approve")}async mfaRejectTotp(e,t){return await this.mfaVoteTotp(e,t,"reject")}get totpApprove(){return this.mfaApproveTotp.bind(this)}get fidoApproveFidoInit(){return this.mfaFidoInit.bind(this)}get fidoApproveStart(){return this.mfaFidoInit.bind(this)}async mfaApproveFidoComplete(e,t,i){return await this.mfaVoteFidoComplete(e,"approve",t,i)}async mfaRejectFidoComplete(e,t,i){return await this.mfaVoteFidoComplete(e,"reject",t,i)}get fidoApproveComplete(){return this.mfaApproveFidoComplete.bind(this)}get getMfaInfo(){return this.mfaGet.bind(this)}get listMfaInfos(){return this.mfaList.bind(this)}get proveIdentity(){return this.identityProve.bind(this)}get verifyIdentity(){return this.identityVerify.bind(this)}get addFidoStart(){return this.userFidoRegisterInit.bind(this)}get deleteFido(){return this.userFidoDelete.bind(this)}get resetTotpStart(){return this.userTotpResetInit.bind(this)}get resetTotpComplete(){return this.userTotpResetComplete.bind(this)}get verifyTotp(){return this.userTotpVerify.bind(this)}get deleteTotp(){return this.userTotpDelete.bind(this)}get stake(){return this.signStake.bind(this)}get unstake(){return this.signUnstake.bind(this)}}t.CubeSignerClient=c},6689:function(e,t,i){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.envs=void 0;const s=r(i(51137)),a=r(i(73717)),n=r(i(99751));t.envs={prod:s.default["Dev-CubeSignerStack"],gamma:a.default["Dev-CubeSignerStack"],beta:n.default["Dev-CubeSignerStack"]}},78975:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SessionExpiredError=t.ErrResponse=void 0;const i=["MfaChallengeExpired","MfaDisallowedApprover","MfaDisallowedIdentity","MfaTypeNotAllowed","MfaTotpBadCode","MfaTotpRateLimit","MfaTotpBadConfiguration","TotpNotConfigured","FidoVerificationFailed","UserRoleUnprivileged"],r=["mfaVoteCs","userResetTotpComplete","mfaVoteTotp","mfaVoteFidoComplete"];class s extends Error{constructor(e){super(e.message),Object.assign(this,e)}isSessionExpiredError(){return void 0!==this.errorCode&&a.includes(this.errorCode)}isUserMfaError(){return 403===this.status&&(void 0===this.operation||r.includes(this.operation))&&(void 0===this.errorCode||i.includes(this.errorCode))}}t.ErrResponse=s,t.SessionExpiredError=class extends s{constructor(e){super({message:"Session has expired",status:403,statusText:"Forbidden",operation:e,errorCode:"SessionExpired"})}};const a=["SessionExpired","SessionRevoked","SessionNotFound","SessionInvalidAuthToken","SessionInvalidEpochToken","SessionInvalidRefreshToken","SessionAuthTokenExpired","SessionRefreshTokenExpired","SessionPossiblyStolenToken"]},8056:function(e,t,i){var r,s,a,n,o,c=this&&this.__classPrivateFieldSet||function(e,t,i,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,i):s?s.value=i:t.set(e,i),i},d=this&&this.__classPrivateFieldGet||function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalEvents=t.EventEmitter=t.Events=t.UserMfaFailedEvent=t.SessionExpiredEvent=void 0;const h=i(78975);class l{}t.SessionExpiredEvent=l;class u extends h.ErrResponse{}t.UserMfaFailedEvent=u;class p{constructor(){r.set(this,void 0),c(this,r,[],"f")}register(e){return d(this,r,"f").push(e),this}unregister(e){const t=d(this,r,"f").indexOf(e);return t>=0&&(d(this,r,"f").splice(t,1),!0)}async dispatch(e){await Promise.all(d(this,r,"f").map((t=>t(e))))}}r=new WeakMap;class f{constructor(){s.set(this,new p),a.set(this,new p),n.set(this,new p)}onError(e){d(this,s,"f").register(e)}onSessionExpired(e){d(this,a,"f").register(e)}onUserMfaFailed(e){d(this,n,"f").register(e)}unregisterOnError(e){return d(this,s,"f").unregister(e)}unregisterOnSessionExpired(e){return d(this,a,"f").unregister(e)}unregisterOnUserMfaFailed(e){return d(this,n,"f").unregister(e)}async triggerSessionExpired(){await d(this,a,"f").dispatch(new l)}async triggerUserMfaFailed(e){await d(this,n,"f").dispatch(e)}async triggerErrorEvent(e){await d(this,s,"f").dispatch(e)}}t.Events=f,s=new WeakMap,a=new WeakMap,n=new WeakMap,t.EventEmitter=class{constructor(e,i){o.set(this,void 0),i??=!1,c(this,o,e,"f"),i||d(this,o,"f").push(t.GlobalEvents)}async classifyAndEmitError(e){for(const t of d(this,o,"f"))await t.triggerErrorEvent(e);e.isUserMfaError()&&await this.emitUserMfaFailed(e),403!==e.status||!e.isSessionExpiredError()&&"signerSessionRefresh"!=e.operation||await this.emitSessionExpired()}async emitSessionExpired(){for(const e of d(this,o,"f"))await e.triggerSessionExpired()}async emitUserMfaFailed(e){for(const t of d(this,o,"f"))await t.triggerUserMfaFailed(e)}},o=new WeakMap,t.GlobalEvents=new f},1928:function(e,t){var i,r,s,a,n,o,c=this&&this.__classPrivateFieldGet||function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)},d=this&&this.__classPrivateFieldSet||function(e,t,i,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,i):s?s.value=i:t.set(e,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.EvmSigner=void 0,t.EvmSigner=class{get address(){return c(this,r,"f")}get signerSession(){return c(this,a,"f")}get options(){return c(this,n,"f")}constructor(e,t,o){i.add(this),r.set(this,void 0),s.set(this,void 0),a.set(this,void 0),n.set(this,void 0),"string"==typeof e?d(this,r,e,"f"):(d(this,r,e.materialId,"f"),d(this,s,e,"f")),d(this,a,t,"f"),d(this,n,{onMfaPoll:o?.onMfaPoll,mfaPollIntervalMs:o?.mfaPollIntervalMs??1e3},"f")}async signTransaction(e){const t=await this.signEvm(e);return(await c(this,i,"m",o).call(this,t)).rlp_signed_tx}async signEvm(e){return await c(this,a,"f").signEvm(c(this,r,"f"),e)}async signEip712(e){const t=await c(this,a,"f").signEip712(c(this,r,"f"),e);return(await c(this,i,"m",o).call(this,t)).signature}async signEip191(e){const t=await c(this,a,"f").signEip191(c(this,r,"f"),e);return(await c(this,i,"m",o).call(this,t)).signature}async key(){if(void 0===c(this,s,"f")){const e=(await c(this,a,"f").keys()).find((e=>e.material_id===c(this,r,"f")));if(void 0===e)throw new Error(`Cannot access key '${c(this,r,"f")}'`);d(this,s,e,"f")}return c(this,s,"f")}async signTransactionMfaApproved(e){if(!e.request.path.includes("/eth1/sign/"))throw new Error(`Expected EVM transaction signing request, got ${e.request.path}`);if(!e.request.path.includes(c(this,r,"f")))throw new Error(`Expected signing request for ${c(this,r,"f")} but got ${e.request.path}`);if(!e.receipt)throw new Error("MFA request is not approved yet");return(await c(this,a,"f").signEvm(c(this,r,"f"),e.request.body,{mfaId:e.id,mfaOrgId:c(this,a,"f").orgId,mfaConf:e.receipt.confirmation})).data().rlp_signed_tx}},r=new WeakMap,s=new WeakMap,a=new WeakMap,n=new WeakMap,i=new WeakSet,o=async function(e){for(;e.requiresMfa();){await new Promise((e=>setTimeout(e,c(this,n,"f").mfaPollIntervalMs)));const t=e.mfaId(),i=await c(this,a,"f").getMfaInfo(t);c(this,n,"f").onMfaPoll?.(i),i.receipt&&(e=await e.signWithMfaApproval({mfaId:t,mfaOrgId:c(this,a,"f").orgId,mfaConf:i.receipt.confirmation}))}return e.data()}},88004:function(e,t,i){var r,s,a=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,s)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||a(t,e,i)},o=this&&this.__classPrivateFieldGet||function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)},c=this&&this.__classPrivateFieldSet||function(e,t,i,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,i):s?s.value=i:t.set(e,i),i},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=t.NAME=t.userExportKeygen=t.userExportDecrypt=t.SessionExpiredEvent=t.GlobalEvents=t.Events=t.CubeSigner=void 0;const h=i(6689),l=i(69131),u=i(11844),p=i(87039),f=i(52274),y=i(29642),w=d(i(28292));class g{get csc(){if(!o(this,s,"f"))throw new Error("CubeSignerClient is not set");return o(this,s,"f")}get env(){return o(this,r,"f")}get orgId(){return this.csc.orgId}setOrgId(e){c(this,s,this.csc.withOrg(e),"f")}static async loadManagementSession(e){return new g({sessionMgr:await f.SignerSessionManager.loadFromStorage(e)})}static async loadSignerSession(e){return await y.SignerSession.loadSignerSession(e)}constructor(e){r.set(this,void 0),s.set(this,void 0);let t=e?.env;e?.sessionMgr&&(this.sessionMgr=e.sessionMgr,t=t??this.sessionMgr.env),c(this,r,t??h.envs.gamma,"f"),c(this,s,new u.CubeSignerClient(e?.sessionMgr,e?.orgId),"f")}async oidcAuth(e,t,i,r,s){const a=await this.oidcLogin(e,t,i,r);return await f.SignerSessionManager.createFromSessionInfo(this.env,t,a.data(),s)}async aboutMe(){return await this.csc.userGet()}async mfaGet(e,t){return await this.csc.withOrg(e).mfaGet(t)}async mfaList(e){return await this.csc.withOrg(e).mfaList()}async mfaApprove(e,t){return await this.csc.withOrg(e).mfaApprove(t)}get addFidoStart(){return this.csc.userFidoRegisterInit.bind(this.csc)}get resetTotpStart(){return this.csc.userTotpResetInit.bind(o(this,s,"f"))}get resetTotpComplete(){return this.csc.userTotpResetComplete.bind(o(this,s,"f"))}get verifyTotp(){return this.csc.userTotpVerify.bind(o(this,s,"f"))}async getOrg(e){return new p.Org(this.csc.sessionMgr,e??this.csc.orgId)}async deleteKey(e,t){await this.csc.withOrg(e).keyDelete(t)}async management(){if(!this.sessionMgr)throw new Error("No management session loaded");return await this.sessionMgr.client()}async proveIdentity(e){return await this.csc.withOrg(e).identityProve()}async oidcProveIdentity(e,t){const i=new l.OidcClient(o(this,r,"f"),t,e);return await i.identityProve()}async verifyIdentity(e,t){await this.csc.withOrg(e).identityVerify(t)}async oidcLogin(e,t,i,s,a){const n=new l.OidcClient(o(this,r,"f"),t,e);return await n.sessionCreate(i,s,a)}}t.CubeSigner=g,r=new WeakMap,s=new WeakMap,n(i(78975),t),n(i(69131),t),n(i(11844),t);var b=i(8056);Object.defineProperty(t,"Events",{enumerable:!0,get:function(){return b.Events}}),Object.defineProperty(t,"GlobalEvents",{enumerable:!0,get:function(){return b.GlobalEvents}}),Object.defineProperty(t,"SessionExpiredEvent",{enumerable:!0,get:function(){return b.SessionExpiredEvent}}),n(i(87039),t),n(i(46563),t),n(i(84945),t),n(i(6689),t),n(i(49212),t),n(i(46825),t),n(i(45156),t),n(i(87387),t),n(i(29642),t),n(i(79306),t),n(i(52274),t),n(i(89411),t);var m=i(58396);Object.defineProperty(t,"userExportDecrypt",{enumerable:!0,get:function(){return m.userExportDecrypt}}),Object.defineProperty(t,"userExportKeygen",{enumerable:!0,get:function(){return m.userExportKeygen}}),n(i(1928),t),t.NAME=w.default.name,t.VERSION=w.default.version},46563:function(e,t,i){var r,s,a,n=this&&this.__classPrivateFieldGet||function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)},o=this&&this.__classPrivateFieldSet||function(e,t,i,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,i):s?s.value=i:t.set(e,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.fromSchemaKeyType=t.Key=t.toKeyInfo=t.Stark=t.Mnemonic=t.Ed25519=t.Bls=t.Secp256k1=void 0;const c=i(88004);var d,h,l;function u(e){return{...e,id:e.key_id,type:e.key_type,publicKey:e.public_key,materialId:e.material_id}}function p(e){switch(e){case"SecpEthAddr":return d.Evm;case"SecpBtc":return d.Btc;case"SecpBtcTest":return d.BtcTest;case"SecpAvaAddr":return d.Ava;case"SecpAvaTestAddr":return d.AvaTest;case"BlsPub":return h.Eth2Deposited;case"BlsInactive":return h.Eth2Inactive;case"Ed25519SolanaAddr":return l.Solana;case"Ed25519SuiAddr":return l.Sui;case"Ed25519AptosAddr":return l.Aptos;case"Ed25519CardanoAddrVk":return l.Cardano;case"Ed25519StellarAddr":return l.Stellar;case"Stark":return t.Stark;case"Mnemonic":return t.Mnemonic}}!function(e){e.Evm="SecpEthAddr",e.Btc="SecpBtc",e.BtcTest="SecpBtcTest",e.Ava="SecpAvaAddr",e.AvaTest="SecpAvaTestAddr"}(d||(t.Secp256k1=d={})),function(e){e.Eth2Deposited="BlsPub",e.Eth2Inactive="BlsInactive"}(h||(t.Bls=h={})),function(e){e.Solana="Ed25519SolanaAddr",e.Sui="Ed25519SuiAddr",e.Aptos="Ed25519AptosAddr",e.Cardano="Ed25519CardanoAddrVk",e.Stellar="Ed25519StellarAddr"}(l||(t.Ed25519=l={})),t.Mnemonic="Mnemonic",t.Stark="Stark",t.toKeyInfo=u,t.Key=class{get orgId(){return this.csc.orgId}get id(){return n(this,s,"f").key_id}get materialId(){return n(this,s,"f").material_id}get publicKey(){return n(this,s,"f").public_key}get cached(){return n(this,s,"f")}async type(){return p((await this.fetch()).key_type)}async enabled(){return(await this.fetch()).enabled}async enable(){await this.update({enabled:!0})}async disable(){await this.update({enabled:!1})}async roles(e){return await this.csc.keyRolesList(this.id,e).fetch()}async setPolicy(e){return await this.update({policy:e})}async setMetadata(e){return await this.update({metadata:e})}async setMetadataProperty(e,t){return await n(this,r,"m",a).call(this,e,t,[100,200,400])}async deleteMetadataProperty(e){return await n(this,r,"m",a).call(this,e,void 0,[100,200,400])}async appendPolicy(e){const t=await this.policy();await this.setPolicy([...t,...e])}async policy(){return(await this.fetch()).policy??[]}async metadata(){return(await this.fetch()).metadata}async owner(){return(await this.fetch()).owner}async setOwner(e){await this.update({owner:e})}async delete(){await this.csc.keyDelete(this.id)}constructor(e,t){r.add(this),s.set(this,void 0),this.csc=e,o(this,s,u(t),"f")}async update(e){return o(this,s,await this.csc.keyUpdate(this.id,e).then(u),"f"),n(this,s,"f")}async fetch(){return o(this,s,await this.csc.keyGet(this.id).then(u),"f"),n(this,s,"f")}},s=new WeakMap,r=new WeakSet,a=async function e(t,i,s){const a=await this.fetch(),o=a.metadata??{};if("object"!=typeof o)throw new Error("Current metadata is not a JSON object");const d={...o,[t]:i};try{return await this.update({metadata:d,version:a.version})}catch(a){if("InvalidUpdate"===a.errorCode&&s.length>0)return await(0,c.delay)(s[0]),await n(this,r,"m",e).call(this,t,i,s.slice(1));throw a}},t.fromSchemaKeyType=p},49212:function(e,t,i){var r,s,a,n,o=this&&this.__classPrivateFieldGet||function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)},c=this&&this.__classPrivateFieldSet||function(e,t,i,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,i):s?s.value=i:t.set(e,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.MfaFidoChallenge=t.AddFidoChallenge=t.TotpChallenge=void 0;const d=i(89411);t.TotpChallenge=class{get totpId(){return o(this,s,"f").totp_id}get totpUrl(){return o(this,s,"f").totp_url}constructor(e,t){r.set(this,void 0),s.set(this,void 0),c(this,r,e,"f"),c(this,s,t,"f")}async answer(e){if(!/^\d{1,6}$/.test(e))throw new Error(`Invalid TOTP code: ${e}; it must be a 6-digit string`);await o(this,r,"f").userTotpResetComplete(this.totpId,e)}},r=new WeakMap,s=new WeakMap,t.AddFidoChallenge=class{constructor(e,t){a.set(this,void 0),c(this,a,e,"f"),this.challengeId=t.challenge_id,this.options={...t.options,challenge:(0,d.decodeBase64Url)(t.options.challenge)},t.options.user&&(this.options.user.id=(0,d.decodeBase64Url)(t.options.user.id));for(const e of this.options.excludeCredentials??[])e.id=(0,d.decodeBase64Url)(e.id)}async createCredentialAndAnswer(){const e=await navigator.credentials.create({publicKey:this.options});await this.answer(e)}async answer(e){const t={id:e.id,response:{clientDataJSON:(0,d.encodeToBase64Url)(e.response.clientDataJSON),attestationObject:(0,d.encodeToBase64Url)(e.response.attestationObject)}};await o(this,a,"f").userFidoRegisterComplete(this.challengeId,t)}},a=new WeakMap,t.MfaFidoChallenge=class{constructor(e,t,i){n.set(this,void 0),c(this,n,e,"f"),this.mfaId=t,this.challengeId=i.challenge_id,this.options={...i.options,challenge:(0,d.decodeBase64Url)(i.options.challenge)};for(const e of this.options.allowCredentials??[])e.id=(0,d.decodeBase64Url)(e.id),null===e.transports&&delete e.transports}async createCredentialAndAnswer(e){const t=await navigator.credentials.get({publicKey:this.options});return await this.answer(t,e)}async answer(e,t="approve"){const i={id:e.id,response:{clientDataJSON:(0,d.encodeToBase64Url)(e.response.clientDataJSON),authenticatorData:(0,d.encodeToBase64Url)(e.response.authenticatorData),signature:(0,d.encodeToBase64Url)(e.response.signature)}};return await o(this,n,"f").mfaVoteFidoComplete(this.mfaId,t,this.challengeId,i)}},n=new WeakMap},87039:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Org=void 0;const r=i(11844),s=i(88004);class a extends r.CubeSignerClient{get id(){return this.orgId}get info(){return this.orgGet.bind(this)}async name(){return(await this.orgGet()).name??void 0}get keys(){return this.orgKeys.bind(this)}async setName(e){if(!/^[a-zA-Z0-9_]{3,30}$/.test(e))throw new Error("Org name must be alphanumeric and between 3 and 30 characters");await this.orgUpdate({name:e})}async enabled(){return(await this.orgGet()).enabled}async enable(){await this.orgUpdate({enabled:!0})}async disable(){await this.orgUpdate({enabled:!1})}async policy(){return(await this.orgGet()).policy??[]}async setPolicy(e){const t=e;await this.orgUpdate({policy:t})}async setNotificationEndpoints(e){await this.orgUpdate({notification_endpoints:e})}static async retrieveFromStorage(e){const t=await s.SignerSessionManager.loadFromStorage(e);return new a(new r.CubeSignerClient(t),t.orgId)}constructor(e,t){super(e instanceof r.CubeSignerClient?e.sessionMgr:e,"string"==typeof t?t:t?.org_id)}}t.Org=a},46825:function(e,t){var i,r,s,a,n,o,c=this&&this.__classPrivateFieldSet||function(e,t,i,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,i):s?s.value=i:t.set(e,i),i},d=this&&this.__classPrivateFieldGet||function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.Paginator=t.Page=void 0,t.Page=class{static default(){return{all:!0}}},t.Paginator=class{constructor(e,t,d,h){i.set(this,void 0),r.set(this,void 0),s.set(this,void 0),a.set(this,void 0),n.set(this,void 0),o.set(this,void 0),c(this,i,t,"f"),c(this,r,d,"f"),c(this,s,h,"f"),c(this,a,e,"f"),c(this,n,e.start,"f"),c(this,o,!1,"f")}async fetch(){return d(this,a,"f").all?await this.fetchAll():await this.fetchPage()}async fetchPage(){if(d(this,o,"f"))return[];const e=await d(this,i,"f").call(this,{"page.size":d(this,a,"f").size,"page.start":d(this,n,"f")});return c(this,n,d(this,s,"f").call(this,e),"f"),c(this,o,!d(this,n,"f"),"f"),d(this,r,"f").call(this,e)}async fetchAll(){const e=[];for(;!d(this,o,"f");){const t=await this.fetchPage();e.push(...t)}return e}},i=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap,n=new WeakMap,o=new WeakMap},45156:function(e,t){var i,r,s,a,n,o,c=this&&this.__classPrivateFieldGet||function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)},d=this&&this.__classPrivateFieldSet||function(e,t,i,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,i):s?s.value=i:t.set(e,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.CubeSignerResponse=t.mapResponse=void 0,t.mapResponse=function(e,t){return e.accepted?.MfaRequired?e:t(e)};class h{mfaId(){return c(this,a,"f").id}requiresMfa(){return void 0!==c(this,a,"f")}mfaSessionInfo(){return c(this,s,"f").accepted?.MfaRequired?.session??void 0}data(){if(this.requiresMfa())throw new Error("Cannot call `data()` while MFA is required");return c(this,s,"f")}async approveTotp(e,t){return await c(this,i,"m",n).call(this,e,t,"approve")}async rejectTotp(e,t){await c(this,i,"m",n).call(this,e,t,"reject")}async approve(e){return await c(this,i,"m",o).call(this,e,"approve")}async reject(e){await c(this,i,"m",o).call(this,e,"reject")}async signWithMfaApproval(e){const t=h.getMfaHeaders(e);return new h(c(this,r,"f"),await c(this,r,"f").call(this,t))}constructor(e,t){i.add(this),r.set(this,void 0),s.set(this,void 0),a.set(this,void 0),d(this,r,e,"f"),d(this,s,t,"f"),d(this,a,c(this,s,"f").accepted?.MfaRequired,"f")}static async create(e,t){const i=await e(this.getMfaHeaders(t));return new h(e,i)}static getMfaHeaders(e){return e?{"x-cubist-mfa-id":e.mfaId,"x-cubist-mfa-org-id":e.mfaOrgId,"x-cubist-mfa-confirmation":e.mfaConf}:void 0}}t.CubeSignerResponse=h,r=new WeakMap,s=new WeakMap,a=new WeakMap,i=new WeakSet,n=async function(e,t,i){if(!this.requiresMfa())return this;const r=this.mfaId(),s=c(this,a,"f").org_id,n=await e.mfaVoteTotp(r,t,i),o=n.receipt?.confirmation;return o?await this.signWithMfaApproval({mfaId:r,mfaOrgId:s,mfaConf:o}):this},o=async function(e,t){if(!this.requiresMfa())return this;const i=c(this,a,"f").id,r=c(this,a,"f").org_id,s=await e.mfaVoteCs(i,t),n=s.receipt?.confirmation;return n?await this.signWithMfaApproval({mfaId:i,mfaOrgId:r,mfaConf:n}):this}},84945:function(e,t,i){var r,s,a,n=this&&this.__classPrivateFieldGet||function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)},o=this&&this.__classPrivateFieldSet||function(e,t,i,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,i):s?s.value=i:t.set(e,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.Role=t.KeyWithPolicies=t.AllowEip712Signing=t.AllowEip191Signing=t.AllowRawBlobSigning=t.OperationKind=t.DepositContract=void 0;const c=i(88004);var d,h;!function(e){e[e.Canonical=0]="Canonical",e[e.Wrapper=1]="Wrapper"}(d||(t.DepositContract=d={})),function(e){e.BlobSign="BlobSign",e.EvmSign="Eth1Sign",e.Eth2Sign="Eth2Sign",e.Eth2Stake="Eth2Stake",e.Eth2Unstake="Eth2Unstake",e.SolanaSign="SolanaSign"}(h||(t.OperationKind=h={})),t.AllowRawBlobSigning="AllowRawBlobSigning",t.AllowEip191Signing="AllowEip191Signing",t.AllowEip712Signing="AllowEip712Signing";class l{async getKey(){const e=await n(this,r,"f").keyGet(this.keyId);return new c.Key(n(this,r,"f"),e)}constructor(e,t){r.set(this,void 0),o(this,r,e,"f"),this.keyId=t.key_id,this.policy=t.policy}}t.KeyWithPolicies=l,r=new WeakMap,t.Role=class{get name(){return n(this,a,"f").name??void 0}get id(){return n(this,a,"f").role_id}get cached(){return n(this,a,"f")}async delete(){await n(this,s,"f").roleDelete(this.id)}async enabled(){return(await this.fetch()).enabled}async enable(){await this.update({enabled:!0})}async disable(){await this.update({enabled:!1})}async setPolicy(e){await this.update({policy:e})}async appendPolicy(e){const t=await this.policy();await this.setPolicy([...t,...e])}async policy(){return(await this.fetch()).policy??[]}async users(e){return(await n(this,s,"f").roleUsersList(this.id,e).fetch()||[]).map((e=>e.user_id))}async addUser(e){await n(this,s,"f").roleUserAdd(this.id,e)}async removeUser(e){await n(this,s,"f").roleUserRemove(this.id,e)}async keys(e){return(await n(this,s,"f").roleKeysList(this.id,e).fetch()).map((e=>new l(n(this,s,"f"),e)))}async addKeys(e,t){await n(this,s,"f").roleKeysAdd(this.id,e.map((e=>e.id)),t)}async addKey(e,t){await this.addKeys([e],t)}async removeKey(e){await n(this,s,"f").roleKeysRemove(this.id,e.id)}async createSession(e,t,i,r){const a=await n(this,s,"f").sessionCreateForRole(this.id,t,r,i);await e.save(a);const o=await c.SignerSessionManager.loadFromStorage(e);return new c.SignerSession(o)}async sessions(e){return(await n(this,s,"f").sessionsList(this.id,e).fetch()).map((e=>new c.SignerSessionInfo(n(this,s,"f"),e.session_id,e.purpose)))}constructor(e,t){s.set(this,void 0),a.set(this,void 0),o(this,s,e,"f"),o(this,a,t,"f")}async update(e){return o(this,a,await n(this,s,"f").roleUpdate(this.id,e),"f"),n(this,a,"f")}async fetch(){return o(this,a,await n(this,s,"f").roleGet(this.id),"f"),n(this,a,"f")}},s=new WeakMap,a=new WeakMap},87387:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},79306:function(e,t){var i,r=this&&this.__classPrivateFieldSet||function(e,t,i,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,i):s?s.value=i:t.set(e,i),i},s=this&&this.__classPrivateFieldGet||function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.MemorySessionStorage=void 0,t.MemorySessionStorage=class{async save(e){r(this,i,e,"f")}async retrieve(){if(!s(this,i,"f"))throw new Error("Missing session information");return s(this,i,"f")}constructor(e){i.set(this,void 0),r(this,i,e,"f")}},i=new WeakMap},52274:function(e,t,i){var r,s,a,n,o,c,d,h=this&&this.__classPrivateFieldGet||function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)},l=this&&this.__classPrivateFieldSet||function(e,t,i,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,i):s?s.value=i:t.set(e,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.SignerSessionManager=void 0;const u=i(8056),p=i(69131),f=i(79306),y=i(89411),w=i(8056),g=i(78975);function b(e){return new Date(1e3*e)}class m{async token(){return(await this.storage.retrieve()).token}async client(e){if(await this.refreshIfNeeded(),h(s,s,"m",d).call(s,h(this,o,"f").token_exp)||this.hasExpired())throw await h(this,a,"f").emitSessionExpired(),new g.SessionExpiredError(e);return h(this,o,"f").client}async revoke(){const e=new p.OpClient("revokeCurrentSession",await this.client(),h(this,a,"f"));await e.del("/v0/org/{org_id}/session/self",{params:{path:{org_id:this.orgId}}})}async refresh(){if(this.hasExpired())throw await h(this,a,"f").emitSessionExpired(),new g.SessionExpiredError("signerSessionRefresh");const e=await this.storage.retrieve(),t=new p.OpClient("signerSessionRefresh",h(this,o,"f").client,h(this,a,"f")),i=e.session_info,s=await t.patch("/v1/org/{org_id}/token/refresh",{params:{path:{org_id:this.orgId}},body:{epoch_num:i.epoch,epoch_token:i.epoch_token,other_token:i.refresh_token}}),n={...e,session_info:s.session_info,token:s.token};await this.storage.save(n),l(this,o,{client:h(this,r,"m",c).call(this,n.token),token_exp:b(n.session_info.auth_token_exp),session_exp:n.session_exp?b(n.session_exp):void 0},"f")}async isStale(){return h(s,s,"m",d).call(s,h(this,o,"f").token_exp,30)}hasExpired(){return!!h(this,o,"f").session_exp&&h(s,s,"m",d).call(s,h(this,o,"f").session_exp)}async refreshIfNeeded(){if(await this.isStale()){if(h(this,n,"f")){for(;h(this,n,"f");)await(0,y.delay)(100);return!1}l(this,n,!0,"f");try{return await this.refresh(),!0}finally{l(this,n,!1,"f")}}return!1}autoRefresh(){return setInterval((async()=>{await this.refreshIfNeeded()}),6e4)}clearAutoRefresh(e){clearInterval(e)}static async createFromSessionInfo(e,t,i,r){const a={env:{"Dev-CubeSignerStack":e},org_id:t,token:i.token,purpose:"sign via oidc",session_info:i.session_info,session_exp:i.expiration};return r??=new f.MemorySessionStorage,await r.save(a),new s(a,r)}static async createFromSessionData(e,t){return t??=new f.MemorySessionStorage,await t.save(e),new s(e,t)}static async loadFromStorage(e){const t=await e.retrieve();return new s(t,e)}constructor(e,t){r.add(this),this.events=new u.Events,a.set(this,void 0),n.set(this,!1),o.set(this,void 0),this.env=e.env["Dev-CubeSignerStack"],this.orgId=e.org_id,this.storage=t,l(this,a,new w.EventEmitter([this.events]),"f"),l(this,o,{client:h(this,r,"m",c).call(this,e.token),token_exp:b(e.session_info.auth_token_exp),session_exp:e.session_exp?b(e.session_exp):void 0},"f")}}t.SignerSessionManager=m,s=m,a=new WeakMap,n=new WeakMap,o=new WeakMap,r=new WeakSet,c=function(e){return(0,p.createHttpClient)(this.env.SignerApiRoot,e)},d=function(e,t){return t??=0,e.getTime()<(new Date).getTime()+1e3*t}},29642:function(e,t,i){var r,s,a=this&&this.__classPrivateFieldGet||function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)},n=this&&this.__classPrivateFieldSet||function(e,t,i,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,i):s?s.value=i:t.set(e,i),i};Object.defineProperty(t,"__esModule",{value:!0}),t.SignerSession=t.SignerSessionInfo=void 0;const o=i(11844),c=i(46563),d=i(52274);t.SignerSessionInfo=class{async revoke(){await a(this,r,"f").sessionRevoke(a(this,s,"f"))}constructor(e,t,i){r.set(this,void 0),s.set(this,void 0),n(this,r,e,"f"),n(this,s,t,"f"),this.purpose=i}},r=new WeakMap,s=new WeakMap;class h extends o.CubeSignerClient{static async loadSignerSession(e){const t=await d.SignerSessionManager.loadFromStorage(e);return new h(t)}constructor(e){super(e)}async keys(){return(await this.sessionKeysList()).map((e=>(0,c.toKeyInfo)(e)))}}t.SignerSession=h},58396:function(e,t,i){var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,s)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&r(t,e,i);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.loadSubtleCrypto=t.userExportDecrypt=t.userExportKeygen=t.userExportCipherSuite=void 0;const n=i(89411);async function o(){const e=await Promise.resolve().then((()=>a(i(2581))));return new e.CipherSuite({kem:new e.DhkemP256HkdfSha256,kdf:new e.HkdfSha256,aead:new e.Aes256Gcm})}function c(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}t.userExportCipherSuite=o,t.userExportKeygen=async function(){return(await o()).kem.generateKeyPair()},t.userExportDecrypt=async function(e,t){const i=await o(),r=new TextEncoder,s=new TextDecoder,a=c(r.encode(`cubist-signer::UserExportOwner::${t.user_id}`)),d=c((0,n.decodeBase64)(t.ephemeral_public_key)),h=c((0,n.decodeBase64)(t.encrypted_key_material));return JSON.parse(s.decode(await i.open({recipientKey:e,enc:d,info:a},h)))},t.loadSubtleCrypto=async function(){if(void 0!==globalThis&&void 0!==globalThis.crypto)return globalThis.crypto.subtle;try{const{webcrypto:e}=await Promise.resolve().then((()=>a(i(55835))));return e.subtle}catch(e){throw new Error("subtle crypto not supported")}}},89411:(e,t,i)=>{var r=i(23085).lW;function s(e){return"function"==typeof r?r.from(e,"base64"):Uint8Array.from(atob(e),(e=>e.charCodeAt(0)))}function a(e){const t=new Uint8Array(e);return"function"==typeof r?r.from(t).toString("base64"):btoa(t.reduce(((e,t)=>e+String.fromCharCode(t)),""))}Object.defineProperty(t,"__esModule",{value:!0}),t.encodeToHex=t.delay=t.encodeToBase64Url=t.encodeToBase64=t.decodeBase64Url=t.decodeBase64=t.pathJoin=void 0,t.pathJoin=function(e,t){return`${e}${"win32"===globalThis?.process?.platform?"\\":"/"}${t}`},t.decodeBase64=s,t.decodeBase64Url=function(e){return s(e.replace(/-/g,"+").replace(/_/g,"/").replace(/=*$/g,""))},t.encodeToBase64=a,t.encodeToBase64Url=function(e){return a(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=*$/g,"")},t.delay=function(e){return new Promise((t=>setTimeout(t,e)))},t.encodeToHex=function(e){return"0x"+("string"==typeof e?r.from(e,"utf8"):r.from(e)).toString("hex")}},13425:e=>{var t,i=Object.defineProperty,r=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,a=Object.prototype.hasOwnProperty,n={};((e,t)=>{for(var r in t)i(e,r,{get:t[r],enumerable:!0})})(n,{createFinalURL:()=>l,default:()=>u,defaultBodySerializer:()=>h,defaultQuerySerializer:()=>d}),e.exports=(t=n,((e,t,n,o)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let n of s(t))a.call(e,n)||undefined===n||i(e,n,{get:()=>t[n],enumerable:!(o=r(t,n))||o.enumerable});return e})(i({},"__esModule",{value:!0}),t));var o={"Content-Type":"application/json"},c=/\/*$/;function d(e){const t=new URLSearchParams;if(e&&"object"==typeof e)for(const[i,r]of Object.entries(e))null!=r&&t.set(i,r);return t.toString()}function h(e){return JSON.stringify(e)}function l(e,t){let i=`${t.baseUrl?t.baseUrl.replace(c,""):""}${e}`;if(t.params.path)for(const[e,r]of Object.entries(t.params.path))i=i.replace(`{${e}}`,encodeURIComponent(String(r)));if(t.params.query){const e=t.querySerializer(t.params.query);e&&(i+=`?${e}`)}return i}function u(e={}){const{fetch:t=globalThis.fetch,querySerializer:i,bodySerializer:r,...s}=e,a=new Headers({...o,...s.headers??{}});async function n(e,n){const{headers:o,body:c,params:u={},parseAs:p="json",querySerializer:f=i??d,bodySerializer:y=r??h,...w}=n||{},g=l(e,{baseUrl:s.baseUrl,params:u,querySerializer:f}),b=new Headers(a),m=new Headers(o);for(const[e,t]of m.entries())null==t?b.delete(e):b.set(e,t);const v={redirect:"follow",...s,...w,headers:b};c&&(v.body=y(c)),v.body instanceof FormData&&b.delete("Content-Type");const _=await t(g,v);if(204===_.status||"0"===_.headers.get("Content-Length"))return _.ok?{data:{},response:_}:{error:{},response:_};if(_.ok){let e=_.body;if("stream"!==p){const t=_.clone();e="function"==typeof t[p]?await t[p]():await t.text()}return{data:e,response:_}}let k={};try{k=await _.clone().json()}catch{k=await _.clone().text()}return{error:k,response:_}}return{get:async(e,t)=>n(e,{...t,method:"GET"}),put:async(e,t)=>n(e,{...t,method:"PUT"}),post:async(e,t)=>n(e,{...t,method:"POST"}),del:async(e,t)=>n(e,{...t,method:"DELETE"}),options:async(e,t)=>n(e,{...t,method:"OPTIONS"}),head:async(e,t)=>n(e,{...t,method:"HEAD"}),patch:async(e,t)=>n(e,{...t,method:"PATCH"}),trace:async(e,t)=>n(e,{...t,method:"TRACE"})}}},2581:(e,t,i)=>{i.r(t),i.d(t,{AeadId:()=>S,Aes128Gcm:()=>I,Aes256Gcm:()=>C,BaseError:()=>n,CipherSuite:()=>me,DecapError:()=>p,DeriveKeyPairError:()=>b,DeserializeError:()=>l,DhkemP256HkdfSha256:()=>ve,DhkemP384HkdfSha384:()=>_e,DhkemP521HkdfSha512:()=>ke,EncapError:()=>u,ExportError:()=>f,ExportOnly:()=>A,HkdfSha256:()=>Se,HkdfSha384:()=>Ee,HkdfSha512:()=>Pe,HpkeError:()=>o,InvalidParamError:()=>c,KdfId:()=>k,KemId:()=>_,MessageLimitReachedError:()=>g,NotSupportedError:()=>m,OpenError:()=>w,SealError:()=>y,SerializeError:()=>h,ValidationError:()=>d});const r=(s=globalThis,a={},new Proxy(s,{get:(e,t,i)=>t in a?a[t]:s[t],set:(e,t,i)=>(t in a&&delete a[t],s[t]=i,!0),deleteProperty(e,t){let i=!1;return t in a&&(delete a[t],i=!0),t in s&&(delete s[t],i=!0),i},ownKeys(e){const t=Reflect.ownKeys(s),i=Reflect.ownKeys(a),r=new Set(i);return[...t.filter((e=>!r.has(e))),...i]},defineProperty:(e,t,i)=>(t in a&&delete a[t],Reflect.defineProperty(s,t,i),!0),getOwnPropertyDescriptor:(e,t)=>t in a?Reflect.getOwnPropertyDescriptor(a,t):Reflect.getOwnPropertyDescriptor(s,t),has:(e,t)=>t in a||t in s}));var s,a;class n extends Error{constructor(e){let t;t=e instanceof Error?e.message:"string"==typeof e?e:"",super(t),this.name=this.constructor.name}}class o extends n{}class c extends o{}class d extends o{}class h extends o{}class l extends o{}class u extends o{}class p extends o{}class f extends o{}class y extends o{}class w extends o{}class g extends o{}class b extends o{}class m extends o{}class v{constructor(){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async _setup(){void 0===this._api&&(this._api=await async function(){if(void 0!==r&&void 0!==globalThis.crypto)return globalThis.crypto.subtle;try{const{webcrypto:e}=await Promise.resolve().then(i.t.bind(i,55835,19));return e.subtle}catch(e){throw new m(e)}}())}}const _={NotAssigned:0,DhkemP256HkdfSha256:16,DhkemP384HkdfSha384:17,DhkemP521HkdfSha512:18,DhkemSecp256k1HkdfSha256:19,DhkemX25519HkdfSha256:32,DhkemX448HkdfSha512:33,HybridkemX25519Kyber768:48},k={HkdfSha256:1,HkdfSha384:2,HkdfSha512:3},S={Aes128Gcm:1,Aes256Gcm:2,Chacha20Poly1305:3,ExportOnly:65535},E=["encrypt","decrypt"];class P extends v{constructor(e){super(),Object.defineProperty(this,"_rawKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._rawKey=e}async seal(e,t,i){await this._setupKey();const r={name:"AES-GCM",iv:e,additionalData:i};return await this._api.encrypt(r,this._key,t)}async open(e,t,i){await this._setupKey();const r={name:"AES-GCM",iv:e,additionalData:i};return await this._api.decrypt(r,this._key,t)}async _setupKey(){if(void 0!==this._key)return;await this._setup();const e=await this._importKey(this._rawKey);new Uint8Array(this._rawKey).fill(0),this._key=e}async _importKey(e){return await this._api.importKey("raw",e,{name:"AES-GCM"},!0,E)}}class I{constructor(){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:S.Aes128Gcm}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:16}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}createEncryptionContext(e){return new P(e)}}class C extends I{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:S.Aes256Gcm}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:16})}}class A{constructor(){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:S.ExportOnly}),Object.defineProperty(this,"keySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"nonceSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"tagSize",{enumerable:!0,configurable:!0,writable:!0,value:0})}createEncryptionContext(e){throw new m("Export only")}}const O=8192,x=new Uint8Array(0);function j(){return new Promise(((e,t)=>{t(new m("Not supported"))}))}const M=new Uint8Array([115,101,99]);class T{constructor(e,t,i){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exporterSecret",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._api=e,this._kdf=t,this.exporterSecret=i}async seal(e,t){return await j()}async open(e,t){return await j()}async export(e,t){if(e.byteLength>O)throw new c("Too long exporter context");try{return await this._kdf.labeledExpand(this.exporterSecret,M,new Uint8Array(e),t)}catch(e){throw new f(e)}}}class K extends T{}class U extends T{constructor(e,t,i,r){super(e,t,i),Object.defineProperty(this,"enc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.enc=r}}const R=e=>"object"==typeof e&&null!==e&&"object"==typeof e.privateKey&&"object"==typeof e.publicKey;function D(e,t){if(t<=0)throw new Error("i2Osp: too small size");if(e>=256**t)throw new Error("i2Osp: too large integer");const i=new Uint8Array(t);for(let r=0;r<t&&e;r++)i[t-(r+1)]=e%256,e>>=8;return i}function L(e,t){const i=new Uint8Array(e.length+t.length);return i.set(e,0),i.set(t,e.length),i}class F extends T{constructor(e,t,i){if(super(e,t,i.exporterSecret),Object.defineProperty(this,"_aead",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nN",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nT",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_ctx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),void 0===i.key||void 0===i.baseNonce||void 0===i.seq)throw new Error("Required parameters are missing");this._aead=i.aead,this._nK=this._aead.keySize,this._nN=this._aead.nonceSize,this._nT=this._aead.tagSize;const r=this._aead.createEncryptionContext(i.key);this._ctx={key:r,baseNonce:i.baseNonce,seq:i.seq}}computeNonce(e){const t=D(e.seq,e.baseNonce.byteLength);return function(e,t){if(e.byteLength!==t.byteLength)throw new Error("xor: different length inputs");const i=new Uint8Array(e.byteLength);for(let r=0;r<e.byteLength;r++)i[r]=e[r]^t[r];return i}(e.baseNonce,t)}incrementSeq(e){if(e.seq>Number.MAX_SAFE_INTEGER)throw new g("Message limit reached");e.seq+=1}}class z extends F{async open(e,t=x){let i;try{i=await this._ctx.key.open(this.computeNonce(this._ctx),e,t)}catch(e){throw new w(e)}return this.incrementSeq(this._ctx),i}}class H extends F{constructor(e,t,i,r){super(e,t,i),Object.defineProperty(this,"enc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.enc=r}async seal(e,t=x){let i;try{i=await this._ctx.key.seal(this.computeNonce(this._ctx),e,t)}catch(e){throw new y(e)}return this.incrementSeq(this._ctx),i}}const W=new Uint8Array([98,97,115,101,95,110,111,110,99,101]),B=new Uint8Array([101,120,112]),q=new Uint8Array([105,110,102,111,95,104,97,115,104]),G=new Uint8Array([107,101,121]),N=new Uint8Array([112,115,107,95,105,100,95,104,97,115,104]),V=new Uint8Array([115,101,99,114,101,116]),$=new Uint8Array([72,80,75,69,0,0,0,0,0,0]);class J extends v{constructor(e){if(super(),Object.defineProperty(this,"_kem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_aead",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_suiteId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"number"==typeof e.kem)throw new c("KemId cannot be used");if(this._kem=e.kem,"number"==typeof e.kdf)throw new c("KdfId cannot be used");if(this._kdf=e.kdf,"number"==typeof e.aead)throw new c("AeadId cannot be used");this._aead=e.aead,this._suiteId=new Uint8Array($),this._suiteId.set(D(this._kem.id,2),4),this._suiteId.set(D(this._kdf.id,2),6),this._suiteId.set(D(this._aead.id,2),8),this._kdf.init(this._suiteId)}get kem(){return this._kem}get kdf(){return this._kdf}get aead(){return this._aead}async createSenderContext(e){this._validateInputLength(e),await this._setup();const t=await this._kem.encap(e);let i;return i=void 0!==e.psk?void 0!==e.senderKey?3:1:void 0!==e.senderKey?2:0,await this._keyScheduleS(i,t.sharedSecret,t.enc,e)}async createRecipientContext(e){this._validateInputLength(e),await this._setup();const t=await this._kem.decap(e);let i;return i=void 0!==e.psk?void 0!==e.senderPublicKey?3:1:void 0!==e.senderPublicKey?2:0,await this._keyScheduleR(i,t,e)}async seal(e,t,i=x){const r=await this.createSenderContext(e);return{ct:await r.seal(t,i),enc:r.enc}}async open(e,t,i=x){const r=await this.createRecipientContext(e);return await r.open(t,i)}async _keySchedule(e,t,i){const r=void 0===i.psk?x:new Uint8Array(i.psk.id),s=await this._kdf.labeledExtract(x,N,r),a=void 0===i.info?x:new Uint8Array(i.info),n=await this._kdf.labeledExtract(x,q,a),o=new Uint8Array(1+s.byteLength+n.byteLength);o.set(new Uint8Array([e]),0),o.set(new Uint8Array(s),1),o.set(new Uint8Array(n),1+s.byteLength);const c=void 0===i.psk?x:new Uint8Array(i.psk.key),d=this._kdf.buildLabeledIkm(V,c),h=this._kdf.buildLabeledInfo(B,o,this._kdf.hashSize),l=await this._kdf.extractAndExpand(t,d,h,this._kdf.hashSize);if(this._aead.id===S.ExportOnly)return{aead:this._aead,exporterSecret:l};const u=this._kdf.buildLabeledInfo(G,o,this._aead.keySize),p=await this._kdf.extractAndExpand(t,d,u,this._aead.keySize),f=this._kdf.buildLabeledInfo(W,o,this._aead.nonceSize),y=await this._kdf.extractAndExpand(t,d,f,this._aead.nonceSize);return{aead:this._aead,exporterSecret:l,key:p,baseNonce:new Uint8Array(y),seq:0}}async _keyScheduleS(e,t,i,r){const s=await this._keySchedule(e,t,r);return void 0===s.key?new U(this._api,this._kdf,s.exporterSecret,i):new H(this._api,this._kdf,s,i)}async _keyScheduleR(e,t,i){const r=await this._keySchedule(e,t,i);return void 0===r.key?new K(this._api,this._kdf,r.exporterSecret):new z(this._api,this._kdf,r)}_validateInputLength(e){if(void 0!==e.info&&e.info.byteLength>O)throw new c("Too long info");if(void 0!==e.psk){if(e.psk.key.byteLength<32)throw new c("PSK must have at least 32 bytes");if(e.psk.key.byteLength>O)throw new c("Too long psk.key");if(e.psk.id.byteLength>O)throw new c("Too long psk.id")}}}const X=new Uint8Array([72,80,75,69,45,118,49]);class Z extends v{constructor(){super(),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:k.HkdfSha256}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_suiteId",{enumerable:!0,configurable:!0,writable:!0,value:x}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-256",length:256}})}init(e){this._suiteId=e}buildLabeledIkm(e,t){this._checkInit();const i=new Uint8Array(7+this._suiteId.byteLength+e.byteLength+t.byteLength);return i.set(X,0),i.set(this._suiteId,7),i.set(e,7+this._suiteId.byteLength),i.set(t,7+this._suiteId.byteLength+e.byteLength),i}buildLabeledInfo(e,t,i){this._checkInit();const r=new Uint8Array(9+this._suiteId.byteLength+e.byteLength+t.byteLength);return r.set(new Uint8Array([0,i]),0),r.set(X,2),r.set(this._suiteId,9),r.set(e,9+this._suiteId.byteLength),r.set(t,9+this._suiteId.byteLength+e.byteLength),r}async extract(e,t){if(await this._setup(),0===e.byteLength&&(e=new ArrayBuffer(this.hashSize)),e.byteLength!==this.hashSize)throw new c("The salt length must be the same as the hashSize");const i=await this._api.importKey("raw",e,this.algHash,!1,["sign"]);return await this._api.sign("HMAC",i,t)}async expand(e,t,i){await this._setup();const r=await this._api.importKey("raw",e,this.algHash,!1,["sign"]),s=new ArrayBuffer(i),a=new Uint8Array(s);let n=x;const o=new Uint8Array(t),c=new Uint8Array(1);if(i>255*this.hashSize)throw new Error("Entropy limit reached");const d=new Uint8Array(this.hashSize+o.length+1);for(let e=1,t=0;t<a.length;e++)c[0]=e,d.set(n,0),d.set(o,n.length),d.set(c,n.length+o.length),n=new Uint8Array(await this._api.sign("HMAC",r,d.slice(0,n.length+o.length+1))),a.length-t>=n.length?(a.set(n,t),t+=n.length):(a.set(n.slice(0,a.length-t),t),t+=a.length-t);return s}async extractAndExpand(e,t,i,r){await this._setup();const s=await this._api.importKey("raw",t,"HKDF",!1,["deriveBits"]);return await this._api.deriveBits({name:"HKDF",hash:this.algHash.hash,salt:e,info:i},s,8*r)}async labeledExtract(e,t,i){return await this.extract(e,this.buildLabeledIkm(t,i))}async labeledExpand(e,t,i,r){return await this.expand(e,this.buildLabeledInfo(t,i,r),r)}_checkInit(){if(this._suiteId===x)throw new Error("Not initialized. Call init()")}}class Q extends Z{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:k.HkdfSha256}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-256",length:256}})}}class Y extends Z{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:k.HkdfSha384}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:48}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-384",length:384}})}}class ee extends Z{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:k.HkdfSha512}),Object.defineProperty(this,"hashSize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"algHash",{enumerable:!0,configurable:!0,writable:!0,value:{name:"HMAC",hash:"SHA-512",length:512}})}}const te=new Uint8Array([75,69,77,0,0]),ie=new Uint8Array([101,97,101,95,112,114,107]),re=new Uint8Array([115,104,97,114,101,100,95,115,101,99,114,101,116]);class se{constructor(e,t,i){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_prim",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_kdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=e,this._prim=t,this._kdf=i;const r=new Uint8Array(te);r.set(D(this.id,2),3),this._kdf.init(r)}async serializePublicKey(e){return await this._prim.serializePublicKey(e)}async deserializePublicKey(e){return await this._prim.deserializePublicKey(e)}async serializePrivateKey(e){return await this._prim.serializePrivateKey(e)}async deserializePrivateKey(e){return await this._prim.deserializePrivateKey(e)}async importKey(e,t,i=!0){return await this._prim.importKey(e,t,i)}async generateKeyPair(){return await this._prim.generateKeyPair()}async deriveKeyPair(e){if(e.byteLength>O)throw new c("Too long ikm");return await this._prim.deriveKeyPair(e)}async encap(e){let t;t=void 0===e.ekm?await this.generateKeyPair():R(e.ekm)?e.ekm:await this.deriveKeyPair(e.ekm);const i=await this._prim.serializePublicKey(t.publicKey),r=await this._prim.serializePublicKey(e.recipientPublicKey);try{let s,a;if(void 0===e.senderKey)s=new Uint8Array(await this._prim.dh(t.privateKey,e.recipientPublicKey));else{const i=R(e.senderKey)?e.senderKey.privateKey:e.senderKey;s=L(new Uint8Array(await this._prim.dh(t.privateKey,e.recipientPublicKey)),new Uint8Array(await this._prim.dh(i,e.recipientPublicKey)))}if(void 0===e.senderKey)a=L(new Uint8Array(i),new Uint8Array(r));else{const t=R(e.senderKey)?e.senderKey.publicKey:await this._prim.derivePublicKey(e.senderKey),s=await this._prim.serializePublicKey(t);a=function(e,t,i){const r=new Uint8Array(e.length+t.length+i.length);return r.set(e,0),r.set(t,e.length),r.set(i,e.length+t.length),r}(new Uint8Array(i),new Uint8Array(r),new Uint8Array(s))}return{enc:i,sharedSecret:await this._generateSharedSecret(s,a)}}catch(e){throw new u(e)}}async decap(e){const t=await this._prim.deserializePublicKey(e.enc),i=R(e.recipientKey)?e.recipientKey.privateKey:e.recipientKey,r=R(e.recipientKey)?e.recipientKey.publicKey:await this._prim.derivePublicKey(e.recipientKey),s=await this._prim.serializePublicKey(r);try{let r,a;if(void 0===e.senderPublicKey)r=new Uint8Array(await this._prim.dh(i,t));else{r=L(new Uint8Array(await this._prim.dh(i,t)),new Uint8Array(await this._prim.dh(i,e.senderPublicKey)))}if(void 0===e.senderPublicKey)a=L(new Uint8Array(e.enc),new Uint8Array(s));else{const t=await this._prim.serializePublicKey(e.senderPublicKey);a=new Uint8Array(e.enc.byteLength+s.byteLength+t.byteLength),a.set(new Uint8Array(e.enc),0),a.set(new Uint8Array(s),e.enc.byteLength),a.set(new Uint8Array(t),e.enc.byteLength+s.byteLength)}return await this._generateSharedSecret(r,a)}catch(e){throw new p(e)}}async _generateSharedSecret(e,t){const i=this._kdf.buildLabeledIkm(ie,e),r=this._kdf.buildLabeledInfo(re,t,this.secretSize);return await this._kdf.extractAndExpand(x,i,r,this.secretSize)}}const ae=["deriveBits"],ne=new Uint8Array([100,107,112,95,112,114,107]);new Uint8Array([115,107]);class oe{constructor(e){Object.defineProperty(this,"_num",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._num=new Uint8Array(e)}val(){return this._num}reset(){this._num.fill(0)}set(e){if(e.length!==this._num.length)throw new Error("Bignum.set: invalid argument");this._num.set(e)}isZero(){for(let e=0;e<this._num.length;e++)if(0!==this._num[e])return!1;return!0}lessThan(e){if(e.length!==this._num.length)throw new Error("Bignum.lessThan: invalid argument");for(let t=0;t<this._num.length;t++){if(this._num[t]<e[t])return!0;if(this._num[t]>e[t])return!1}return!1}}const ce=new Uint8Array([99,97,110,100,105,100,97,116,101]),de=new Uint8Array([255,255,255,255,0,0,0,0,255,255,255,255,255,255,255,255,188,230,250,173,167,23,158,132,243,185,202,194,252,99,37,81]),he=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,199,99,77,129,244,55,45,223,88,26,13,178,72,176,167,122,236,236,25,106,204,197,41,115]),le=new Uint8Array([1,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,81,134,135,131,191,47,150,107,127,204,1,72,247,9,165,208,59,181,201,184,137,156,71,174,187,111,183,30,145,56,100,9]),ue=new Uint8Array([48,65,2,1,0,48,19,6,7,42,134,72,206,61,2,1,6,8,42,134,72,206,61,3,1,7,4,39,48,37,2,1,1,4,32]),pe=new Uint8Array([48,78,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,34,4,55,48,53,2,1,1,4,48]),fe=new Uint8Array([48,96,2,1,0,48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,35,4,73,48,71,2,1,1,4,66]);class ye extends v{constructor(e,t){switch(super(),Object.defineProperty(this,"_hkdf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_alg",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nPk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nSk",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nDh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_bitmask",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_pkcs8AlgId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._hkdf=t,e){case _.DhkemP256HkdfSha256:this._alg={name:"ECDH",namedCurve:"P-256"},this._nPk=65,this._nSk=32,this._nDh=32,this._order=de,this._bitmask=255,this._pkcs8AlgId=ue;break;case _.DhkemP384HkdfSha384:this._alg={name:"ECDH",namedCurve:"P-384"},this._nPk=97,this._nSk=48,this._nDh=48,this._order=he,this._bitmask=255,this._pkcs8AlgId=pe;break;default:this._alg={name:"ECDH",namedCurve:"P-521"},this._nPk=133,this._nSk=66,this._nDh=66,this._order=le,this._bitmask=1,this._pkcs8AlgId=fe}}async serializePublicKey(e){await this._setup();try{return await this._api.exportKey("raw",e)}catch(e){throw new h(e)}}async deserializePublicKey(e){await this._setup();try{return await this._importRawKey(e,!0)}catch(e){throw new l(e)}}async serializePrivateKey(e){await this._setup();try{const t=await this._api.exportKey("jwk",e);if(!("d"in t))throw new Error("Not private key");return function(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),i=atob(t),r=new Uint8Array(i.length);for(let e=0;e<i.length;e++)r[e]=i.charCodeAt(e);return r}(t.d)}catch(e){throw new h(e)}}async deserializePrivateKey(e){await this._setup();try{return await this._importRawKey(e,!1)}catch(e){throw new l(e)}}async importKey(e,t,i){await this._setup();try{if("raw"===e)return await this._importRawKey(t,i);if(t instanceof ArrayBuffer)throw new Error("Invalid jwk key format");return await this._importJWK(t,i)}catch(e){throw new l(e)}}async generateKeyPair(){await this._setup();try{return await this._api.generateKey(this._alg,!0,ae)}catch(e){throw new m(e)}}async deriveKeyPair(e){await this._setup();try{const t=await this._hkdf.labeledExtract(x,ne,new Uint8Array(e)),i=new oe(this._nSk);for(let e=0;i.isZero()||!i.lessThan(this._order);e++){if(e>255)throw new Error("Faild to derive a key pair");const r=new Uint8Array(await this._hkdf.labeledExpand(t,ce,D(e,1),this._nSk));r[0]=r[0]&this._bitmask,i.set(r)}const r=await this._deserializePkcs8Key(i.val());return i.reset(),{privateKey:r,publicKey:await this.derivePublicKey(r)}}catch(e){throw new b(e)}}async derivePublicKey(e){await this._setup();try{const t=await this._api.exportKey("jwk",e);return delete t.d,delete t.key_ops,await this._api.importKey("jwk",t,this._alg,!0,[])}catch(e){throw new l(e)}}async dh(e,t){try{return await this._setup(),await this._api.deriveBits({name:"ECDH",public:t},e,8*this._nDh)}catch(e){throw new h(e)}}async _importRawKey(e,t){if(t&&e.byteLength!==this._nPk)throw new Error("Invalid public key for the ciphersuite");if(!t&&e.byteLength!==this._nSk)throw new Error("Invalid private key for the ciphersuite");return t?await this._api.importKey("raw",e,this._alg,!0,[]):await this._deserializePkcs8Key(new Uint8Array(e))}async _importJWK(e,t){if(void 0===e.crv||e.crv!==this._alg.namedCurve)throw new Error(`Invalid crv: ${e.crv}`);if(t){if(void 0!==e.d)throw new Error("Invalid key: `d` should not be set");return await this._api.importKey("jwk",e,this._alg,!0,[])}if(void 0===e.d)throw new Error("Invalid key: `d` not found");return await this._api.importKey("jwk",e,this._alg,!0,ae)}async _deserializePkcs8Key(e){const t=new Uint8Array(this._pkcs8AlgId.length+e.length);return t.set(this._pkcs8AlgId,0),t.set(e,this._pkcs8AlgId.length),await this._api.importKey("pkcs8",t,this._alg,!0,ae)}}class we extends se{constructor(){const e=new Q,t=new ye(_.DhkemP256HkdfSha256,e);super(_.DhkemP256HkdfSha256,t,e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:_.DhkemP256HkdfSha256}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:32}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:65}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:65}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:32})}}class ge extends se{constructor(){const e=new Y,t=new ye(_.DhkemP384HkdfSha384,e);super(_.DhkemP384HkdfSha384,t,e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:_.DhkemP384HkdfSha384}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:48}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:97}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:97}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:48})}}class be extends se{constructor(){const e=new ee,t=new ye(_.DhkemP521HkdfSha512,e);super(_.DhkemP521HkdfSha512,t,e),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:_.DhkemP521HkdfSha512}),Object.defineProperty(this,"secretSize",{enumerable:!0,configurable:!0,writable:!0,value:64}),Object.defineProperty(this,"encSize",{enumerable:!0,configurable:!0,writable:!0,value:133}),Object.defineProperty(this,"publicKeySize",{enumerable:!0,configurable:!0,writable:!0,value:133}),Object.defineProperty(this,"privateKeySize",{enumerable:!0,configurable:!0,writable:!0,value:64})}}class me extends J{}class ve extends we{}class _e extends ge{}class ke extends be{}class Se extends Q{}class Ee extends Y{}class Pe extends ee{}},28292:e=>{e.exports=JSON.parse('{"name":"@cubist-labs/cubesigner-sdk","version":"0.3.28","description":"CubeSigner TypeScript SDK","license":"MIT OR Apache-2.0","author":"Cubist, Inc.","main":"dist/cjs/src/index.js","files":["tsconfig.json","src/**","dist/**","../..NOTICE","../..LICENSE-APACHE","../..LICENSE-MIT"],"exports":{"require":"./dist/cjs/src/index.js","import":"./dist/esm/src/index.js"},"scripts":{"build":"npm run build:cjs && npm run build:mjs","prepack":"npm run build","build:cjs":"tsc -p . --outDir dist/cjs --module commonjs --moduleResolution node","build:mjs":"tsc -p . --outDir dist/esm --module es2022","gen-schema":"openapi-typescript ./spec/openapi.json --output ./src/schema.ts","test":"jest --maxWorkers=1","typedoc":"typedoc"},"dependencies":{"openapi-fetch":"0.6.1"},"optionalDependencies":{"@hpke/core":"^1.2.7"},"engines":{"node":">=18.0.0"},"directories":{"test":"test"}}')},99751:e=>{e.exports=JSON.parse('{"Dev-CubeSignerStack":{"ClientId":"405mhvv13llufju1ruvnq42rdc","LongLivedClientId":"6he1bnm17s0dv8bb4hjim6fs6i","Region":"us-east-1","UserPoolId":"us-east-1_79ljlRRfX","SignerApiRoot":"https://beta.signer.cubist.dev","OrgEventsTopicArn":"arn:aws:sns:us-east-1:819335423237:Beta-CubeSignerStack-OrgEventsTopic4416298A-beobtbku2Wa8"}}')},73717:e=>{e.exports=JSON.parse('{"Dev-CubeSignerStack":{"ClientId":"1tiou9ecj058khiidmhj4ds4rj","LongLivedClientId":"4jiuai7mtl5164of3drmvej234","Region":"us-east-1","UserPoolId":"us-east-1_RU7HEslOW","SignerApiRoot":"https://gamma.signer.cubist.dev","OrgEventsTopicArn":"arn:aws:sns:us-east-1:453904756570:Gamma-CubeSignerStack-OrgEventsTopic4416298A-MpV66OYPFQV0"}}')},51137:e=>{e.exports=JSON.parse('{"Dev-CubeSignerStack":{"ClientId":"2saesgbmeu8p981sk33sr6nq1j","LongLivedClientId":"79qoe43lbiphd7jv0emqadtoia","Region":"us-east-1","UserPoolId":"us-east-1_lLLal8vGd","SignerApiRoot":"https://prod.signer.cubist.dev","OrgEventsTopicArn":"arn:aws:sns:us-east-1:120601948649:Production-0-us-east-1-CubeSignerStack-OrgEventsTopic4416298A-Zf6LzKIIDrvV"}}')}}]);
//# debugId=08ae3e7a-bc26-5e0b-bfb6-c866374a2d2c
